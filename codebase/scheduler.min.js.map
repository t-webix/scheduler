{"version":3,"file":"scheduler.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/views/bars/add.js","../sources/views/bars/date.js","../sources/views/bars/nav.js","../sources/helpers/palette.js","../sources/views/side/editor.js","../sources/views/side/popup.js","../sources/views/side/index.js","../sources/views/bars/navpopup.js","../sources/views/bars/index.js","../sources/views/event/actionmenu.js","../sources/helpers/ical.js","../sources/helpers/recurring.js","../sources/views/event/recurringform.js","../sources/helpers/editrecurring.js","../sources/views/event/form.js","../sources/views/event/formpopup.js","../sources/views/event/info.js","../sources/views/modes/common/actionpopup.js","../sources/helpers/responsive.js","../sources/views/main.js","../sources/helpers/templates.js","../sources/helpers/dates.js","../sources/views/modes/common/unitlist.js","../sources/views/modes/agenda/index.js","../sources/views/modes/common/hourscale.js","../sources/views/modes/common/multimore.js","../sources/helpers/selection.js","../sources/helpers/resizer.js","../node_modules/@xbs/webix-gantt-lib/dist/wgantt.js","../sources/helpers/dragscroll.js","../sources/helpers/dnd.js","../sources/views/modes/day/events.js","../sources/views/modes/day/multiday.js","../sources/views/modes/day/index.js","../sources/views/modes/month/compact.js","../sources/views/modes/month/more.js","../sources/views/modes/month/events.js","../sources/views/modes/month/header.js","../sources/views/modes/month/list.js","../sources/views/modes/month/index.js","../sources/views/modes/timeline/bar.js","../sources/views/modes/timeline/more.js","../sources/views/modes/timeline/chart.js","../sources/views/modes/timeline/scale.js","../sources/views/modes/timeline/index.js","../sources/views/modes/units/events.js","../sources/views/modes/units/header.js","../sources/views/modes/units/multidaylist.js","../sources/views/modes/units/multiday.js","../sources/views/modes/units/index.js","../sources/views/modes/week/compact.js","../sources/views/modes/week/header.js","../sources/views/modes/week/multiday.js","../sources/views/modes/week/index.js","../sources/export_views.js","../sources/models/LocalData.js","../sources/models/Operations.js","../sources/models/Backend.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","import { JetView } from \"webix-jet\";\n\nexport default class AddView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst cals = this.app.config.calendars;\n\n\t\tconst ui = {\n\t\t\tview: compact ? \"icon\" : \"button\",\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"wxi-plus\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: _(\"Create\"),\n\t\t\twidth: compact ? 50 : cals ? 185 : 100,\n\t\t\theight: compact ? 50 : webix.skin.$active.inputHeight,\n\t\t\ton: {\n\t\t\t\tonItemClick: () => this.AddEvent(),\n\t\t\t},\n\t\t};\n\n\t\treturn { view: \"align\", body: ui, align: \"middle\" };\n\t}\n\n\tAddEvent() {\n\t\tthis.app.getState().selected = { id: \"0\" };\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class DateView extends JetView {\n\tconfig() {\n\t\tconst toolbar = [\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-left\",\n\t\t\t\ttooltip: () => this.NavLabel(-1),\n\t\t\t\talign: \"left\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(-1) },\n\t\t\t},\n\t\t\t{ view: \"label\", localId: \"title\", align: \"center\", width: 160 },\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-right\",\n\t\t\t\ttooltip: () => this.NavLabel(1),\n\t\t\t\talign: \"right\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(1) },\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcols: toolbar,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"date\", () => this.DateLabel());\n\t\tthis.on(this.State.$changes, \"mode\", () => this.DateLabel());\n\t\tif (this.app.config.timeline)\n\t\t\tthis.on(this.State.$changes, \"timelineMode\", () => this.DateLabel());\n\t}\n\n\tChangeDate(dir) {\n\t\tconst state = this.State;\n\t\tconst step = this.GetStep(state.mode);\n\t\tconst next = webix.Date.add(state.date, dir, step, true);\n\n\t\t// fix navigation in month mode when last day of month is selected\n\t\tif (state.mode === \"month\") {\n\t\t\tconst diff = Math.abs(state.date.getMonth() - next.getMonth());\n\t\t\tif (diff != 1 && diff < 6) next.setDate(0);\n\t\t}\n\n\t\tstate.$batch({\n\t\t\tdate: next,\n\t\t\tselected: null,\n\t\t});\n\t}\n\n\tGetStep(mode) {\n\t\tswitch (mode) {\n\t\t\tcase \"agenda\":\n\t\t\t\treturn \"month\";\n\t\t\tcase \"units\":\n\t\t\t\treturn \"day\";\n\t\t\tcase \"timeline\":\n\t\t\t\treturn this.State.timelineMode;\n\t\t\tdefault:\n\t\t\t\treturn mode;\n\t\t}\n\t}\n\n\tDateLabel() {\n\t\tconst date = this.State.date;\n\t\tconst label =\n\t\t\tthis.State.mode == \"day\" ||\n\t\t\tthis.State.mode == \"units\" ||\n\t\t\t(this.State.mode == \"timeline\" && this.State.timelineMode == \"day\")\n\t\t\t\t? webix.i18n.longDateFormatStr(date)\n\t\t\t\t: webix.Date.dateToStr(\"%F %Y\")(date);\n\n\t\tthis.$$(\"title\").setHTML(label);\n\t}\n\n\tNavLabel(dir) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst modes = [\"month\", \"week\", \"day\"];\n\t\tlet mode = this.State.mode;\n\t\tmode = modes.indexOf(mode) !== -1 ? ` ${mode}` : \"\";\n\n\t\tdir = dir > 0 ? \"Next\" : \"Previous\";\n\n\t\treturn _(dir + mode);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class NavBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst units = !!this.app.config.units;\n\n\t\tconst toolbar = {\n\t\t\thidden: compact,\n\t\t\tview: \"tabbar\",\n\t\t\tbottomOffset: 0,\n\t\t\tlocalId: \"buttons\",\n\t\t\tborderless: true,\n\t\t\twidth: 320,\n\t\t\toptionWidth: 80,\n\t\t\toptions: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\") },\n\t\t\t],\n\t\t};\n\n\t\tif (this.app.config.timeline) {\n\t\t\ttoolbar.options.push({ id: \"timeline\", value: _(\"Timeline\") });\n\t\t\ttoolbar.width = 400;\n\t\t}\n\n\t\tif (!compact) {\n\t\t\ttoolbar.on = { onChange: val => this.SetMode(val) };\n\t\t}\n\n\t\tif (units) {\n\t\t\ttoolbar.width += 80;\n\t\t\ttoolbar.options.push({ id: \"units\", value: _(\"Units\") });\n\t\t}\n\n\t\treturn toolbar;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"mode\", val => {\n\t\t\tthis.$$(\"buttons\").setValue(val);\n\t\t});\n\t}\n\tSetMode(val) {\n\t\tthis.State.$batch({\n\t\t\tmode: val,\n\t\t\tselected: null,\n\t\t});\n\t}\n}\n","export default function getPalette() {\n\tconst aSkin = webix.skin.$active;\n\treturn {\n\t\tview: \"colorboard\",\n\t\tcss: \"webix_scheduler_palette\",\n\t\theight: aSkin.optionHeight * 3 + 4,\n\t\twidth: aSkin.optionHeight * 7 + 4,\n\t\tpalette: [\n\t\t\t[\n\t\t\t\t\"#61AEE6\",\n\t\t\t\t\"#01C2A5\",\n\t\t\t\t\"#E88DD9\",\n\t\t\t\t\"#D2FB9E\",\n\t\t\t\t\"#6BA8CB\",\n\t\t\t\t\"#61BBA5\",\n\t\t\t\t\"#CF89D5\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#EF9C80\",\n\t\t\t\t\"#8289EE\",\n\t\t\t\t\"#74B1A7\",\n\t\t\t\t\"#DD89AF\",\n\t\t\t\t\"#E48882\",\n\t\t\t\t\"#997CEB\",\n\t\t\t\t\"#ADD579\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#F68896\",\n\t\t\t\t\"#FFE999\",\n\t\t\t\t\"#6D4BCE\",\n\t\t\t\t\"#99CA58\",\n\t\t\t\t\"#D352BE\",\n\t\t\t\t\"#F7CC34\",\n\t\t\t\t\"#DA5C53\",\n\t\t\t],\n\t\t],\n\t};\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst save = {\n\t\t\tview: \"button\",\n\t\t\tvalue: _(\"Save\"),\n\t\t\talign: \"right\",\n\t\t\tinputWidth: 100,\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.Save(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst compactBar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"icon\", icon: \"wxi-close\", click: () => this.getRoot().hide() },\n\t\t\t\t{},\n\t\t\t\tsave,\n\t\t\t],\n\t\t};\n\n\t\tconst controls = [\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"removeBtn\",\n\t\t\t\tvalue: _(\"Delete\"),\n\t\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\t\thidden: true,\n\t\t\t\talign: compact ? \"center\" : \"left\",\n\t\t\t\tinputWidth: compact ? 330 : 100,\n\t\t\t\tclick: () => this.Delete(),\n\t\t\t},\n\t\t];\n\n\t\tif (!compact) controls.push(save);\n\n\t\tconst ui = {\n\t\t\tview: \"window\",\n\t\t\twidth: 400,\n\t\t\tmodal: true,\n\t\t\tclose: true,\n\t\t\tposition: \"center\",\n\t\t\tborderless: compact,\n\t\t\tfullscreen: compact,\n\t\t\tcss: \"webix_scheduler_cal_popup\",\n\t\t\thead: compact ? compactBar : _(\"Edit calendar\"),\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tlocalId: \"calendars:form\",\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"text\", label: _(\"Title\"), name: \"text\" },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\t\tname: \"color\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ view: \"checkbox\", label: _(\"Active\"), name: \"active\" },\n\t\t\t\t\t{ cols: controls },\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tthis.Form.clear();\n\t\t\t\t\tthis.$$(\"removeBtn\").hide();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (compact) ui.body.elements.splice(3, 0, {});\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.Cals = this.app.getService(\"local\").calendars(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Form = this.$$(\"calendars:form\");\n\t}\n\n\tShow(id) {\n\t\tif (id) {\n\t\t\tconst obj = this.Cals.getItem(id);\n\t\t\tthis.Form.setValues(obj);\n\t\t\tthis.$$(\"removeBtn\").show();\n\t\t} else {\n\t\t\tthis.Form.setValues({\n\t\t\t\tcolor: \"#997CEB\",\n\t\t\t\tactive: 1,\n\t\t\t});\n\t\t}\n\t\tthis.getRoot().show();\n\t\tthis.Form.focus();\n\t}\n\n\tSave() {\n\t\tconst obj = this.Form.getValues();\n\t\tif (obj.id) this.Ops.updateCalendar(obj.id, obj);\n\t\telse this.Ops.addCalendar(obj);\n\t\tthis.getRoot().hide();\n\t}\n\n\tDelete() {\n\t\tconst obj = this.Form.getValues();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\twebix.confirm(_(\"Do you really want to remove this calendar?\")).then(() => {\n\t\t\tthis.Ops.removeCalendar(obj.id);\n\t\t\tthis.getRoot().hide();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport EditorView from \"./editor\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = {\n\t\t\tview: \"popup\",\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\trows: [\n\t\t\t\t\twebix.extend(getPalette(), {\n\t\t\t\t\t\tlocalId: \"colors\",\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonItemClick: val => this.UpdateColor(val),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\t{\n\t\t\t\t\t\tcss: \"webix_scheduler_settings\",\n\t\t\t\t\t\ttemplate: _(\"Settings\"),\n\t\t\t\t\t\theight: webix.skin.$active.inputHeight,\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_template: () => this.ShowEditor(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => this.app.callEvent(\"side:popup:hide\", []),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.Editor = this.ui(EditorView);\n\t}\n\n\tShow(id, node, color) {\n\t\tthis.Cid = id;\n\t\tthis.getRoot().show(node);\n\t\tthis.$$(\"colors\").setValue(color);\n\t}\n\n\tShowEditor() {\n\t\tthis.Editor.Show(this.Cid);\n\t\tthis.getRoot().hide();\n\t}\n\n\tUpdateColor(val) {\n\t\tthis.app.getService(\"operations\").updateCalendar(this.Cid, {\n\t\t\tcolor: val,\n\t\t});\n\t\tthis.getRoot().hide();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport PopupView from \"./popup\";\nimport EditorView from \"./editor\";\n\nexport default class SideView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.app.getState();\n\n\t\tconst calendar = {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\theight: 276,\n\t\t\tmonthSelect: false,\n\t\t\ton: {\n\t\t\t\tonAfterDateSelect: date => {\n\t\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"calendars\",\n\t\t\ttype: this.ListType(_, state),\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\tyCount: 5,\n\t\t\teditable: true,\n\t\t\teditValue: \"text\",\n\t\t\teditaction: \"custom\",\n\t\t\teditor: \"text\",\n\t\t\tcss: \"webix_scheduler_cal_list\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_cal_edit: (e, id) => this.ShowPopup(e, id),\n\t\t\t\twebix_scheduler_cal_title: (e, id) => this.ToggleCalendar(id),\n\t\t\t\twebix_scheduler_active: (e, id) => this.ToggleCalendar(id),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonBeforeEditStop: (v, editor) => this.SetTitle(editor.id, v.value),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\t{ maxHeight: 100 },\n\t\t\tlist,\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"add\",\n\t\t\t\tvalue: _(\"Add calendar\"),\n\t\t\t\thidden: !state.readonly,\n\t\t\t\tinputWidth: 190,\n\t\t\t\talign: \"center\",\n\t\t\t\tclick: () => this.AddCalendar(),\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tlet side = {\n\t\t\ttype: \"form\",\n\t\t\tpadding: { top: 8 },\n\t\t\trows: rows,\n\t\t};\n\n\t\tif (!this.Compact) {\n\t\t\tlist.on.onAfterScroll = () => this.Popup.Hide();\n\t\t\tside = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [calendar, side],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn side;\n\t}\n\n\tinit() {\n\t\tthis.Cals = this.$$(\"calendars\");\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\tthis.Popup = this.Compact ? this.ui(EditorView) : this.ui(PopupView);\n\t\twebix.extend(this.Cals, webix.EditAbility);\n\n\t\tthis.Data.calendars().then(data => this.Cals.parse(data));\n\n\t\tconst state = this.app.getState();\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"date\", value => {\n\t\t\t\tthis.$$(\"calendar\").setValue(value);\n\t\t\t});\n\t\t\tthis.on(this.app, \"side:popup:hide\", () => {\n\t\t\t\tthis.Cals.unselectAll();\n\t\t\t});\n\t\t}\n\n\t\tthis.on(state.$changes, \"readonly\", value => this.ToggleState(value));\n\t}\n\n\tListType(_, state) {\n\t\treturn {\n\t\t\tcheckbox: function(obj) {\n\t\t\t\tconst icon =\n\t\t\t\t\tobj.active * 1 ? \"wxi-checkbox-marked\" : \"wxi-checkbox-blank\";\n\t\t\t\treturn `<span style=\"color:${obj.color};\" \n\t\t\t\t\trole=\"checkbox\" tabindex=\"-1\" \n\t\t\t\t\taria-checked=\"${obj.active ? \"true\" : \"false\"}\" \n\t\t\t\t\tclass=\"webix_icon webix_scheduler_active ${icon}\">\n\t\t\t\t</span>`;\n\t\t\t},\n\t\t\ttemplate: (obj, common) => {\n\t\t\t\tconst edit = `\n\t\t\t\t\t<span\n\t\t\t\t\t\twebix_tooltip=\"${_(\"Edit calendar\")}\" \n\t\t\t\t\t\tclass=\"webix_icon wxi-dots webix_scheduler_cal_edit \n\t\t\t\t\t\t\t${webix.env.touch ? \" webix_scheduler_cal_visible\" : \"\"}\n\t\t\t\t\t\t\">\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\treturn `\n\t\t\t\t\t${common.checkbox(obj)}\n\t\t\t\t\t<span class=\"webix_scheduler_cal_title\">${obj.text || _(\"(no title)\")}</span>\n\t\t\t\t\t${state.readonly ? \"\" : edit}\n\t\t\t\t`;\n\t\t\t},\n\t\t};\n\t}\n\n\tAddCalendar() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Ops.addCalendar().then(id => {\n\t\t\tthis.Cals.edit(id);\n\t\t\tthis.Cals.getEditor()\n\t\t\t\t.getInputNode()\n\t\t\t\t.setAttribute(\"placeholder\", _(\"(no title)\"));\n\t\t});\n\t}\n\n\tShowPopup(e, id) {\n\t\tif (!this.Compact) {\n\t\t\tthis.Cals.select(id);\n\n\t\t\tconst color = this.Cals.getItem(id).color;\n\t\t\tthis.Popup.Show(id, this.Cals.getItemNode(id), color);\n\t\t} else this.Popup.Show(id);\n\t}\n\n\tToggleCalendar(id) {\n\t\tconst obj = this.Cals.getItem(id);\n\t\tthis.Ops.updateCalendar(id, { active: obj.active ^ 1 });\n\t}\n\n\tToggleState(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse add.show();\n\n\t\tthis.Cals.refresh();\n\t}\n\n\tSetTitle(id, text) {\n\t\tthis.Ops.updateCalendar(id, { text }).then(\n\t\t\t() => this.EditStopSilent(),\n\t\t\t() => this.EditStopSilent(true)\n\t\t);\n\t\treturn false;\n\t}\n\n\tEditStopSilent(fail) {\n\t\tthis.Cals.blockEvent();\n\t\tif (fail) this.Cals.editCancel();\n\t\telse this.Cals.editStop();\n\t\tthis.Cals.unblockEvent();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport side from \"views/side\";\n\nexport default class NavPopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst units = !!this.app.config.units;\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tcss: \"webix_scheduler_navlist\",\n\t\t\tlocalId: \"modes\",\n\t\t\tautoheight: true,\n\t\t\tdata: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\"), icon: \"shi-day\" },\n\t\t\t\t{ id: \"week\", value: _(\"Week\"), icon: \"shi-week\" },\n\t\t\t\t{ id: \"month\", value: _(\"Month\"), icon: \"shi-month\" },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\"), icon: \"shi-agenda\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.SetMode(id),\n\t\t\t},\n\t\t};\n\n\t\tif (units) {\n\t\t\tlist.data.push({ id: \"units\", value: _(\"Units\"), icon: \"shi-units\" });\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tlist.data.push({\n\t\t\t\tid: \"timeline\",\n\t\t\t\tvalue: _(\"Timeline\"),\n\t\t\t\ticon: \"shi-timeline\",\n\t\t\t});\n\t\t}\n\n\t\tconst ui = {\n\t\t\tview: \"sidemenu\",\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_scheduler_sidemenu\",\n\t\t\twidth: 300,\n\t\t\tstate: state => {\n\t\t\t\tconst tHeight = webix.skin.$active.tabbarHeight + 10;\n\t\t\t\tstate.top = tHeight + 2;\n\t\t\t\tstate.height -= tHeight - 2;\n\t\t\t},\n\t\t\tbody: list,\n\t\t};\n\n\t\tif (this.app.config.calendars)\n\t\t\tui.body = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [list, side],\n\t\t\t\t},\n\t\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t}\n\tShow() {\n\t\tconst win = this.getRoot();\n\t\tif (!win.isVisible()) {\n\t\t\tthis.$$(\"modes\").select(this.State.mode);\n\t\t\twin.show();\n\t\t}\n\t}\n\tSetMode(value) {\n\t\tthis.getRoot().hide();\n\n\t\t//wait until hide animation is complete\n\t\tsetTimeout(() => this.State.$batch({ mode: value, selected: null }), 500);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport NavBarView from \"views/bars/nav\";\nimport DateView from \"views/bars/date\";\nimport AddView from \"views/bars/add\";\nimport NavPopupView from \"views/bars/navpopup\";\n\nexport default class TopBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst todayIcon = {\n\t\t\tview: \"icon\",\n\t\t\ticon: \"wxi-calendar\",\n\t\t\tbatch: \"compact\",\n\t\t\ttooltip: _(\"Today\"),\n\t\t\tclick: () => this.SetToday(),\n\t\t};\n\t\tconst todayBtn = {\n\t\t\tview: \"align\",\n\t\t\talign: \"middle\",\n\t\t\tbatch: \"full\",\n\t\t\tbody: {\n\t\t\t\twidth: 80,\n\t\t\t\tview: \"button\",\n\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\tvalue: _(\"Today\"),\n\t\t\t\tclick: () => this.SetToday(),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_scheduler_toolbar webix_dark\",\n\t\t\tresponsive: true,\n\t\t\tpaddingY: 0,\n\t\t\tpaddingX: 4,\n\t\t\theight: webix.skin.$active.tabbarHeight + 10,\n\t\t\tvisibleBatch: this.Compact ? \"compact\" : \"full\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"shi-menu\",\n\t\t\t\t\tclick: () => this.ShowNav(),\n\t\t\t\t\thidden: !this.Compact && !this.app.config.calendars,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: AddView,\n\t\t\t\t\tbatch: \"full\",\n\t\t\t\t\t//[ToDO] makes sence to hide it on medium screens to allows smaller compactWidth\n\t\t\t\t\t//in this case click-to-add behaviour for modes must be implemenetd\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: DateView,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\ttodayBtn,\n\t\t\t\tNavBarView,\n\t\t\t\ttodayIcon,\n\t\t\t],\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tif (this.Compact) this.NavPopup = this.ui(NavPopupView);\n\n\t\tthis.on(this.State.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\t}\n\tSetToday() {\n\t\tthis.State.date = webix.Date.dayStart(new Date());\n\t}\n\tShowNav() {\n\t\tif (this.Compact) this.NavPopup.Show();\n\t\telse this.app.callEvent(\"show:panel\");\n\t}\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (!this.Compact) add.show();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionMenu extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tbody: {\n\t\t\t\tview: \"menu\",\n\t\t\t\tlayout: \"y\",\n\t\t\t\twidth: 220,\n\t\t\t\tautoheight: true,\n\t\t\t\tdata: [\n\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t],\n\t\t\t\ton: {\n\t\t\t\t\tonMenuItemClick: id => {\n\t\t\t\t\t\tif (this.Result) this.Result.resolve(id);\n\t\t\t\t\t\tthis.Result = null;\n\t\t\t\t\t\tthis.Root.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tif (this.Result) this.Result.reject();\n\t\t\t\t\tthis.Result = null;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(node, promise) {\n\t\tthis.Result = promise;\n\t\tthis.Root.show(node);\n\t}\n}\n","const icalFormat = webix.Date.dateToStr(\"%Y%m%dT000000Z\");\n\nexport function parse(string) {\n\t//FREQ=DAILY;INTERVAL=2\n\tconst parts = string.split(\";\");\n\tconst config = {};\n\tfor (let i = 0; i < parts.length; i++) {\n\t\tconst [code, name] = parts[i].split(\"=\");\n\t\tconfig[code] = name;\n\t}\n\n\tif (config.UNTIL) config.UNTIL = strToDate(config.UNTIL);\n\tif (config.EXDATE) {\n\t\tconfig.EXDATE = config.EXDATE.split(\",\").map(d => strToDate(d));\n\t}\n\n\treturn config;\n}\n\nfunction strToDate(str) {\n\treturn new Date(\n\t\tstr.substr(0, 4) * 1,\n\t\tstr.substr(4, 2) * 1 - 1,\n\t\tstr.substr(6, 2) * 1\n\t);\n}\n\nexport function serialize(config) {\n\tconst str = [];\n\tfor (let key in config) {\n\t\tlet value = config[key];\n\t\tif (key === \"UNTIL\") value = icalFormat(value);\n\n\t\tif (key === \"EXDATE\") {\n\t\t\tvalue = value.map(d => icalFormat(d));\n\t\t\tvalue = value.join(\",\");\n\t\t}\n\t\tif (value) str.push(`${key}=${value}`);\n\t}\n\n\treturn str.join(\";\");\n}\n","import { serialize, parse } from \"helpers/ical\";\nexport const WEEKDAYS = [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"];\n\nexport const FREQUENCE = {\n\tDAILY: \"day\",\n\tWEEKLY: \"week\",\n\tMONTHLY: \"month\",\n\tYEARLY: \"year\",\n};\n\n/**\n * Splits each recurring event into a series of events and returns the resulting array\n * @param {Date} sdate - the start date\n * @param {Date} edate - the end date\n * @param {Object} ev - the event data object\n * @returns {Array} with recurring events split into occurrences\n */\nexport function explodeEvent(sdate, edate, ev) {\n\tconst mode = ev.$recurring;\n\n\tconst consts = {};\n\tconst res = [];\n\n\t// when we use week-days in recurring mode, convert structure\n\t// list of days => list of steps to the next allowed day\n\tfillWdays(mode, consts);\n\n\tconst xdate = new Date(ev.start_date);\n\tconst length = ev.end_date - ev.start_date;\n\n\t// occurrences before active window\n\tlet count = 1;\n\twhile (\n\t\t(sdate - xdate >= (length || 1) &&\n\t\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t\t(!mode.COUNT || count <= mode.COUNT)) ||\n\t\tfindDate(mode.EXDATE, xdate)\n\t) {\n\t\t++count;\n\t\tnext(xdate, mode, consts);\n\t}\n\n\t// occurrences inside of window\n\twhile (\n\t\tedate > xdate &&\n\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t(!mode.COUNT || count <= mode.COUNT)\n\t) {\n\t\t// make copy of recurring event\n\t\tif (!findDate(mode.EXDATE, xdate)) {\n\t\t\tconst copy = webix.copy(ev);\n\n\t\t\txdate.setHours(ev.start_date.getHours());\n\t\t\tcopy.start_date = new Date(xdate);\n\t\t\tcopy.end_date = new Date(xdate * 1 + length);\n\n\t\t\tcopy.$id = ev.id;\n\t\t\tcopy.id = copy.start_date.valueOf() + \"_\" + ev.id;\n\t\t\tres.push(copy);\n\t\t}\n\t\tcount++;\n\n\t\tnext(xdate, mode, consts);\n\t}\n\treturn res;\n}\n\n// IE support\n/**\n * Finds a date in an array of dates\n * @param {Array} arr - all dates\n * @param {Date} date - the date to be checked\n * @returns {Boolean}\n */\nfunction findDate(arr, date) {\n\tif (!arr) return false;\n\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (webix.Date.equal(webix.Date.dayStart(date), arr[i])) return true;\n\t}\n\treturn false;\n}\n\n/**\n * Defines the object that stores the recurring pattern, for more details please refer to the iCalendar docs https://icalendar.org/iCalendar-RFC-5545/3-8-5-3-recurrence-rule.html\n * @typedef {Object} Recurring\n * @property {string} FREQ - the step of repetition: DAILY, WEEKLY, MONTHLY, YEARLY\n * @property {(number|string)} INTERVAL - how many steps are between occurrences\n * @property {string} BYDAY - week days, e.g. SU,MO,TU,WE,TH,FR,SA\n * @property {(number|string)} BYMONTH - the number or a month (1-12)\n * @property {(number|string)} BYMONTHDAY - the date (day of a month)\n * @property {(number|string)} BYSETPOS - the number of the week day within a month\n * @property {string} UNTIL - a date like 19970902T090000\n * @property {(number|string)} COUNT - how many times the event repeats\n * @property {string} EXDATE - string with 1 or more dates, on which the event does not repeat, e.g. 19960402T010000Z,19960403T010000Z,19960404T010000Z\n */\n\n/**\n * Fills the list of steps to the next allowed day for recurring events that repeat by certain week days\n * @param {Recurring} mode - the object with the recurring pattern\n * @param {Object} consts - (for events that have BYDAY in their pattern) stores wdays (Array) - the list of steps to the next allowed day\n */\nexport function fillWdays(mode, consts) {\n\tif (mode.BYDAY) {\n\t\tconst diff = (consts.wdays = [0, 0, 0, 0, 0, 0, 0]);\n\t\tconst line = mode.BYDAY.split(\",\")\n\t\t\t.map(a => WEEKDAYS.indexOf(a))\n\t\t\t.sort();\n\n\t\t// for each allowed day, fill range with steps\n\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\tconst s = line[i];\n\t\t\tconst e = line[i + 1] || line[0] + 7;\n\n\t\t\tfor (let j = s; j < e; j++) {\n\t\t\t\tdiff[j % 7] = e - j;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Calculates the date of the next occurrence of a repeating event\n * @param {Date} date - the current date\n * @param {Recurring} mode - the object with the recurring pattern\n * @param {Object} consts - (for events that have BYDAY in their pattern) stores wdays (Array) - the list of steps to the next allowed day\n */\nexport function next(date, mode, consts) {\n\tlet interval = (mode.INTERVAL || 1) * 1;\n\tif (mode.FREQ == \"YEARLY\") interval *= 12;\n\n\tlet now, step;\n\tswitch (mode.FREQ) {\n\t\tcase \"DAILY\":\n\t\t\tdate.setDate(date.getDate() + interval);\n\t\t\tbreak;\n\t\tcase \"WEEKLY\":\n\t\t\tnow = date.getDay();\n\t\t\tstep = consts.wdays ? consts.wdays[now] : 7;\n\t\t\tif (step + now > 6 && interval > 1) {\n\t\t\t\t// when new day is on the different week\n\t\t\t\t// add week interval as well\n\t\t\t\tstep += 7 * (interval - 1);\n\t\t\t}\n\t\t\tdate.setDate(date.getDate() + step);\n\t\t\tbreak;\n\t\tcase \"YEARLY\":\n\t\tcase \"MONTHLY\":\n\t\t\tnow = date.getMonth();\n\t\t\tdate.setDate(1);\n\t\t\tdate.setMonth(now + interval);\n\t\t\tif (mode.BYMONTHDAY) {\n\t\t\t\tdate.setDate(mode.BYMONTHDAY);\n\t\t\t\t// when date is outside of month bounds, switch to last day of month\n\t\t\t\tif ((now + interval) % 12 != date.getMonth()) date.setDate(0);\n\t\t\t} else if (mode.BYSETPOS) {\n\t\t\t\t// go to last day of month before one in question\n\t\t\t\tdate.setDate(0);\n\t\t\t\t// find the matching day\n\t\t\t\tfor (let i = 0; i < mode.BYSETPOS; i++) {\n\t\t\t\t\tstep = consts.wdays[date.getDay()];\n\t\t\t\t\tdate.setDate(date.getDate() + step);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn date;\n}\n\n/**\n * Defines the result of the check if a date fits a BYDAY pattern\n * @typedef {Object} weekdayCheckResult\n * @property {Boolean} result true if the date fits the BYDAY pattern, false otherwise\n * @property {Date} start - the copy of the start date\n * @property {Array} days - BYDAY pattern as an array of strings\n * @property {string} oldDay - the week day of the start date\n */\n/**\n * Checks if the start day fits the recurring BYDAY pattern\n * @param {Date} sdate - the start date of an event\n * @param {Recurring} mode - the object with the recurring pattern\n * @returns {weekdayCheckResult} the result of the check\n */\nfunction checkDay(sdate, mode) {\n\tconst start = new Date(sdate);\n\tconst days = mode.BYDAY.split(\",\");\n\tconst oldDay = WEEKDAYS[start.getDay()];\n\tconst result = days.indexOf(oldDay) !== -1;\n\n\treturn { result, start, days, oldDay };\n}\n\n/**\n * Synchronizes the start and end dates to the BYDAY recurring pattern\n * @param {Date} sdate\n * @param {Date} edate\n * @param {Recurring} mode - the object with the recurring pattern\n * @return {Array} - the start and end dates of an event\n */\nexport function datesToWeekdays(sdate, edate, mode) {\n\tconst { result, start, days } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn [sdate, edate];\n\t}\n\n\tconst diff = WEEKDAYS.indexOf(days[0]) - start.getDay();\n\tstart.setDate(start.getDate() + diff);\n\n\tconst end = new Date(edate);\n\tend.setDate(end.getDate() + diff);\n\n\treturn [start, end];\n}\n\n/**\n * Synchronizes BYDAY recurring pattern with the date of an event\n * @param {Date} sdate - the start date of an event\n * @param {Recurring} mode - the object with the recurring pattern\n * @returns {string} with the new BYDAY pattern\n */\nexport function WeekdaysToDates(sdate, mode) {\n\tlet { result, days, oldDay } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn mode.BYDAY;\n\t}\n\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tdays.splice(WEEKDAYS.indexOf(days[0]), 0, oldDay);\n\t} else {\n\t\tdays = [oldDay];\n\t}\n\treturn days.join(\",\");\n}\n\n/**\n * Returns selection parameters for the global state\n * @param {Object} obj - the event data object\n * @returns {Object} with selection parameters\n */\nexport function getParams(obj) {\n\treturn { id: obj.$id || obj.id, date: obj.$recurring ? obj.id : null };\n}\n\n/**\n * Defines the selection.date parameter of the global state\n * @typedef {(Date|string)} SDate - a Date object or the ID of an event occurrence that consists of a timestamp and the event ID from DB, separated with _\n */\n\n/**\n * Gets a date from the selection.date parameter of the global state\n * @param {(SDate)} sdate\n * @returns {Date}\n */\nexport function extractDate(sdate) {\n\treturn webix.Date.dayStart(\n\t\tsdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1)\n\t);\n}\n\n/**\n * Updates the end of a recurring event sequence\n * @param {SDate} sdate\n * @param {Object} ev - the event data object\n * @param {Boolean} block\n * @returns {string} - serialized recurrence pattern\n */\nexport function clipSequence(sdate, ev, block) {\n\tconst date = extractDate(sdate);\n\n\tif (!block || (!ev.$recurring.UNTIL || ev.$recurring.UNTIL > date))\n\t\tev.$recurring.UNTIL = date;\n\n\tif (ev.$recurring.COUNT) delete ev.$recurring.COUNT;\n\n\tif (ev.$recurring.EXDATE) {\n\t\tev.$recurring.EXDATE = ev.$recurring.EXDATE.filter(d => d < date);\n\t}\n\n\treturn serialize(ev.$recurring);\n}\n\n/**\n * Removes the specified date from the recurrence pattern\n * @param {SDate} sdate\n * @param {Object} ev - the event data object\n * @returns {string} - serialized recurrence pattern\n */\nexport function cutOccurrence(sdate, ev) {\n\tconst date = extractDate(sdate);\n\n\tif (!ev.$recurring.EXDATE) ev.$recurring.EXDATE = [];\n\tev.$recurring.EXDATE.push(date);\n\n\treturn serialize(ev.$recurring);\n}\n\n/**\n * Gets the start and end dates for a particular occurrence from a series\n * @param {Object} obj - the event data object\n * @param {SDate} sdate\n * @returns {Object} with start_date and end_date\n */\nexport function separateSequence(obj, sdate) {\n\tconst start_date =\n\t\ttypeof sdate === \"string\"\n\t\t\t? new Date(sdate.split(\"_\")[0] * 1)\n\t\t\t: new Date(sdate);\n\tconst len = (obj.end_date - obj.start_date) / 1000 / 60; // mins\n\tconst end_date = webix.Date.add(start_date, len, \"minute\", true);\n\treturn { start_date, end_date };\n}\n\n/**\n * Checks if this is the first occurrence of a series\n * @param {SDate} sdate\n * @param {Date} evStart\n * @returns {Boolean}\n */\nexport function isFirstOccurrence(sdate, evStart) {\n\t// editing 'this' event as next\n\tif (!sdate) return false;\n\n\tconst od = sdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1);\n\treturn od <= evStart;\n}\n\n/**\n * Corrects the edit mode for specific cases (depending on which occurrence was selected)\n * @param {Object} obj - the event data object\n * @param {string} mode - \"all\", \"next\", \"this\"\n * @returns {string}\n */\nexport function correctMode(obj, mode) {\n\tif (!obj.origin_id || !obj.recurring) {\n\t\tmode = \"all\";\n\t} else {\n\t\t// if this is 1st occ in 'next' which is the last part of 'all'\n\t\tif (this.app.getService(\"local\").isLastPart(obj)) {\n\t\t\tmode = \"\";\n\t\t}\n\t}\n\treturn mode;\n}\n\n/**\n * Moves a recurrence pattern if a recurring event was moved to another date\n * @param {Recurring} rec\n * @param {Object} newEvent - the new event data object\n * @param {Object} oldEvent - the old event data object\n * @returns {Recurring}\n */\nexport function movePattern(rec, newEvent, oldEvent) {\n\tlet days =\n\t\twebix.Date.dayStart(newEvent.start_date) -\n\t\twebix.Date.dayStart(oldEvent.start_date);\n\tif (days) days /= 1000 * 60 * 60 * 24;\n\n\tif (rec.UNTIL && days) {\n\t\trec.UNTIL = webix.Date.add(rec.UNTIL, days, \"day\", true);\n\t}\n\n\t// day of start_date changed and pattern doesn't have in anymore\n\tif (rec.BYDAY && days) {\n\t\tdays %= 7;\n\t\tif (days < 0) days += 7;\n\t\trec.BYDAY = rec.BYDAY.split(\",\")\n\t\t\t.map(d => WEEKDAYS[(WEEKDAYS.indexOf(d) + days) % 7])\n\t\t\t.join(\",\");\n\t}\n\n\t// in case day of start_date changed in monthly or yearly\n\tif (rec.BYMONTHDAY && days) {\n\t\tconst nmd = newEvent.start_date.getDate();\n\t\tif (nmd != rec.BYMONTHDAY) {\n\t\t\trec.BYMONTHDAY = nmd;\n\t\t}\n\t}\n\n\t// week number of start_date changed in yearly or monthly\n\tif (rec.BYSETPOS) {\n\t\tconst nwn = getWeekNum(newEvent.start_date);\n\t\tif (rec.BYSETPOS != nwn) rec.BYSETPOS = nwn;\n\t}\n\n\t// month of start_date changed in a yearly event\n\tif (rec.BYMONTH) {\n\t\tconst nm = newEvent.start_date.getMonth() + 1;\n\t\tif (nm != rec.BYMONTH) rec.BYMONTH = nm;\n\t}\n\n\treturn rec;\n}\n\n/**\n * Returns the number of a week day within a month (e.g. 3rd Wednesday)\n * @param {Date} date\n * @returns {number}\n */\nexport function getWeekNum(date) {\n\tconst day = date.getDate();\n\treturn Math.floor(day / 7) + (day % 7 ? 1 : 0);\n}\n\n/**\n * Fills incomplete recurring patterns and ensures that they are consistent with the dates of events\n * @param {Object} ev - data object of an event\n */\nexport function checkPattern(ev) {\n\tconst mode = ev.$recurring || parse(ev.recurring);\n\n\t// when exact date not configured, fill recurring config\n\tif (mode.FREQ === \"WEEKLY\" && !mode.BYDAY) {\n\t\tmode.BYDAY = WEEKDAYS[ev.start_date.getDay()];\n\t\treturn;\n\t}\n\n\tif (\n\t\t(mode.FREQ === \"MONTHLY\" || mode.FREQ === \"YEARLY\") &&\n\t\t!mode.BYSETPOS &&\n\t\t!mode.BYMONTHDAY\n\t) {\n\t\tmode.BYMONTHDAY = ev.start_date.getDate();\n\t\treturn;\n\t}\n\n\tif (mode.FREQ === \"YEARLY\" && !mode.BYMONTH) {\n\t\tmode.BYMONTH = ev.start_date.getMonth();\n\t\treturn;\n\t}\n\n\t// in case config is wrong, fix it\n\tif (mode.BYDAY) mode.BYDAY = WeekdaysToDates(ev.start_date, mode);\n\tif (mode.BYMONTHDAY) mode.BYMONTHDAY = ev.start_date.getDate();\n\tif (mode.BYMONTH) mode.BYMONTH = ev.start_date.getMonth() + 1;\n\tif (mode.BYSETPOS) mode.BYSETPOS = getWeekNum(ev.start_date);\n\n\tev.recurring = serialize(mode);\n}\n","import { JetView } from \"webix-jet\";\nimport { WEEKDAYS, fillWdays, next } from \"helpers/recurring\";\n\nexport default class RecurringFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"recurringForm\",\n\t\t\thidden: true,\n\t\t\telementsConfig: { labelPosition: \"left\" },\n\t\t\tpadding: {\n\t\t\t\ttop: aSkin.layoutPadding.form,\n\t\t\t\tbottom: 0,\n\t\t\t\tleft: compact ? aSkin.layoutPadding.form : 0,\n\t\t\t\tright: compact ? 14 : 0,\n\t\t\t},\n\t\t\tborderless: true,\n\t\t\trows: [\n\t\t\t\tthis.CreateIntervalControls(_),\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"customRecControls\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\trows: [this.CreateCheckboxes(_), this.CreateSelect(_)],\n\t\t\t\t},\n\t\t\t\tthis.CreateRadio(_),\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\tform.on = {\n\t\t\t\tonChange: (o, v, m) => this.UpdateEvent(m),\n\t\t\t};\n\t\t}\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"recurringForm\");\n\t\tthis.Events = this.app.getService(\"local\").events(true);\n\n\t\t// commonly called controls\n\t\tthis.CheckBoxContainer = this.$$(\"weekly\");\n\t\tthis.Checkboxes = this.CheckBoxContainer.getChildViews().slice(1);\n\t\tthis.Checkboxes.pop();\n\t\tthis.PatternSelect = this.$$(\"patternSelect\");\n\t\tthis.UntilDateContainer = this.$$(\"untilDate\");\n\t\tthis.UntilDateCalendar = this.Form.elements.untilDate.getPopup().getBody();\n\t\tthis.UntilNumContainer = this.$$(\"untilCount\");\n\t\tthis.UntilNum = this.UntilNumContainer.getBody();\n\t\tthis.CustomRecControls = this.$$(\"customRecControls\");\n\t}\n\n\t// methods of main controls: counter of INTERVAL and richselect of FREQ\n\n\t/**\n\t * Returns the config object for interval counter and recurrence frequency selection\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateIntervalControls(_) {\n\t\treturn {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tlabel: _(\"Every\"),\n\t\t\t\t\tlabelWidth: 50,\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tname: \"INTERVAL\",\n\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tname: \"FREQ\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"DAILY\", value: _(\"day\") },\n\t\t\t\t\t\t{ id: \"WEEKLY\", value: _(\"week\") },\n\t\t\t\t\t\t{ id: \"MONTHLY\", value: _(\"month\") },\n\t\t\t\t\t\t{ id: \"YEARLY\", value: _(\"year\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ChangeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Switches controls for detailed recurrence pattern selection depending on the frequency\n\t * @param {string} v - recurrence frequency\n\t */\n\tChangeControls(v) {\n\t\tthis._freq = v;\n\t\tif (v === \"DAILY\") {\n\t\t\tthis.CustomRecControls.hide();\n\t\t} else {\n\t\t\tthis.CustomRecControls.show();\n\t\t\tif (v === \"WEEKLY\") {\n\t\t\t\tthis.CheckBoxContainer.show();\n\t\t\t\tthis.PatternSelect.hide();\n\t\t\t} else {\n\t\t\t\tthis.CheckBoxContainer.hide();\n\t\t\t\tthis.PatternSelect.show();\n\t\t\t\tthis.PatternSelect.refresh();\n\t\t\t\tthis.PatternSelect.getList().refresh();\n\t\t\t}\n\t\t}\n\t}\n\n\t// methods of checkboxes for WEEKLY\n\n\t/**\n\t * Returns the config object for week day checkboxes\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateCheckboxes(_) {\n\t\tconst days = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tdays.push({\n\t\t\t\tview: \"checkbox\",\n\t\t\t\tlabel: webix.i18n.calendar.dayShort[i],\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t\tlabelAlign: \"center\",\n\t\t\t\tcss: \"webix_scheduler_day_checkbox\",\n\t\t\t\tinputWidth: 26,\n\t\t\t\twidth: 45,\n\t\t\t\talign: \"center\",\n\t\t\t\tname: WEEKDAYS[i],\n\t\t\t\ton: {\n\t\t\t\t\tonChange(v, o) {\n\t\t\t\t\t\tthis.$scope.CheckboxGuard(this.config.name, v, o);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tlocalId: \"weekly\",\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: _(\"on\"), width: 45 },\n\t\t\t\t...days,\n\t\t\t\t{ gravity: 0.00001 },\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Prevents the user from unchecking the only checked weekday checkbox\n\t * @param {string} day - the name of the related checkbox (SU, MO, TU, WE, TH, FR, or SA)\n\t * @param {(Boolean|number)} v - the new value of a checkbox (false/0 or true/1)\n\t * @param {(Boolean|number)} o - the old value of a checkbox (false/0 or true/1)\n\t */\n\tCheckboxGuard(day, v, o) {\n\t\tif (!webix.isUndefined(o) && !v && !this.GetBYDAY()) {\n\t\t\tthis.Form.setValues({ [day]: 1 }, true);\n\t\t}\n\t}\n\n\t/**\n\t * Sets values to weekday checkboxes according to BYDAY recurrence pattern (week days)\n\t * @param {Object} values - values from the form\n\t */\n\tSetBYDAY(values) {\n\t\tconst days = values.BYDAY.split(\",\");\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tvalues[check.config.name] = !!days.find(d => d == check.config.name);\n\t\t});\n\t}\n\n\t/**\n\t * Gets the BYDAY pattern from checkbox values\n\t * @returns {string}\n\t */\n\tGetBYDAY() {\n\t\tconst BYDAY = [];\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tif (check.getValue()) {\n\t\t\t\tBYDAY.push(check.config.name);\n\t\t\t}\n\t\t});\n\t\treturn BYDAY.join(\",\");\n\t}\n\n\t// methods of richselect with MONTHLY and YEARLY patterns\n\n\t/**\n\t * Returns the config object for a dropdown list with monthly/yearly recurrence patterns\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateSelect(_) {\n\t\treturn {\n\t\t\tview: \"richselect\",\n\t\t\tlocalId: \"patternSelect\",\n\t\t\tname: \"rec_pattern\",\n\t\t\tsuggest: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\tconst byDay = [];\n\t\t\t\t\t\tif (obj.BYDAY) {\n\t\t\t\t\t\t\tobj.BYDAY.forEach(d =>\n\t\t\t\t\t\t\t\tbyDay.push(webix.i18n.calendar.dayFull[d])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet text = `${_(\"Every\")} ${obj.BYMONTHDAY || obj.BYSETPOS} ${\n\t\t\t\t\t\t\tobj.BYDAY ? byDay.join(\", \") : \"\"\n\t\t\t\t\t\t}`;\n\t\t\t\t\t\tif (this._freq === \"YEARLY\")\n\t\t\t\t\t\t\ttext += ` ${_(\"of\")} ${\n\t\t\t\t\t\t\t\twebix.i18n.calendar.monthFull[obj.BYMONTH - 1]\n\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Describes calculated constants of a date\n\t * @typedef {Object} DateInfo\n\t * @property {number} day - the date (day of month)\n\t * @property {number} weekday - the number of a weekday (0-6)\n\t * @property {number} month - the number of month (0-11)\n\t * @property {number} weekNum - the number of a weekday within a month (e.g. 4th Friday)\n\t */\n\n\t/**\n\t * Sets pattern options for the dropdown list (monthly and yearly events)\n\t * @param {Object} ev - values from the form\n\t * @param {DateInfo} calculated - calculated constants of a date\n\t */\n\tSetPatternOptions(ev, calculated) {\n\t\tthis.PatternSelect.getList().parse([\n\t\t\t{\n\t\t\t\tid: 1,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t\tBYMONTHDAY: ev.BYMONTHDAY || calculated.day,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 2,\n\t\t\t\tBYSETPOS: ev.BYSETPOS || calculated.weekNum,\n\t\t\t\tBYDAY: [calculated.weekday],\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t},\n\t\t]);\n\t\tthis._freq = ev.FREQ;\n\n\t\tev.rec_pattern = ev.BYSETPOS ? 2 : 1;\n\t}\n\n\t/**\n\t *\n\t * @param {Object} values - values from the form\n\t */\n\tGetRecPattern(values) {\n\t\tconst data = webix.copy(\n\t\t\tthis.PatternSelect.getList().getItem(values.rec_pattern)\n\t\t);\n\n\t\tif (this._freq === \"MONTHLY\") delete data.BYMONTH;\n\t\tif (data.BYDAY) data.BYDAY = data.BYDAY.map(d => WEEKDAYS[d]).join(\",\");\n\t\tdelete data.id;\n\n\t\treturn data;\n\t}\n\n\t// methods of radio for UNTIL\n\n\t/**\n\t * Returns the config object for the radio with options for setting the end of repetition\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateRadio(_) {\n\t\tconst selectors = {\n\t\t\twidth: 130,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilDate\",\n\t\t\t\t\talign: \"middle\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\tname: \"untilDate\",\n\t\t\t\t\t\ticons: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilCount\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\talign: \"bottom\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tname: \"untilCount\",\n\t\t\t\t\t\tview: \"counter\",\n\t\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{ view: \"label\", label: _(\"End repeat\") },\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\tname: \"until\",\n\t\t\t\t\t\t\tlocalId: \"until\",\n\t\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: 1, value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: 2, value: _(\"date\") },\n\t\t\t\t\t\t\t\t{ id: 3, value: _(\"after several occurrences\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: v => this.ChangeSelectors(v),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectors,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Switches controls for dates or numbers for setting the end of repetition\n\t * @param {(number|string)} v - the value of the radio that sets the type of repetition end (1,2,3)\n\t */\n\tChangeSelectors(v) {\n\t\tthis.UntilDateContainer[v === \"2\" ? \"show\" : \"hide\"]();\n\t\tthis.UntilNumContainer[v === \"3\" ? \"show\" : \"hide\"]();\n\t}\n\n\t/**\n\t * Sets the values of controls that are used to choose the end of repetition\n\t * @param {Object} values - values from the form\n\t */\n\tSetUNTIL(values) {\n\t\tconst start = this._StartDate;\n\t\tvalues.until = values.COUNT ? 3 : values.UNTIL ? 2 : 1;\n\t\tvalues.untilDate = values.UNTIL || webix.Date.add(start, 1, \"year\", true);\n\t\tvalues.untilCount = values.COUNT || this.CountNum(values);\n\t\tthis.UntilDateCalendar.define({ minDate: start });\n\t}\n\n\t/**\n\t * Calculates the number of occurrences based on the end date of repetition (UNTIL)\n\t * @param {Object} values - values from the form\n\t */\n\tCountNum(values) {\n\t\tlet res = 0;\n\n\t\tif (values.UNTIL) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(this._StartDate);\n\n\t\t\twhile (date <= values.UNTIL) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t\tres++;\n\t\t\t}\n\t\t} else {\n\t\t\tres = 3;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t// subform methods\n\n\t/**\n\t * Sets values into this form\n\t * @param {Object} event - the event data object\n\t * @param {DateInfo} calculated - calculated constants of a date\n\t * @param {Boolean} silent - if true, the form is marked as 'saved' (containing no unsaved values)\n\t */\n\tSetValues(event, calculated, silent) {\n\t\tif (!calculated) return this.Form.setValues(event, true);\n\n\t\tthis._StartDate = event.start_date;\n\t\tlet values = event.$recurring;\n\n\t\tif (!values) {\n\t\t\tvalues = { FREQ: \"DAILY\" };\n\t\t}\n\n\t\tif (!values.INTERVAL) values.INTERVAL = 1;\n\t\tif (!values.BYDAY) {\n\t\t\tvalues.BYDAY = WEEKDAYS[calculated.weekday];\n\t\t}\n\n\t\t// for a reset\n\t\tif (!values.EXDATE) values.EXDATE = [];\n\n\t\tthis.SetUNTIL(values);\n\t\tthis.SetBYDAY(values);\n\t\tthis.SetPatternOptions(values, calculated);\n\t\tthis.Form.setValues(values, true);\n\t\tif (silent) this.Form.setDirty();\n\t}\n\n\t/**\n\t * Defines the object that stores the recurring pattern, for more details please refer to the iCalendar docs https://icalendar.org/iCalendar-RFC-5545/3-8-5-3-recurrence-rule.html\n\t * @typedef {Object} Recurring\n\t * @property {string} FREQ - the step of repetition: DAILY, WEEKLY, MONTHLY, YEARLY\n\t * @property {(number|string)} INTERVAL - how many steps are between occurrences\n\t * @property {string} BYDAY - week days, e.g. SU,MO,TU,WE,TH,FR,SA\n\t * @property {(number|string)} BYMONTH - the number or a month (1-12)\n\t * @property {(number|string)} BYMONTHDAY - the date (day of a month)\n\t * @property {(number|string)} BYSETPOS - the number of the week day within a month\n\t * @property {string} UNTIL - a date like 19970902T090000\n\t * @property {(number|string)} COUNT - how many times the event repeats\n\t * @property {string} EXDATE - string with 1 or more dates, on which the event does not repeat, e.g. 19960402T010000Z,19960403T010000Z,19960404T010000Z\n\t */\n\n\t/**\n\t * Collects recurrence pattern object from form values and returns it\n\t * @returns {Recurring} the object that stores the recurring pattern\n\t */\n\tGetValues() {\n\t\tlet values = this.Form.getValues();\n\n\t\tlet res = {\n\t\t\tFREQ: values.FREQ,\n\t\t\tINTERVAL: values.INTERVAL,\n\t\t\tUNTIL: values.until == 2 ? values.untilDate : this.GetUntil(values),\n\t\t\tCOUNT: values.until == 3 ? values.untilCount : null,\n\t\t\tEXDATE: values.EXDATE || [],\n\t\t};\n\n\t\tif (values.FREQ === \"WEEKLY\") {\n\t\t\tres.BYDAY = this.GetBYDAY(values);\n\t\t} else if (values.FREQ === \"MONTHLY\" || values.FREQ === \"YEARLY\") {\n\t\t\tres = webix.extend(res, this.GetRecPattern(values));\n\t\t}\n\n\t\tthis.Form.setDirty();\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * Calculates the end of repetition as date based on COUNT\n\t * @param {Object} values - values from the form\n\t * @returns {Date}\n\t */\n\tGetUntil(values) {\n\t\tif (values.until == 3) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(this._StartDate);\n\t\t\tfor (let i = 1; i < values.untilCount; ++i) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t}\n\t\t\tdate = webix.Date.add(date, 1, \"day\", true);\n\t\t\tthis.Form.setValues({ untilDate: date }, true);\n\t\t\treturn date;\n\t\t} else return null;\n\t}\n\n\t/**\n\t * Collects all values and sends them to the master form for event update (via global app event)\n\t * @param {string} mode - \"user\" means that the change was made via UI\n\t */\n\tUpdateEvent(mode) {\n\t\tif (mode === \"user\") {\n\t\t\tconst change = this.GetValues();\n\t\t\tthis.app.callEvent(\"form:update:recurring\", [{ $recurring: change }]);\n\t\t\tthis.Form.setDirty();\n\t\t}\n\t}\n\n\t/**\n\t * Checks if this form has changed values\n\t * @returns {Boolean}\n\t */\n\tIsDirty() {\n\t\treturn this.Form.isDirty();\n\t}\n\n\t/**\n\t * Shows this form\n\t */\n\tShow() {\n\t\tthis.getRoot().show();\n\t}\n\n\t/**\n\t * Hides this form\n\t */\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import {\n\tisFirstOccurrence,\n\tcorrectMode,\n\textractDate,\n\tFREQUENCE,\n\tfillWdays,\n\tnext,\n} from \"./recurring\";\n\n/* public functions */\n\n/**\n * Changes the mode if the user selected the 1st occurrence in whole sequence or in 'next'\n * @param {string} mode - the mode of editing a recurring event (\"all\", \"next\", \"this\")\n * @param {object} obj - the event object\n * @param {Date} start - the start date of the event\n * @param {Date, string} date_id - the ID of an occurrence of a repeated event or the date of this occurrence\n */\nfunction changeMode(mode, obj, start, date_id) {\n\tif (mode && mode === \"next\" && isFirstOccurrence(date_id, start)) {\n\t\tmode = correctMode.call(this, obj, mode);\n\t}\n\n\treturn mode;\n}\n\n/**\n * Corrects recurring.COUNT or recurring.UNTIL based on all sub-events that are included in the edited range\n * @param {Object} obj - the event data\n * @param {string} mode - the mode of recurring editing (\"all\", \"next\")\n * @param {Date} sdate - the date of the currently selected event occurrence\n * @param {Object} collection - DataCollection of events\n */\nfunction correctCountUntil(obj, mode, sdate, collection) {\n\tconst oid = obj.origin_id || obj.$id || obj.id;\n\tconst parts = collection\n\t\t.find(e => {\n\t\t\treturn oid == e.origin_id && sdate < e.start_date;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tif (a.start_date > b.start_date) return -1;\n\t\t\tif (a.start_date < b.start_date) return 1;\n\t\t\treturn 0;\n\t\t});\n\n\tconst rec = webix.copy(obj.$recurring);\n\n\tfor (let i = 0, last; i < parts.length; ++i) {\n\t\tlast = parts[i];\n\n\t\tif (last.$recurring) {\n\t\t\tif (last.$recurring.COUNT) {\n\t\t\t\tif (rec.COUNT && obj.$id != last.id) {\n\t\t\t\t\trec.COUNT = rec.COUNT * 1 + last.$recurring.COUNT * 1;\n\t\t\t\t} else {\n\t\t\t\t\trec.UNTIL = countToUntil(last);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trec.UNTIL = last.$recurring.UNTIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (mode === \"next\" && !parts.length) {\n\t\tif (rec.COUNT) {\n\t\t\trec.COUNT = cutCount(obj, sdate);\n\t\t} else if (rec.UNTIL && obj.start_date >= rec.UNTIL) {\n\t\t\trec.UNTIL = webix.Date.add(\n\t\t\t\twebix.Date.dayStart(obj.start_date),\n\t\t\t\t1,\n\t\t\t\tFREQUENCE[rec.FREQ],\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\treturn rec;\n}\n\n/**\n * Checks if the selected repeating event has only 1 occurrence\n * @param {Object} obj - the event data\n */\nfunction hasOneOccurrence(obj) {\n\t// as this a 'this' event\n\tif (!obj.recurring) return true;\n\n\t// as 'this' any occurrence in unedited sequence\n\tif (!obj.$recurring.UNTIL) return false;\n\n\tconst end = webix.Date.dayStart(webix.Date.add(obj.end_date, 1, \"day\", true));\n\treturn webix.Date.equal(end, obj.$recurring.UNTIL);\n}\n\n/* EO public functions */\n\n/* private functions */\nfunction countToUntil(last) {\n\tconst lr = last.$recurring;\n\tlet step = lr.COUNT * 1; // !\n\tif (lr.FREQ === \"WEEKLY\") {\n\t\tstep = Math.floor((lr.BYDAY.split(\",\").length / 7) * lr.COUNT);\n\t}\n\treturn webix.Date.add(last.start_date, step, FREQUENCE[lr.FREQ], true);\n}\n\nfunction cutCount(obj, sdate) {\n\tconst date = extractDate(sdate);\n\n\tconst consts = {};\n\tfillWdays(obj.$recurring, consts);\n\tlet nexto = webix.Date.dayStart(obj.start_date);\n\tlet count = 0;\n\twhile (nexto < date) {\n\t\tcount++;\n\t\tnexto = next(nexto, obj.$recurring, consts);\n\t}\n\treturn obj.$recurring.COUNT - count;\n}\n/* EO private functions */\n\nexport default function EditRecurringMixin(child) {\n\tchild.ChangeMode = changeMode;\n\tchild.CorrectCountUntil = correctCountUntil;\n\tchild.HasOneOccurrence = hasOneOccurrence;\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nimport {\n\tWEEKDAYS,\n\tfillWdays,\n\tnext,\n\tdatesToWeekdays,\n\tWeekdaysToDates,\n\tclipSequence,\n\tcutOccurrence,\n\tseparateSequence,\n} from \"helpers/recurring\";\nimport { serialize } from \"helpers/ical\";\nimport RecurringFormView from \"./recurringform\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class EventFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\ttooltip: _(\"Close\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: _(\"Edit event\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\thotkey: \"Ctrl+Enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\tpadding: { right: 14 },\n\t\t\telementsConfig: { labelPosition: \"top\" },\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", label: _(\"Event\"), name: \"text\" },\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\trows: [\n\t\t\t\t\t\tthis.GetDateTime(\"start\", _, aSkin),\n\t\t\t\t\t\tthis.GetDateTime(\"end\", _, aSkin),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tname: \"all_day\",\n\t\t\t\t\tlabelPosition: \"left\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"All Day\"),\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleTimeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.CreateCalendarColor(_),\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (v, o, m) => {\n\t\t\t\t\t// some fields need preprocessing\n\t\t\t\t\tconst change = this.Form.getDirtyValues();\n\t\t\t\t\tif (Object.keys(change).length) this.PrepareChange(change, o);\n\t\t\t\t\tif (!this.Compact && m === \"user\")\n\t\t\t\t\t\tthis.Wait(() => this.UpdateEvent(change));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (this.app.config.recurring)\n\t\t\tform.elements.splice(3, 0, this.CreateRepeat(_, aSkin));\n\n\t\tif (this.app.config.units) {\n\t\t\tconst index = this.app.config.recurring ? 5 : 4;\n\t\t\tform.elements.splice(index, 0, this.CreateUnitSelector(_));\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tlet index = this.app.config.recurring ? 5 : 4;\n\t\t\tif (this.app.config.units) index++;\n\t\t\tform.elements.splice(index, 0, this.CreateSectionSelector(_));\n\t\t}\n\n\t\tconst config = {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [toolbar, form],\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"form\");\n\t\tthis.Local = this.app.getService(\"local\").events(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\t// extending this class with common methods for editing of recurring events\n\t\tEditRecurringMixin(this);\n\n\t\t// most commonly called controls\n\t\tthis.RecurringOptions = this.$$(\"recOption\");\n\t\tthis.StartTime = this.$$(\"startTime\");\n\t\tthis.EndTime = this.$$(\"endTime\");\n\n\t\tthis.on(this.State.$changes, \"readonly\", (_v, o) => {\n\t\t\tif (!webix.isUndefined(o)) this.Close();\n\t\t});\n\n\t\tthis.on(this.app, \"form:update:recurring\", update => {\n\t\t\t// 'update' as imitated dirty value\n\t\t\tif (Object.keys(update).length) this.PrepareChange(update);\n\t\t\tthis.UpdateEvent(update);\n\t\t});\n\n\t\t// parse lists that are not data dependable\n\t\tconst local = this.app.getService(\"local\");\n\t\tif (this.app.config.calendars) {\n\t\t\tthis.Calendars = local.calendars(true);\n\t\t\tthis.$$(\"calendar\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Calendars);\n\t\t}\n\n\t\tif (this.app.config.units) {\n\t\t\tconst waitUnits = local.units();\n\t\t\tconst combo = this.Form.elements[\"units\"];\n\t\t\twaitUnits.then(units => {\n\t\t\t\tcombo.getList().parse(units);\n\t\t\t\tcombo.refresh();\n\t\t\t});\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tthis.Sections = local.sections(true);\n\t\t\tthis.$$(\"sections\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Sections);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.SubForm = this.getSubView(\"recurringForm\");\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.ClearTempEvent(); // support double clicks and 'Create' at any moment\n\t\t\t\tthis.Wait(() => this.FillForm(v));\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.ClearTempEvent();\n\t}\n\n\t/**\n\t * Returns the config controls for editing recurring patterns of events\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tCreateRepeat(_, aSkin) {\n\t\tconst rows = [\n\t\t\t{ view: \"label\", label: _(\"Repeat\"), height: aSkin.labelTopHeight },\n\t\t\t{\n\t\t\t\tmargin: 4,\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\t\tlocalId: \"recOption\",\n\t\t\t\t\t\tname: \"rec_option\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t{ id: \"none\", value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: \"daily\", value: _(\"daily\") },\n\t\t\t\t\t\t\t\t{ id: \"weekly\" },\n\t\t\t\t\t\t\t\t{ id: \"monthly\" },\n\t\t\t\t\t\t\t\t{ id: \"yearly\" },\n\t\t\t\t\t\t\t\t{ id: \"work\", value: _(\"every working day\") },\n\t\t\t\t\t\t\t\t{ id: \"custom\", value: _(\"custom\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonChange: (v, o) => this.ToggleSubform(v, o),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows[1].cols.push({\n\t\t\t\tlocalId: \"editCustomRec\",\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\ttooltip: _(\"Change recurring pattern\"),\n\t\t\t\thidden: true,\n\t\t\t\tclick: () => this.ShowSubForm(),\n\t\t\t});\n\t\t}\n\n\t\trows.push({ $subview: RecurringFormView, name: \"recurringForm\" });\n\n\t\treturn { localId: \"repeatControls\", rows: rows };\n\t}\n\n\t/**\n\t * Hides or shows time selectors\n\t * @param {number} v - the value of 'all day' checkbox (1 or 0)\n\t */\n\tToggleTimeControls(v) {\n\t\tif (v == 1) {\n\t\t\tthis.StartTime.hide();\n\t\t\tthis.EndTime.hide();\n\t\t} else {\n\t\t\tthis.StartTime.show();\n\t\t\tthis.EndTime.show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the subform for editing recurring pattern; the subform is shown when v is 'custom'\n\t * @param {string} v - the new recurring pattern option\n\t * @param {string} o  - the new recurring pattern option\n\t */\n\tToggleSubform(v, o) {\n\t\tif (v === \"custom\") {\n\t\t\tif (this.Compact) {\n\t\t\t\tthis.$$(\"editCustomRec\").show();\n\t\t\t\tif (o) this.ShowSubForm();\n\t\t\t} else {\n\t\t\t\tthis.SubForm.Show();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.SubForm.Hide();\n\t\t\tif (this.Compact) this.$$(\"editCustomRec\").hide();\n\t\t}\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateCalendarColor(_) {\n\t\tconst ui = {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\tname: \"color\",\n\t\t\t\t\tvalue: \"#1abc9c\",\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\tif (this.app.config.calendars) {\n\t\t\tui.cols.unshift({\n\t\t\t\tview: \"richselect\",\n\t\t\t\tlocalId: \"calendar\",\n\t\t\t\tlabel: _(\"Calendar\"),\n\t\t\t\tname: \"calendar\",\n\t\t\t\tcss: \"webix_scheduler_cal_color\",\n\t\t\t\toptions: {\n\t\t\t\t\tcss: \"webix_scheduler_cal_color_suggest\",\n\t\t\t\t\tdata: [],\n\t\t\t\t\tbody: {\n\t\t\t\t\t\ttooltip: () => \"\",\n\t\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\t\tconst active = obj.active * 1;\n\t\t\t\t\t\t\tconst css = active ? \"\" : \"class='webix_scheduler_cal_disabled'\";\n\t\t\t\t\t\t\tconst tooltip = active\n\t\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t\t: `webix_tooltip=\"${_(\"Inactive calendar\")}\"`;\n\n\t\t\t\t\t\t\treturn `<div style=\"overflow: hidden;\" ${tooltip} ${css}>${obj.text ||\n\t\t\t\t\t\t\t\t_(\"(no title)\")}\n\t\t\t\t\t\t\t\t<span class=\"webix_scheduler_cal_marker\" style=\"background-color:${obj.color};\">\n\t\t\t\t\t\t\t</span></div>`;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateUnitSelector(_) {\n\t\tconst ui = {\n\t\t\tview: \"multicombo\",\n\t\t\tname: \"units\",\n\t\t\tlabel: _(\"Units\"),\n\t\t\toptions: [],\n\t\t};\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of controls for selecting date and time\n\t * @param {string} type - \"start\" or \"end\"\n\t * @param {function*} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tGetDateTime(type, _, aSkin) {\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: aSkin.labelTopHeight,\n\t\t\t\t\tlabel: type === \"start\" ? _(\"Start\") : _(\"End\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: `${type}_date`,\n\t\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\t\ttype: \"calendar\",\n\t\t\t\t\t\t\t\ticons: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tlocalId: `${type}Time`,\n\t\t\t\t\t\t\tname: `${type}_time`,\n\t\t\t\t\t\t\ttype: \"time\",\n\t\t\t\t\t\t\tformat: \"%H:%i\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tCreateSectionSelector(_) {\n\t\treturn {\n\t\t\tlocalId: \"sections\",\n\t\t\tview: \"richselect\",\n\t\t\tlabel: _(\"Section\"),\n\t\t\tname: \"section\",\n\t\t\toptions: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: \"#text#\",\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t// general form tasks\n\n\t/**\n\t * Fills the form with relevant values for editing of a selected event or adding a new event\n\t * @param {Object} ev - the current state.selected\n\t */\n\tFillForm(ev) {\n\t\tthis.Form.focus();\n\n\t\tthis.Id = ev.id;\n\n\t\tthis.Form.focus();\n\t\tthis.Date = ev.date;\n\t\tif (typeof this.Date === \"string\") {\n\t\t\tthis.Date = new Date(this.Date.slice(0, this.Date.indexOf(\"_\")) * 1);\n\t\t}\n\n\t\tlet obj;\n\n\t\t// new record\n\t\tif (ev.id == \"0\") {\n\t\t\tobj = this.NewEvent(ev);\n\t\t\tif (obj.then) {\n\t\t\t\treturn obj.then(res => {\n\t\t\t\t\tthis.Local.add({ id: ev.id, ...webix.copy(res) });\n\t\t\t\t\tthis.FillFormContinue(res);\n\t\t\t\t});\n\t\t\t} else this.Local.add({ id: ev.id, ...webix.copy(obj) });\n\t\t} else {\n\t\t\tobj = webix.copy(this.Local.getItem(ev.id));\n\n\t\t\tconst mode = this.getParam(\"mode\", true);\n\t\t\tif (mode) obj = this.AdaptObjToMode(mode, obj);\n\t\t}\n\n\t\tthis.FillFormContinue(obj);\n\t}\n\n\t/**\n\t * Fills the event object with relevant values according to the mode of editing\n\t * @param {string} mode - mode in which a recurring event will be edited (\"all\", \"next\", \"this\")\n\t * @param {Object} obj - event data\n\t */\n\tAdaptObjToMode(mode, obj) {\n\t\tmode = this.ChangeMode(\n\t\t\tmode,\n\t\t\tobj,\n\t\t\tobj.recurring\n\t\t\t\t? obj.start_date\n\t\t\t\t: this.Local.getItem(obj.origin_id).start_date,\n\t\t\tobj.recurring ? this.State.selected.date : obj.start_date\n\t\t);\n\t\tthis.setParam(\"mode\", mode, true);\n\n\t\tif (mode === \"all\" || mode === \"next\") {\n\t\t\tif (mode === \"all\" && obj.origin_id) {\n\t\t\t\tobj = webix.copy(this.Local.getItem(obj.origin_id));\n\t\t\t}\n\n\t\t\t// if this is a \"this\" sub-event\n\t\t\tif (!obj.$recurring)\n\t\t\t\tobj.$recurring = webix.copy(\n\t\t\t\t\tthis.Local.getItem(obj.origin_id).$recurring\n\t\t\t\t);\n\n\t\t\tif (obj.$recurring.COUNT || obj.$recurring.UNTIL) {\n\t\t\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\t\t\tobj.$recurring = this.CorrectCountUntil(\n\t\t\t\t\tobj,\n\t\t\t\t\tmode,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tthis.Local\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t// split event sequence or cut out an occurrence\n\t\t\tif (this.State.selected.date)\n\t\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\n\t\t\tif (mode === \"this\") {\n\t\t\t\tobj.$recurring = null;\n\t\t\t\tobj.recurring = \"\";\n\t\t\t\tthis.$$(\"repeatControls\").hide();\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Splits start and end dates into date and time parts and fills the form with values\n\t * @param {Object} obj - the event data\n\t */\n\tFillFormContinue(obj) {\n\t\tobj.start_time = webix.Date.copy(obj.start_date);\n\t\tobj.end_time = webix.Date.copy(obj.end_date);\n\n\t\tobj.start_date = webix.Date.datePart(obj.start_date);\n\t\tobj.end_date = webix.Date.datePart(obj.end_date);\n\n\t\tif (this.app.config.recurring) this.SetRecurring(obj);\n\n\t\tthis.Form.setValues(obj);\n\t}\n\n\t/**\n\t * Describes calculated constants of a date\n\t * @typedef {Object} DateInfo\n\t * @property {number} day - the date (day of month)\n\t * @property {number} weekday - the number of a weekday (0-6)\n\t * @property {number} month - the number of month (0-11)\n\t * @property {number} weekNum - the number of a weekday within a month (e.g. 4th Friday)\n\t */\n\n\t/**\n\t * Calculates constants related to the start date of an event\n\t * @param {Date} start - the start date of an event\n\t * @returns {DateInfo}\n\t */\n\tGetFromStartDate(start) {\n\t\tconst res = {\n\t\t\tweekday: start.getDay(),\n\t\t\tday: start.getDate(),\n\t\t\tmonth: start.getMonth(),\n\t\t};\n\t\tres.weekNum = Math.floor(res.day / 7) + (res.day % 7 ? 1 : 0);\n\t\treturn res;\n\t}\n\n\t/**\n\t * Sets controls and their values for recurring patterns\n\t * @param {Object} obj - the event data\n\t */\n\tSetRecurring(obj) {\n\t\tconst today = this.GetFromStartDate(obj.start_date);\n\t\tconst roptions = this.ResetRecurringOptions(today);\n\t\tthis.RecurringOptions.getList().parse(roptions);\n\n\t\tthis.SubForm.SetValues(webix.copy(obj), today, true);\n\n\t\tif (!obj.$recurring) {\n\t\t\tobj.rec_option = \"none\";\n\t\t} else if (obj.$recurring.BYDAY === \"MO,TU,WE,TH,FR\") {\n\t\t\tobj.rec_option = \"work\";\n\t\t} else if (\n\t\t\t!obj.$recurring.UNTIL &&\n\t\t\t!obj.$recurring.COUNT &&\n\t\t\t(!obj.$recurring.INTERVAL || obj.$recurring.INTERVAL == 1) &&\n\t\t\t(obj.$recurring.FREQ === \"DAILY\" ||\n\t\t\t\t(obj.$recurring.FREQ === \"WEEKLY\" &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"MONTHLY\" &&\n\t\t\t\t\tobj.$recurring.BYSETPOS &&\n\t\t\t\t\tobj.$recurring.BYSETPOS == today.weekNum &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"YEARLY\" &&\n\t\t\t\t\tobj.$recurring.BYMONTH == today.month + 1 &&\n\t\t\t\t\tobj.$recurring.BYMONTHDAY == today.day))\n\t\t) {\n\t\t\tobj.rec_option = obj.$recurring.FREQ.toLowerCase();\n\t\t} else {\n\t\t\tobj.rec_option = \"custom\";\n\t\t}\n\t}\n\n\t/**\n\t * Returns date-dependent options for recurring pattern select list\n\t * @param {Date} start - the start date of an event\n\t */\n\tResetRecurringOptions(start) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"weekly\",\n\t\t\t\tvalue: `${_(\"weekly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"monthly\",\n\t\t\t\tvalue: `${_(\"monthly, every\")} ${start.weekNum} ${_(\"week on\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"yearly\",\n\t\t\t\tvalue: `${_(\"yearly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.monthFull[start.month]\n\t\t\t\t} ${start.day}`,\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Joins date and time into one Date object\n\t * @param {Date} date - a date without a time part\n\t * @param {Date} time - a date with a time part\n\t */\n\tJoin(date, time) {\n\t\treturn webix.Date.add(date, webix.Date.timePart(time) / 60, \"minute\", true);\n\t}\n\n\t/**\n\t * Returns an object with values for adding a new event\n\t * @param {Object} params - current state.selected property\n\t */\n\tNewEvent(params) {\n\t\tconst start = this.GetStartDate();\n\t\tconst end = webix.Date.add(start, 1, \"hour\", true);\n\n\t\tconst obj = {\n\t\t\tstart_date: start,\n\t\t\tend_date: end,\n\t\t\ttext: \"\",\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.app.config.recurring) obj.recurring = \"\";\n\t\tif (this.app.config.timeline) {\n\t\t\tobj.section = params.section || this.Sections.getFirstId();\n\t\t}\n\n\t\tif (this.app.config.calendars) {\n\t\t\tlet active = this.State.active[0];\n\t\t\tif (!active) {\n\t\t\t\tconst first = this.Calendars.getFirstId();\n\t\t\t\tconst wait = first\n\t\t\t\t\t? this.Ops.updateCalendar(first, { active: 1 })\n\t\t\t\t\t: this.Ops.addCalendar();\n\n\t\t\t\treturn wait.then(() => {\n\t\t\t\t\tobj.calendar = this.State.active[0];\n\t\t\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t\t\t\treturn obj;\n\t\t\t\t});\n\t\t\t}\n\t\t\tobj.calendar = active;\n\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t} else obj.$color = \"#01C2A5\"; //same for default color in datacollection\n\n\t\tif (this.app.config.calendars && params.unit) {\n\t\t\tobj.units = params.unit;\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Returns a start date of a new object based on:\n\t * 1) the origin of the double click of the user\n\t * 2) the current date and time\n\t */\n\tGetStartDate() {\n\t\tif (this.Date) {\n\t\t\treturn webix.Date.copy(this.Date);\n\t\t} else {\n\t\t\tconst date = new Date();\n\t\t\tconst minutes = Math.ceil(date.getMinutes() / 30) * 30;\n\t\t\tconst res = webix.Date.copy(this.State.date);\n\t\t\tres.setHours(date.getHours(), minutes);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\t/**\n\t * Launches saving of changes made in the form\n\t * @param {Object} change - an object with changed values\n\t */\n\tUpdateEvent(change) {\n\t\t// clear 'dirty' flag so that next change will definitely be 'dirty'\n\t\tthis.Form.setDirty();\n\n\t\tlet sid = this.Id;\n\t\tif (sid === \"0\") {\n\t\t\tthis._inProgress = this.Ops.addEvent(this.PrepareOut(change), true, sid);\n\t\t} else if (Object.keys(change).length) {\n\t\t\tlet mode = this.getParam(\"mode\", true);\n\t\t\tconst obj = this.Local.getItem(sid);\n\n\t\t\tif ((mode === \"this\" && !this.HasOneOccurrence(obj)) || mode === \"next\") {\n\t\t\t\t// cut out occurrence or split event sequence and save as separate events\n\t\t\t\tchange.origin_id = obj.origin_id || obj.id;\n\t\t\t\tconst newEvent = this.PrepareOut(change);\n\n\t\t\t\tlet recurring = \"\";\n\t\t\t\tif (mode === \"this\") {\n\t\t\t\t\trecurring = cutOccurrence(this.State.selected.date, obj);\n\t\t\t\t} else {\n\t\t\t\t\tlet params;\n\t\t\t\t\tif (obj.recurring) {\n\t\t\t\t\t\tparams = [this.State.selected.date, obj];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsid = obj.origin_id;\n\t\t\t\t\t\tparams = [newEvent.start_date, this.Local.getItem(sid)];\n\t\t\t\t\t}\n\t\t\t\t\trecurring = clipSequence(...params);\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(\n\t\t\t\t\tsid,\n\t\t\t\t\t{ recurring },\n\t\t\t\t\tmode,\n\t\t\t\t\twebix.Date.dayStart(newEvent.start_date),\n\t\t\t\t\ttrue\n\t\t\t\t).then(() => {\n\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t\treturn this.Ops.addEvent(newEvent, true);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// non-recurring and recurring in mode \"all\"\n\n\t\t\t\tif (mode === \"all\") {\n\t\t\t\t\tconst recVals = this.Form.getValues().$recurring;\n\t\t\t\t\tif (recVals && webix.isUndefined(change.recurring)) {\n\t\t\t\t\t\tdelete recVals.EXDATE;\n\t\t\t\t\t\tchange.recurring = serialize(recVals); // plus all that's been updated in form silently in FillForm\n\n\t\t\t\t\t\tthis.Form.setValues(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$recurring: recVals,\n\t\t\t\t\t\t\t\trecurring: change.recurring,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.SubForm.SetValues({ EXDATE: null });\n\t\t\t\t\t}\n\n\t\t\t\t\tif (obj.origin_id) this.Id = this.State.selected.id = obj.origin_id;\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(\n\t\t\t\t\tthis.Id,\n\t\t\t\t\tchange,\n\t\t\t\t\tmode,\n\t\t\t\t\tundefined,\n\t\t\t\t\ttrue\n\t\t\t\t).then(() => {\n\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this._inProgress) {\n\t\t\tthis.app.callEvent(\"backend:operation\", [this._inProgress]);\n\t\t\tthis._inProgress\n\t\t\t\t.then(id => {\n\t\t\t\t\tif (id) this.UpdateSelected(id);\n\n\t\t\t\t\t// make event visible if new dates are outside currently selected dates\n\t\t\t\t\tthis.ChangeDate(change, this.Form.getValues());\n\n\t\t\t\t\t// continue editing in simple mode\n\t\t\t\t\tthis.setParam(\"mode\", \"\", true);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._inProgress = null;\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._inProgress || webix.promise.resolve();\n\t}\n\n\t// if event was saved as new, update selected silently to avoid triggering listeners\n\tUpdateSelected(id) {\n\t\tthis.State.selected.id = this.Id = id;\n\t\tif (this.State.selected.date instanceof Date) {\n\t\t\tthis.State.selected.date = null;\n\t\t} else {\n\t\t\tconst fvals = this.Form.getValues();\n\t\t\tthis.State.selected.date =\n\t\t\t\tthis.Join(fvals.start_date, fvals.start_time).valueOf() + \"_\" + id;\n\t\t}\n\t}\n\n\t/**\n\t * Processes changes made in the form and prepares values for saving to the server\n\t * @param {Object} change - an object with changed values\n\t * @param {any} prev - an old value from the control where a value was changed\n\t */\n\tPrepareChange(change, prev) {\n\t\tif (change.rec_option) this.ProcessRecurringOption(change);\n\t\telse if (!webix.isUndefined(change.$recurring)) {\n\t\t\tthis.ProcessRecurringPattern(change);\n\t\t}\n\n\t\tthis.ProcessDates(change);\n\n\t\tif (this.app.config.recurring && change.start_date)\n\t\t\tthis.ApplyDatechangeToRecurring(change);\n\n\t\tthis.ProcessText(change, \"text\", prev);\n\t\tthis.ProcessText(change, \"details\", prev);\n\n\t\tthis._changedValues = change;\n\t}\n\n\t/**\n\t * Gets recurring pattern according to the new recurring option\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessRecurringOption(change) {\n\t\tconst fvals = this.Form.getValues();\n\n\t\tif (change.rec_option === \"none\") {\n\t\t\tchange.recurring = \"\";\n\t\t\tchange.series_end_date = \"\";\n\t\t} else if (change.rec_option === \"custom\") {\n\t\t\tif (fvals.$recurring) {\n\t\t\t\tthis.SubForm.SetValues(\n\t\t\t\t\t{ ...fvals, ...change },\n\t\t\t\t\tthis.GetFromStartDate(fvals.start_date)\n\t\t\t\t);\n\t\t\t}\n\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\tthis.ProcessRecurringPattern(change);\n\n\t\t\tif (!fvals.$recurring) {\n\t\t\t\tthis.Form.setValues({ $recurring: change.$recurring }, true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.GetRecurring(change.rec_option, change, fvals.start_date);\n\t\t\tchange.series_end_date = \"\";\n\t\t}\n\n\t\tdelete change.rec_option;\n\t\tdelete change.$recurring;\n\t}\n\n\t/**\n\t * Serializes recurring pattern object and synchronizes dates with the new pattern\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessRecurringPattern(change) {\n\t\tconst fvals = this.Form.getValues();\n\t\tconst recurring = serialize(change.$recurring);\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\n\t\t// check if switch from a preset to custom and back and the pattern is the same\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.recurring = recurring;\n\t\t\tchange.series_end_date = change.$recurring.UNTIL;\n\n\t\t\tif (change.$recurring.BYDAY) {\n\t\t\t\t[change.start_date, change.end_date] = datesToWeekdays(\n\t\t\t\t\tfvals.start_date,\n\t\t\t\t\tfvals.end_date,\n\t\t\t\t\tchange.$recurring\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.Form.setValues(change, true);\n\t\t}\n\t\tdelete change.$recurring;\n\t}\n\n\t/**\n\t * Sums up dates and time depending on the changes in dates, time and all_day flag\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessDates(change) {\n\t\tconst fvals = this.Form.getValues();\n\n\t\tif (webix.isUndefined(change.all_day)) {\n\t\t\tif ((change.start_date || change.start_time) && fvals.all_day == 0) {\n\t\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\t}\n\t\t\tif ((change.end_date || change.end_time) && fvals.all_day == 0) {\n\t\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t\t}\n\t\t} else if (change.all_day == 1) {\n\t\t\tchange.start_date = fvals.start_date;\n\t\t\tchange.end_date = fvals.end_date;\n\t\t} else if (change.all_day == 0) {\n\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t}\n\n\t\tif (change.start_date || change.end_date) this.CorrectDateTime(change);\n\t}\n\n\t/**\n\t * Corrects the unchanged field if start > end or end < start\n\t * @param {Object} change - an object with changed values\n\t */\n\tCorrectDateTime(change) {\n\t\tconst fvals = this.Form.getValues();\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\t\tconst ev_length = (old.end_date - old.start_date) / 1000 / 60; // minutes\n\n\t\tconst type = change.start_date ? \"start\" : \"end\";\n\t\tconst opposite = type === \"start\" ? \"end\" : \"start\";\n\n\t\tif (\n\t\t\t(change.start_date >= old.end_date && !fvals.all_day) ||\n\t\t\tchange.start_date > old.end_date ||\n\t\t\t(old.start_date >= change.end_date && !fvals.all_day) ||\n\t\t\told.start_date > change.end_date\n\t\t) {\n\t\t\tchange[opposite + \"_date\"] = webix.Date.add(\n\t\t\t\tchange[type + \"_date\"],\n\t\t\t\t(type === \"start\" ? 1 : -1) * (ev_length || 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// apply also to form\n\t\t\tthis.Form.setValues(\n\t\t\t\t{\n\t\t\t\t\tstart_date: webix.Date.datePart(change.start_date, true),\n\t\t\t\t\tend_date: webix.Date.datePart(change.end_date, true),\n\t\t\t\t\tstart_time: change.start_time || webix.Date.copy(change.start_date),\n\t\t\t\t\tend_time: change.end_time || webix.Date.copy(change.end_date),\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\tdelete change.start_time;\n\t\tdelete change.end_time;\n\t}\n\n\t/**\n\t * Removes trailing spaces from input text\n\t * @param {Object} change - an object with changed values\n\t * @param {string} field - the name of a text field ('text', 'details')\n\t * @param {string} prev - an old value from the control where a value was changed\n\t */\n\tProcessText(change, field, prev) {\n\t\tif (!this.webix.isUndefined(change[field])) {\n\t\t\tchange[field] = change[field].replace(/(<[^>]+>|^\\s+|\\s+$)/gi, \"\");\n\t\t\tif (!prev) prev = this.Local.getItem(this.State.selected.id)[field];\n\t\t\tif (change[field] === prev.trim()) delete change[field];\n\t\t}\n\t}\n\n\t/**\n\t * Synchronizes recurring pattern with new start date\n\t * @param {Object} change - an object with changed values\n\t */\n\tApplyDatechangeToRecurring(change) {\n\t\tconst today = this.GetFromStartDate(change.start_date);\n\t\t// if date was changed after subform change, ignore\n\t\tconst fvals = this.Form.getValues();\n\t\tif (!change.recurring && fvals.$recurring) {\n\t\t\tif (fvals.rec_option === \"custom\") {\n\t\t\t\tconst recurring = fvals.$recurring;\n\n\t\t\t\tif (recurring.BYMONTH) {\n\t\t\t\t\trecurring.BYMONTH = today.month + 1;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYMONTHDAY) {\n\t\t\t\t\trecurring.BYMONTHDAY = today.day;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYSETPOS) {\n\t\t\t\t\trecurring.BYSETPOS = today.weekNum;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYDAY) {\n\t\t\t\t\trecurring.BYDAY = WeekdaysToDates(\n\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\tfvals.$recurring\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (recurring.UNTIL && recurring.UNTIL < change.start_date) {\n\t\t\t\t\tconst oldStart = this.Local.getItem(this.State.selected.id)\n\t\t\t\t\t\t.start_date;\n\t\t\t\t\tconst length = (fvals.$recurring.UNTIL - oldStart) / 1000 / 60; // minutes\n\t\t\t\t\trecurring.UNTIL = webix.Date.add(\n\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\"minute\",\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tchange.recurring = serialize(recurring);\n\n\t\t\t\tthis.SubForm.SetValues({ ...fvals, ...change }, today);\n\t\t\t} else {\n\t\t\t\tthis.GetRecurring(fvals.rec_option, change, fvals.start_date);\n\t\t\t\tdelete change.$recurring;\n\t\t\t}\n\t\t}\n\t\tthis.RecurringOptions.getList().parse(this.ResetRecurringOptions(today));\n\t\tthis.RecurringOptions.refresh();\n\t}\n\n\t/**\n\t * Assigns recurring pattern according to a preset\n\t * @param {string} r the ID of a recurring pattern option\n\t * @param {Object} change - an object with changed values\n\t * @param {Date} start - the start date of the event\n\t */\n\tGetRecurring(r, change, start) {\n\t\tlet $recurring = this.GetRecurringPreset(r, start);\n\n\t\tif (r === \"work\" && change.start_date) {\n\t\t\tconst BYDAY = WeekdaysToDates(change.start_date, $recurring);\n\t\t\tif ($recurring.BYDAY !== BYDAY) {\n\t\t\t\t$recurring.BYDAY = BYDAY;\n\t\t\t\tr = \"custom\";\n\t\t\t}\n\t\t}\n\n\t\tconst recurring = serialize($recurring);\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\n\t\t// check if switch from a preset to custom and back and the pattern is the same\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.$recurring = $recurring;\n\t\t\tchange.recurring = recurring;\n\t\t\tthis.Form.setValues(\n\t\t\t\t{\n\t\t\t\t\t$recurring: change.$recurring,\n\t\t\t\t\trecurring,\n\t\t\t\t\trec_option: r,\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Gets a recurring pattern object for a pattern preset based on the start date of the event\n\t * @param {string} r - a recurring option (accepted values: \"daily\", \"weekly\", \"work\", \"monthly\", \"yearly\")\n\t * @param {Date} start - the start date of an event\n\t * @returns {Object} - $recurring\n\t */\n\tGetRecurringPreset(r, start) {\n\t\tconst today = this.GetFromStartDate(start);\n\t\tswitch (r) {\n\t\t\tcase \"daily\":\n\t\t\t\treturn { FREQ: \"DAILY\", INTERVAL: 1 };\n\t\t\tcase \"weekly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: WEEKDAYS[today.weekday],\n\t\t\t\t};\n\t\t\tcase \"work\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: \"MO,TU,WE,TH,FR\",\n\t\t\t\t};\n\t\t\tcase \"monthly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"MONTHLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYSETPOS: today.weekNum,\n\t\t\t\t\tBYDAY: WEEKDAYS[today.weekday],\n\t\t\t\t};\n\t\t\tcase \"yearly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"YEARLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYMONTH: today.month + 1,\n\t\t\t\t\tBYMONTHDAY: today.day,\n\t\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Switches Scheduler to another date if the event after change is no longer visible\n\t * @param {Object} dirty - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tChangeDate(dirty, fvals) {\n\t\t// start date of non-repeating event changed or repeating event became non-repeating\n\t\tif ((dirty.start_date && !fvals.recurring) || dirty.recurring === \"\") {\n\t\t\tthis.State.selected.date = null;\n\t\t\tthis.UpdateStateDate(dirty.start_date || fvals.start_date);\n\t\t} else if (dirty.start_date || dirty.recurring) {\n\t\t\tconst date = this.GetClosestOccurrenceDate(dirty, fvals);\n\t\t\tthis.State.selected.date = date.valueOf() + \"_\" + this.State.selected.id;\n\t\t\tthis.UpdateStateDate(date);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the next closest occurrence date when dates or recurring pattern of an event was changed\n\t * @param {Object} dirty - an object with changed data\n\t * @param {Object} fvals - an object of all event form values\n\t * @returns {Date} the date of the next closest occurrence\n\t */\n\tGetClosestOccurrenceDate(dirty, fvals) {\n\t\tlet date = dirty.start_date\n\t\t\t? webix.Date.copy(dirty.start_date)\n\t\t\t: this.Join(fvals.start_date, fvals.start_time);\n\t\tlet end = webix.Date.dayStart(\n\t\t\tthis.State.selected.date\n\t\t\t\t? new Date(this.State.selected.date.split(\"_\")[0] * 1)\n\t\t\t\t: date\n\t\t);\n\t\tif (fvals.series_end_date) {\n\t\t\tend = new Date(\n\t\t\t\tMath.min(webix.Date.add(fvals.series_end_date, -1, \"day\", true), end)\n\t\t\t);\n\t\t}\n\n\t\tconst consts = {};\n\t\tfillWdays(fvals.$recurring, consts);\n\t\tlet temp = webix.Date.copy(date);\n\t\twhile (webix.Date.dayStart(temp) < end) {\n\t\t\ttemp = next(temp, fvals.$recurring, consts);\n\t\t\tif (Math.abs(end - temp) < Math.abs(end - date)) {\n\t\t\t\tdate = webix.Date.copy(temp);\n\t\t\t}\n\t\t}\n\t\treturn date;\n\t}\n\n\t/**\n\t * Updates state.date according to state.mode\n\t * @param {Date} date - new state.date\n\t */\n\tUpdateStateDate(date) {\n\t\tdate = webix.Date.dayStart(date);\n\t\tconst state = this.State;\n\t\tif (\n\t\t\tstate.mode === \"day\" ||\n\t\t\tstate.mode === \"units\" ||\n\t\t\t(state.mode === \"timeline\" && state.timelineMode === \"day\")\n\t\t) {\n\t\t\tconst sdate = webix.Date.dayStart(state.date);\n\t\t\tif (!webix.Date.equal(date, sdate)) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t} else {\n\t\t\tconst { start, end } = this.GetModeBounds();\n\t\t\tif (date < start || date >= end) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns start and end dates of a currently displayed period\n\t */\n\tGetModeBounds() {\n\t\tconst state = this.State;\n\t\tlet mode = state.mode;\n\t\tif (mode === \"timeline\") mode = state.timelineMode;\n\t\telse if (mode === \"agenda\") mode = \"month\";\n\t\tlet start = webix.Date[mode + \"Start\"](state.date);\n\t\tlet end = webix.Date.add(start, 1, mode, true);\n\n\t\tif (state.mode === \"month\") {\n\t\t\tstart = webix.Date.weekStart(start);\n\t\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\t\tend = webix.Date.add(start, weeks, \"week\", true);\n\t\t}\n\n\t\treturn { start, end };\n\t}\n\n\t/**\n\t * Unites changed and unchanged fields into 1 object for saving newly added events\n\t * @param {Object} change - an object with changed values\n\t */\n\tPrepareOut(change) {\n\t\tlet obj = this.Form.getValues();\n\n\t\tif (!obj.all_day) {\n\t\t\tobj.start_date = this.Join(obj.start_date, obj.start_time);\n\t\t\tobj.end_date = this.Join(obj.end_date, obj.end_time);\n\t\t}\n\n\t\tobj = webix.extend(obj, change || {}, true);\n\n\t\tif (!(change && change.recurring) && obj.$recurring) {\n\t\t\tobj.$recurring.EXDATE = [];\n\t\t\tobj.recurring = serialize(obj.$recurring);\n\t\t}\n\n\t\tif (!obj.origin_id) obj.origin_id = 0;\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Removes a temporary local event\n\t */\n\tClearTempEvent() {\n\t\tconst sid = this.Id;\n\t\tif (sid === \"0\" && this.Local.exists(sid)) {\n\t\t\tthis.Local.remove(sid);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form and either the whole right panel with it or returns to Info\n\t * @param {boolean} close - if true, the right panel is closed\n\t */\n\tBack(close) {\n\t\tthis.Form.clear();\n\n\t\tif (close || this.State.selected.id === \"0\") {\n\t\t\tthis.State.selected = null;\n\t\t} else {\n\t\t\tconst path = this.Compact ? \"event.formpopup/\" : \"../\";\n\t\t\tthis.show(path + \"event.info\", { target: \"edit\" });\n\t\t}\n\t}\n\n\t/**\n\t * Closes the right panel\n\t */\n\tClose() {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back(true);\n\t\t\t});\n\t\t} else {\n\t\t\tconst dirty =\n\t\t\t\tthis.Form.isDirty() || (this.Subform && this.SubForm.IsDirty());\n\t\t\tif (this.Compact && dirty) {\n\t\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.Done(true))\n\t\t\t\t\t.catch(() => this.Back(true));\n\t\t\t} else this.Back(true);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form\n\t * @param {boolean} close\n\t */\n\tDone(close) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back();\n\t\t\t});\n\t\t} else if (this.State.selected.id === \"0\" || this.Compact) {\n\t\t\tlet change = {};\n\t\t\tif (this.Compact) {\n\t\t\t\tchange = this._changedValues;\n\t\t\t\tif (this.SubForm.IsDirty()) {\n\t\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\t\t\tchange.series_end_date = change.$recurring.UNTIL;\n\t\t\t\t\tdelete change.rec_option;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.UpdateEvent(change).then(() => this.Back(close));\n\t\t} else {\n\t\t\tthis.Back();\n\t\t}\n\t}\n\n\t/**\n\t * Waits until some asynchronous operation finishes (if there's any) and then executes 'handler'\n\t * @param {function} handler - the code that will be executed\n\t */\n\tWait(handler) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(handler);\n\t\t} else {\n\t\t\thandler.call();\n\t\t}\n\t}\n\n\t// compact\n\n\t/**\n\t * Shows a subform with controls for editing recurring pattern in a window\n\t */\n\tShowSubForm() {\n\t\tthis.SubForm.Show();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst subform = this.SubForm.getRoot();\n\n\t\tconst aSkin = webix.skin.$active;\n\t\twebix.fullscreen.set(subform, {\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\t\tright: 14,\n\t\t\t\t},\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"icon\", icon: \"shi-back\", click: () => this.HideSubPop() },\n\t\t\t\t\t{ view: \"label\", label: _(\"Change recurring pattern\") },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\tclick: () => this.HideSubPop(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t});\n\n\t\tconst win = subform.getTopParentView();\n\t\twin.define({ css: \"webix_scheduler_subform_popup\" });\n\t}\n\n\t/**\n\t * Hides the window with the subform\n\t */\n\tHideSubPop() {\n\t\tthis.SubForm.Hide();\n\t\twebix.fullscreen.exit();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormPopup extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t};\n\t}\n}\n","/* eslint-disable indent */\n/* eslint-disable no-mixed-spaces-and-tabs */\nimport { JetView } from \"webix-jet\";\nimport { FREQUENCE, WEEKDAYS, separateSequence } from \"../../helpers/recurring\";\n\nimport EventActionMenu from \"./actionmenu\";\n\nexport default class EventView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Back(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tlabel: _(\"Edit\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: function() {\n\t\t\t\t\t\tthis.$scope.StartAction(\"Edit\", this.$view);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_scheduler_info\",\n\t\t\ttemplate: obj => (obj.start_date ? this.InfoTemplate(obj) : \"\"),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"remove\",\n\t\t\tlabel: _(\"Delete event\"),\n\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: function() {\n\t\t\t\tthis.$scope.StartAction(\"Delete\", this.$view);\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tpadding: { right: 14 + 2 },\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, deleteButton],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.UnitsLocal = this.app.getService(\"local\").units(true);\n\n\t\tthis.on(this.State.$changes, \"readonly\", v => {\n\t\t\tconst action = v ? \"hide\" : \"show\";\n\t\t\tthis.$$(\"edit\")[action]();\n\t\t\tthis.$$(\"remove\")[action]();\n\t\t});\n\n\t\tconst template = this.$$(\"text\");\n\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.EventObj = this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.events(true)\n\t\t\t\t\t.getItem(v.id);\n\t\t\t\ttemplate.setValues(this.EventObj);\n\t\t\t}\n\t\t});\n\n\t\tthis.Menu = this.ui(EventActionMenu);\n\n\t\tif (this.app.config.units) {\n\t\t\tconst waitUnits = this.app.getService(\"local\").units();\n\t\t\twaitUnits.then(() => {\n\t\t\t\ttemplate.refresh();\n\t\t\t});\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tconst local = this.app.getService(\"local\");\n\t\t\tlocal.sections().then(data => {\n\t\t\t\tthis.Sections = data;\n\t\t\t\ttemplate.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\tStartAction(mode, node) {\n\t\tif (\n\t\t\tthis.app.config.recurring &&\n\t\t\t(typeof this.State.selected.date === \"string\" || this.EventObj.origin_id)\n\t\t) {\n\t\t\tthis._waitMenu = webix.promise.defer();\n\t\t\tthis._waitMenu\n\t\t\t\t.then(o =>\n\t\t\t\t\tmode === \"Delete\" ? this.DeleteEvent(o) : this.EditEvent(o)\n\t\t\t\t)\n\t\t\t\t.finally(() => (this._waitMenu = null));\n\t\t\tthis.Menu.Show(node, this._waitMenu);\n\t\t} else {\n\t\t\tif (mode === \"Delete\") this.DeleteEvent();\n\t\t\telse this.EditEvent();\n\t\t}\n\t}\n\n\tEditEvent(o) {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst path = compact ? \"event.formpopup/\" : \"../\";\n\t\tthis.show(path + \"event.form\", { target: \"edit\", params: { mode: o } });\n\t}\n\n\tDeleteEvent(mode) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete event\"),\n\t\t\t\ttext: _(\"The event will be deleted permanently, are you sure?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst obj = this.EventObj;\n\t\t\t\tlet sdate = \"\";\n\t\t\t\tif (mode && mode !== \"all\") {\n\t\t\t\t\tif (this.State.selected) sdate = this.State.selected.date;\n\t\t\t\t\telse if (obj.$id) sdate = obj.id;\n\t\t\t\t}\n\t\t\t\tthis.app\n\t\t\t\t\t.getService(\"operations\")\n\t\t\t\t\t.removeEvent(mode, this.EventObj, sdate);\n\t\t\t\tthis.Back();\n\t\t\t});\n\t}\n\n\tBack() {\n\t\tthis.State.selected = null;\n\t}\n\n\tInfoTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (this.app.config.recurring && this.State.selected.date) {\n\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\t\t}\n\t\tconst [start, end] = [obj.start_date, obj.end_date];\n\n\t\tconst oneday = webix.Date.equal(\n\t\t\twebix.Date.datePart(start, true),\n\t\t\twebix.Date.datePart(end, true)\n\t\t);\n\n\t\tconst allday =\n\t\t\twebix.Date.equal(webix.Date.datePart(start, true), start) &&\n\t\t\twebix.Date.equal(webix.Date.datePart(end, true), end) &&\n\t\t\tobj.all_day;\n\n\t\tconst time = webix.i18n.timeFormatStr;\n\t\tconst date = webix.i18n.longDateFormatStr;\n\n\t\tconst title = `<div class=\"webix_scheduler_event_title\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>`;\n\n\t\tconst startDate = date(start);\n\t\tconst endDate = date(end);\n\t\tconst startTime = time(start);\n\t\tconst endTime = time(end);\n\n\t\tlet fromTo = \"\";\n\t\tif (oneday) {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\n\t\t\t\t\"from\"\n\t\t\t)} ${startTime} ${_(\"to\")} ${endTime}</div>`;\n\t\t} else {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${_(\"from\")} ${\n\t\t\t\t!allday ? startTime : \"\"\n\t\t\t} ${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\"to\")} ${\n\t\t\t\t!allday ? endTime : \"\"\n\t\t\t} ${endDate}</div>`;\n\t\t}\n\n\t\tconst recurring =\n\t\t\tthis.app.config.recurring && obj.recurring\n\t\t\t\t? this.GetRecurringText(obj, _)\n\t\t\t\t: \"\";\n\n\t\tlet units = \"\";\n\t\tif (this.app.config.units) {\n\t\t\tunits += `<div class=\"webix_scheduler_event_units_title\">${_(\n\t\t\t\t\"Assigned to units\"\n\t\t\t)}:</div><div class=\"webix_scheduler_event_units\">`;\n\t\t\tif (obj.units) {\n\t\t\t\tconst unitIDs = obj.units.split(\",\");\n\t\t\t\tunitIDs.forEach((id, index) => {\n\t\t\t\t\tconst isLast = index === unitIDs.length - 1;\n\t\t\t\t\tconst unitObj = this.UnitsLocal.getItem(id);\n\t\t\t\t\tconst unitValue =\n\t\t\t\t\t\tunitObj && unitObj.value ? unitObj.value : _(\"Unknown unit\");\n\t\t\t\t\tunits += `<div class=\"webix_scheduler_event_unit_item\">${unitValue}${\n\t\t\t\t\t\tisLast ? \"\" : \",\"\n\t\t\t\t\t}</div>`;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tunits += _(\"No units\");\n\t\t\t}\n\t\t\tunits += \"</div>\";\n\t\t}\n\n\t\tconst section =\n\t\t\tthis.app.config.timeline && this.Sections ? this.GetSection(obj, _) : \"\";\n\n\t\tlet details = \"\";\n\t\tif (obj.details)\n\t\t\tdetails = `<div class=\"webix_scheduler_event_details_title\">${_(\n\t\t\t\t\"Notes\"\n\t\t\t)}</div>\n\t\t\t\t<div class=\"webix_scheduler_event_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\n\t\treturn `${title}\n\t\t\t<div class='webix_scheduler_event_from_to'>${fromTo}</div>\n\t\t\t<div class='webix_scheduler_event_recurring_pattern'>${recurring}</div>${units}${section}${details}`;\n\t}\n\n\tGetRecurringText(obj, _) {\n\t\tconst mode = obj.$recurring;\n\n\t\tconst interval = mode.INTERVAL && mode.INTERVAL > 1 ? mode.INTERVAL : \"\";\n\t\tconst pattern =\n\t\t\t(mode.BYDAY\n\t\t\t\t? ` ${_(\"on\")} ${mode.BYSETPOS || \"\"} ${mode.BYDAY.split(\",\")\n\t\t\t\t\t\t.map(d => webix.i18n.calendar.dayFull[WEEKDAYS.indexOf(d)])\n\t\t\t\t\t\t.join(\", \")}`\n\t\t\t\t: \"\") +\n\t\t\t(mode.BYMONTHDAY ? ` ${_(\"on\")} ` : \"\") +\n\t\t\t(mode.BYMONTH\n\t\t\t\t? `${mode.BYSETPOS ? _(\"of\") : \"\"} ${\n\t\t\t\t\t\twebix.i18n.calendar.monthFull[mode.BYMONTH - 1]\n\t\t\t\t  }`\n\t\t\t\t: \"\") +\n\t\t\t(mode.BYMONTHDAY ? ` ${mode.BYMONTHDAY}` : \"\");\n\n\t\treturn `${_(\"Repeats each\")} ${interval} ${_(\n\t\t\tFREQUENCE[mode.FREQ] + (interval ? \"s\" : \"\")\n\t\t)} ${pattern}${\n\t\t\tmode.COUNT\n\t\t\t\t? `, ${mode.COUNT} ${_(\"times\")}`\n\t\t\t\t: mode.UNTIL\n\t\t\t\t? ` ${_(\"till\")} ${webix.i18n.longDateFormatStr(mode.UNTIL)}`\n\t\t\t\t: \"\"\n\t\t}`;\n\t}\n\n\t/**\n\t * Returns a string with HTML for the info with the section\n\t * @param {Object} obj - data of an event\n\t * @param {function} _ - the translator function of the Locale plugin\n\t * @returns {string} a string with HTML for the info with the section\n\t */\n\tGetSection(obj, _) {\n\t\tconst section = this.Sections.getItem(obj.section);\n\t\tif (section)\n\t\t\treturn `<div class=\"webix_scheduler_section_tpl\"><span class=\"webix_scheduler_section_title\">${_(\n\t\t\t\t\"Section\"\n\t\t\t)}:</span> ${section.text}</div>`;\n\t\treturn \"\";\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionPopup extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst buttons = {\n\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Cancel\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Cancel(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Apply\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\thead: _(\"Edit recurring event\"),\n\t\t\tposition: \"center\",\n\t\t\tautoheight: true,\n\t\t\tcss: \"webix_scheduler_action_popup\",\n\t\t\tbody: {\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\twidth: 340,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\tlocalId: \"option\",\n\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tbuttons,\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => (this.Result = null),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(promise) {\n\t\tthis.Result = promise;\n\t\tthis.$$(\"option\").setValue(\"this\");\n\t\tthis.Root.show();\n\t}\n\n\tDone() {\n\t\tconst id = this.$$(\"option\").getValue();\n\t\tif (this.Result) this.Result.resolve(id);\n\t\tthis.Root.hide();\n\t}\n\n\tCancel() {\n\t\tif (this.Result) this.Result.reject();\n\t\tthis.Root.hide();\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\nimport topbar from \"views/bars\";\nimport add from \"views/bars/add\";\nimport side from \"./side\";\n\nimport EventActionPopup from \"./modes/common/actionpopup\";\n\nimport \"../helpers/responsive\";\n\nexport default class MainView extends JetView {\n\tconfig() {\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(fCompact)) this.setParam(\"compact\", fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.Calendars = !this.Compact && this.app.config.calendars;\n\n\t\tconst rows = [\n\t\t\ttopbar,\n\t\t\t{\n\t\t\t\tview: webix.isUndefined(fCompact) ? \"r-layout\" : \"layout\",\n\t\t\t\tlocalId: \"main\",\n\t\t\t\tcols: [{ $subview: true }],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows.push({\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"edit\",\n\t\t\t\tpopup: true,\n\t\t\t});\n\t\t} else {\n\t\t\trows[1].cols.push({\n\t\t\t\tview: \"proxy\",\n\t\t\t\twidth: 400,\n\t\t\t\tlocalId: \"edit\",\n\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\tborderless: true,\n\t\t\t\thidden: true,\n\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t});\n\t\t}\n\n\t\tif (this.Calendars)\n\t\t\trows[1].cols.unshift({\n\t\t\t\tview: \"proxy\",\n\t\t\t\tlocalId: \"side\",\n\t\t\t\tborderless: true,\n\t\t\t\tbody: side,\n\t\t\t\thidden: true,\n\t\t\t});\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler\",\n\t\t\tview: \"abslayout\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\trelative: true,\n\t\t\t\t\tmargin: 0,\n\t\t\t\t\trows: rows,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_scheduler_absbutton\",\n\t\t\t\t\tbody: add,\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit(view) {\n\t\tconst main = this.$$(\"main\");\n\t\tif (main.sizeTrigger)\n\t\t\tmain.sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\tres.finally(() => {\n\t\t\t\tview.hideProgress();\n\t\t\t});\n\t\t});\n\n\t\tif (this.Calendars) this.$$(\"side\").show();\n\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"mode\", value => {\n\t\t\tthis.show(`./modes.${value}`);\n\t\t});\n\t\tthis.on(state.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\n\t\tthis.on(state.$changes, \"selected\", (v, o) => this.ToggleEvent(v, o));\n\t\tthis.on(this.app, \"show:panel\", () => this.ToggleSidePanel());\n\n\t\tthis.app._dndActionPopup = this.ui(EventActionPopup);\n\t}\n\n\tToggleEvent(ev, old) {\n\t\tif (ev) {\n\t\t\tthis.ShowEvent(ev, old);\n\t\t} else if (old) {\n\t\t\tthis.HideEvent();\n\t\t}\n\t}\n\n\tShowEvent(ev, old) {\n\t\tconst sameEvent = old && old.id == ev.id;\n\t\tconst edit = this.getSubView(\"edit\");\n\t\tconst path =\n\t\t\tedit && sameEvent\n\t\t\t\t? edit.getUrl()[0].page\n\t\t\t\t: `event.${ev.id === \"0\" ? \"form\" : \"info\"}`;\n\n\t\tif (this.Compact) {\n\t\t\tthis.show(`event.formpopup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.ToggleSidePanel(\"hide\");\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideEvent() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\n\t\tif (!this.Compact) {\n\t\t\tthis.$$(\"edit\").hide();\n\t\t\tthis.ToggleSidePanel(\"show\");\n\t\t}\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tif (!mode) webix.fullscreen.exit();\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tToggleSidePanel(state) {\n\t\tconst side = this.$$(\"side\");\n\t\tif (side) {\n\t\t\tif (state !== \"show\" && side.isVisible()) {\n\t\t\t\tthis._sidePanel = state === \"hide\";\n\t\t\t\tside.hide();\n\t\t\t} else if (!state || (this._sidePanel && state !== \"hide\")) {\n\t\t\t\tside.show();\n\t\t\t\tthis._sidePanel = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (this.Compact) add.show();\n\t}\n}\n","export function marker(obj) {\n\treturn `<div class=\"webix_event_marker\"><div class=\"webix_event_marker_inner\" style=\"background-color:${obj.color ||\n\t\tobj.$color};\"></div></div>`;\n}\n\nexport function events(_) {\n\treturn function(obj, common) {\n\t\treturn `<div class=\"webix_event_overall\"><div class=\"webix_event_time\">${common.timeStart(\n\t\t\tobj\n\t\t)}</div>${marker(obj, common)}<div class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div></div>`;\n\t};\n}\n\nexport function dayEventColor(obj) {\n\treturn `border-color:${obj.$color}; background-color:${obj.color ||\n\t\tobj.$color}; color:${obj.$textColor};`;\n}\n\nexport function timeStart(start, end) {\n\treturn `<div class=\"start\">${webix.i18n.timeFormatStr(\n\t\tstart\n\t)}</div><div class=\"end\">${webix.i18n.timeFormatStr(end)}</div>`;\n}\n\nfunction fill(obj, common, size) {\n\tconst v = common.master;\n\treturn (\n\t\tv[\"$\" + size] -\n\t\t(v.config[size == \"width\" ? \"xCount\" : \"yCount\"] - 1) * common[size]\n\t);\n}\n\nexport function templateStart(obj, common, marks) {\n\tlet { width, height } = common;\n\tif (obj.right) width = fill(obj, common, \"width\");\n\tif (obj.bottom) height = fill(obj, common, \"height\");\n\treturn (\n\t\t\"<div \" +\n\t\t/*@attr*/ \"webix_l_id\" +\n\t\t`=\"${obj.id}\" class=\"${common.classname(obj, common, marks)}\" ${common.aria(\n\t\t\tobj,\n\t\t\tcommon,\n\t\t\tmarks\n\t\t)} style=\"width:${width}px; height:${height}px; float:left; overflow:hidden;\">`\n\t);\n}\n","export function shrinkTo(start, end) {\n\treturn ev => {\n\t\tconst before = ev.start_date <= start;\n\t\tconst after = ev.end_date >= end;\n\n\t\tif (before || after) {\n\t\t\tconst t = webix.copy(ev);\n\t\t\tif (before) t.start_date = start;\n\t\t\tif (after) t.end_date = end;\n\t\t\treturn t;\n\t\t}\n\n\t\treturn ev;\n\t};\n}\n\nexport function isToday(date) {\n\treturn webix.Date.equal(\n\t\twebix.Date.datePart(date),\n\t\twebix.Date.datePart(new Date())\n\t);\n}\n\nexport function isMultiDay(ev) {\n\treturn (\n\t\tev.all_day ||\n\t\t(ev.start_date.getDate() != ev.end_date.getDate() &&\n\t\t\tev.end_date - ev.start_date >= 1000 * 60 * 60 * 24 * 1)\n\t);\n}\n\nexport function daysBetweenInclusive(start, end) {\n\tconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\treturn Math.round(\n\t\t(webix.Date.dayStart(end) - webix.Date.dayStart(start)) / millisecondsPerDay\n\t);\n}\n\n/**\n * Checks if the dates are the same\n * @param {Date} adate\n * @param {Date} bdate\n * @returns {Boolean}\n */\nexport function isSameDate(adate, bdate) {\n\treturn webix.Date.equal(\n\t\twebix.Date.dayStart(adate),\n\t\twebix.Date.dayStart(bdate)\n\t);\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class UnitListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"unitlist\",\n\t\t\tlocalId: \"list\",\n\t\t\tuniteBy: () => \"custom\",\n\t\t\ttype: {\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttemplateHeader: obj => this.TemplateHeader(obj),\n\t\t\t\ttimeStart: obj => this.TimeStart(obj),\n\t\t\t\theight: 50,\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonUnits: () => this.SetUnits(),\n\t\t\t\tonItemClick: (id, node) => this.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"list\");\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\tShowEvent(id, node) {\n\t\tconst obj = this.List.getItem(id);\n\t\tconst sel = getParams(obj);\n\t\tsel.node = node;\n\t\tthis.State.selected = sel;\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tSetUnits() {\n\t\tlet units = this.List.units;\n\t\tconst data = this.data.all;\n\n\t\t// ignore clearAll\n\t\tif (Object.keys(units).length) {\n\t\t\tthis.List.units = {};\n\t\t\tlet start = this.data.start;\n\t\t\tconst end = this.data.end;\n\n\t\t\twhile (start < end) {\n\t\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\n\t\t\t\tlet result = data\n\t\t\t\t\t.filter(\n\t\t\t\t\t\td =>\n\t\t\t\t\t\t\td.start_date < next &&\n\t\t\t\t\t\t\t(d.end_date > start || (d.end_date >= start && d.all_day))\n\t\t\t\t\t)\n\t\t\t\t\t.map(ev => ev.id);\n\t\t\t\tif (result.length) {\n\t\t\t\t\tthis.List.units[start.valueOf()] = result;\n\t\t\t\t}\n\n\t\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\n\nexport default class AgendaView extends UnitListView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_agenda\";\n\n\t\twebix.extend(\n\t\t\tui.type,\n\t\t\t{\n\t\t\t\theight: \"auto\",\n\t\t\t\theaderHeight: 50,\n\t\t\t\tclassname: obj => this.TemplateCss(obj),\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\twebix.extend(\n\t\t\tui.on,\n\t\t\t{\n\t\t\t\tonItemRender: obj => {\n\t\t\t\t\tif (obj.$unit) this.CurrentUnit = obj.$unit;\n\t\t\t\t},\n\t\t\t\tonItemClick: (id, e, node) => {\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\tthis.ShowEvent(id, node);\n\t\t\t\t\tif (!compact) this.SelectEvent(node);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst events = this.Data.events(true);\n\n\t\tthis.on(this.State.$changes, \"date\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (!v) this.SelectEvent(); //remove selection\n\t\t});\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\n\t\t// updates made in full mode by form\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t}\n\n\tRefreshData() {\n\t\tlet start = webix.Date.monthStart(this.State.date);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tthis.data = { all: data, start: start, end: end };\n\t\t\tif (this.app) {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(data.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t}\n\t\t});\n\t}\n\n\tSelectEvent(node) {\n\t\tif (node == this._selected) return;\n\n\t\tconst name = \"webix_agenda_selected\";\n\t\tif (this._selected) webix.html.removeCss(this._selected, name);\n\t\tif (node) webix.html.addCss(node, name);\n\n\t\tthis._selected = node;\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span><br><span class='webix_scheduler_dayofweek'>%l</span>`;\n\n\t\treturn webix.Date.dateToStr(fstring)(date);\n\t}\n\n\tTemplateCss(obj) {\n\t\tconst ids = this.List.getUnitList(this.CurrentUnit);\n\n\t\tlet css = \"webix_list_item\";\n\t\tif (obj.id == ids[ids.length - 1]) css += \" webix_event_last\";\n\t\tif (obj.id == ids[0]) css += \" webix_event_first\";\n\n\t\treturn css;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class HourscaleView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tborderless: true,\n\t\t\tlocalId: \"scale\",\n\t\t\tcss: \"webix_scheduler_scale\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\theightSize: (obj, common) => {\n\t\t\t\t\tconst ind = this.List.getIndexById(obj.id);\n\t\t\t\t\treturn common.height - (ind === 0 ? 17 : 0) + \"px\";\n\t\t\t\t},\n\t\t\t},\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\twidth: 51,\n\t\t\ttemplate: obj => this.HourScaleItem(obj),\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"scale\");\n\t\tthis.ParseHours();\n\t}\n\n\tParseHours() {\n\t\tconst data = [];\n\t\tfor (let h = 0; h < 24; h++) {\n\t\t\tdata.push({ id: h + \"\" });\n\t\t}\n\t\tthis.List.parse(data);\n\t}\n\n\tHourScaleItem(obj) {\n\t\tif (this.List.getIndexById(obj.id) === 0) return \"\";\n\t\telse return `${(obj.id < 10 ? \"0\" : \"\") + obj.id}:00`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class MultiMoreView extends JetView {\n\tconfig() {\n\t\tconst more = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"more\",\n\t\t\twidth: 50,\n\t\t\tcss: \"webix_scheduler_multi_space\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-angle-down\": () => this.ExpandData(),\n\t\t\t\t\"wxi-angle-up\": () => this.WrapData(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcols: [more, {}],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"multiDayList\");\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n}\n","function _select(id, functor) {\n\tconst trgs = this.LocateSelected(id);\n\tif (trgs) {\n\t\tfor (let i = 0; i < trgs.length; i++)\n\t\t\tfunctor(trgs[i], \"webix_scheduler_event_selected\");\n\t}\n}\n\nfunction Select(id) {\n\treturn _select.call(this, id, webix.html.addCss);\n}\n\nfunction Unselect(id) {\n\treturn _select.call(this, id, webix.html.removeCss);\n}\n\nfunction HandleSelection() {\n\tconst mode = this._SelectionMode;\n\tthis.State = this.app.getState();\n\n\tthis.on(this.State.$changes, \"selected\", (v, o) => {\n\t\tif (o) this.Unselect(o.date && typeof o.date === \"string\" ? o.date : o.id);\n\n\t\tif (v) {\n\t\t\tconst id = v.id === \"0\" || !v.date ? v.id : v.date;\n\t\t\tsetTimeout(\n\t\t\t\t() => this.Select(id),\n\t\t\t\tmode !== \"multi\" && id === \"0\" ? 150 : 0\n\t\t\t);\n\t\t}\n\t});\n\n\t// reapply selection to a saved new event\n\tif (mode !== \"multi\") {\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(events.data, \"onStoreUpdated\", (id, o, operation) => {\n\t\t\tif (\n\t\t\t\toperation === \"add\" &&\n\t\t\t\tid != \"0\" &&\n\t\t\t\tthis.State.selected &&\n\t\t\t\tthis.State.selected.id === \"0\"\n\t\t\t) {\n\t\t\t\tthis.State.selected.id = id;\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction locate(inner) {\n\treturn function LocateSelected(id) {\n\t\tif (this._DataObj) {\n\t\t\treturn Array.prototype.map.call(\n\t\t\t\tthis._DataObj.querySelectorAll(\n\t\t\t\t\t`[webix_${inner ? \"l\" : \"e\"}_id=\"${id}\"]`\n\t\t\t\t),\n\t\t\t\tel => (inner ? el.firstElementChild : el)\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t};\n}\n\nexport default function SelectionMixin(child, mode, inner) {\n\tchild._SelectionMode = mode;\n\n\tchild.Select = Select;\n\tchild.Unselect = Unselect;\n\tchild.HandleSelection = HandleSelection;\n\tchild.LocateSelected = locate(inner);\n\n\tchild.HandleSelection();\n}\n","export const Resizer = {\n\t$dragIn: function() {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.from.mode !== this.mode) return false;\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst box = webix.html.offset(ctx.target);\n\t\tlet y = pos.y - box.y;\n\n\t\tif (y < ctx.y_diff) y = ctx.y_diff;\n\t\telse if (y > box.height) y = box.height;\n\n\t\tconst height = y - ctx.y_diff;\n\t\tResizer.updateNodeHeight.call(this, height);\n\n\t\tif (ctx.duration !== height) {\n\t\t\tctx.duration = height;\n\t\t\tthis.updateText(ctx);\n\t\t}\n\n\t\tpos.x = ctx.x_diff;\n\t\tpos.y = ctx.y_diff;\n\t},\n\tupdateNodeHeight: function(height) {\n\t\tconst node = webix.DragControl.getNode();\n\t\tnode.style.height = Math.max(this.master.minEventHeight, height) + \"px\";\n\t},\n\tgetActualDate: function(master, any) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst date = webix.Date.copy(ctx.event.start_date);\n\t\tconst minutes =\n\t\t\t(Math.round((ctx.duration * 60) / master.List.type.height / 5) || 1) * 5;\n\n\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\tif (!any && webix.Date.equal(date, ctx.event.end_date)) return null;\n\n\t\treturn {\n\t\t\tstart_date: webix.Date.copy(ctx.event.start_date),\n\t\t\tend_date: date,\n\t\t};\n\t},\n};\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst d = webix.Date;\r\nfunction addMinutes(date, inc) {\r\n\treturn d.add(date, inc * 1, \"minute\", true);\r\n}\r\n\r\nfunction addHours(date, inc) {\r\n\treturn d.add(date, inc * 1, \"hour\", true);\r\n}\r\n\r\nfunction addDays(date, inc) {\r\n\treturn d.add(date, inc * 1, \"day\", true);\r\n}\r\n\r\nfunction addWeeks(date, inc) {\r\n\treturn d.add(date, inc * 1, \"week\", true);\r\n}\r\n\r\nfunction addMonths(date, inc) {\r\n\treturn d.add(date, inc * 1, \"month\", true);\r\n}\r\n\r\nfunction addQuarters(date, inc) {\r\n\treturn d.add(date, inc * 3, \"month\", true);\r\n}\r\n\r\nfunction addYears(date, inc) {\r\n\treturn d.add(date, inc * 1, \"year\", true);\r\n}\r\n\r\nfunction differenceInYears(a, b) {\r\n\treturn a.getFullYear() - b.getFullYear();\r\n}\r\n\r\nfunction differenceInMonths(a, b) {\r\n\treturn (\r\n\t\t(a.getFullYear() - b.getFullYear()) * 12 + (a.getMonth() - b.getMonth())\r\n\t);\r\n}\r\n\r\nconst day_length = 86400000;\r\nfunction differenceInCalendarDays(a, b) {\r\n\ta = new Date(a);\r\n\ta.setHours(0, 0, 0, 0);\r\n\tb = new Date(b);\r\n\tb.setHours(0, 0, 0, 0);\r\n\r\n\treturn Math.round((a.getTime() - b.getTime()) / day_length);\r\n}\r\n\r\nfunction differenceInQuarters(a, b) {\r\n\treturn (\r\n\t\t(a.getFullYear() - b.getFullYear()) * 4 +\r\n\t\t(Math.floor(a.getMonth() / 3) + 1) -\r\n\t\t(Math.floor(b.getMonth() / 3) + 1)\r\n\t);\r\n}\r\n\r\nfunction differenceInWeeks(a, b) {\r\n\tconst diff = differenceInCalendarDays(a, b) / 7;\r\n\tconst end = getDay(a);\r\n\tconst start = getDay(b);\r\n\r\n\treturn Math.ceil(Math.abs(diff) - (end <= start ? 0 : 1)) * Math.sign(diff);\r\n}\r\n\r\nfunction differenceInHours(a, b) {\r\n\treturn differenceInCalendarDays(a, b) * 24 + (a.getHours() - b.getHours());\r\n}\r\n\r\nfunction differenceInMinutes(a, b) {\r\n\treturn differenceInHours(a, b) * 60 + (a.getMinutes() - b.getMinutes());\r\n}\r\n\r\nconst f_cache = {};\r\nfunction format(date, format) {\r\n\treturn formatFunction(format)(date);\r\n}\r\nfunction formatFunction(format) {\r\n\tlet cb = f_cache[format];\r\n\tif (!cb) {\r\n\t\tcb = f_cache[format] = d.dateToStr(format);\r\n\t}\r\n\r\n\treturn cb;\r\n}\r\n\r\nfunction getDay(date) {\r\n\tlet shift = date.getDay();\r\n\tif (d.startOnMonday) {\r\n\t\tif (shift === 0) shift = 6;\r\n\t\telse shift--;\r\n\t}\r\n\treturn shift;\r\n}\r\n\r\nfunction getDatePart(date) {\r\n\treturn d.datePart(date, true);\r\n}\r\n\r\nfunction getTimePart(date) {\r\n\treturn d.timePart(date);\r\n}\n\nconst diff = {\r\n\tyear: differenceInYears,\r\n\tquarter: differenceInQuarters,\r\n\tmonth: differenceInMonths,\r\n\tweek: differenceInWeeks,\r\n\tday: differenceInCalendarDays,\r\n\thour: differenceInHours,\r\n\tminute: differenceInMinutes,\r\n};\r\n\r\nfunction countDaysInMonth(sdate) {\r\n\tif (!sdate) return 30;\r\n\r\n\tconst m = sdate.getMonth();\r\n\r\n\tif (m === 1) {\r\n\t\tconst y = sdate.getFullYear();\r\n\t\tif (y % 4) return 28;\r\n\t\tif (y % 100) return 29;\r\n\t\tif (y % 400) return 28;\r\n\t\treturn 29;\r\n\t}\r\n\r\n\tif ((m % 2 && m < 7) || (!(m % 2) && m > 7)) {\r\n\t\treturn 30;\r\n\t}\r\n\r\n\treturn 31;\r\n}\r\n/**\r\n * Smaller units for task position and width for scales with precision setting:\r\n * the name of the unit and the number within a larger unit\r\n */\r\nconst smallerCount = {\r\n\tyear: [\"quarter\", 4],\r\n\tquarter: [\"month\", 3],\r\n\tmonth: [\"day\", countDaysInMonth],\r\n\tweek: [\"day\", 7],\r\n\tday: [\"hour\", 24],\r\n\thour: [\"minute\", 60],\r\n};\r\n\r\nconst add = {\r\n\tyear: addYears,\r\n\tquarter: addQuarters,\r\n\tmonth: addMonths,\r\n\tweek: addWeeks,\r\n\tday: addDays,\r\n\thour: addHours,\r\n\tminute: addMinutes,\r\n};\r\n\r\n/**\r\n * Calculates the difference between two dates in units\r\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\r\n * @param {Date} next - a later date\r\n * @param {Date} prev - an earlier date\r\n * @param {boolean} precise - current precision setting of the scales (if true, diff will be counted for smallerCount)\r\n * @param {boolean} wt - shows that diff will be counted for the width of a task\r\n * @returns {number} - an int (if precise is false) or a float number\r\n */\r\nfunction innerDiff(unit, next, prev, precise, wt) {\r\n\tconst minUnit = precise ? smallerCount[unit][0] : unit;\r\n\r\n\tlet start = prev;\r\n\tlet end = next;\r\n\tif (wt) {\r\n\t\tstart = getUnitStart(minUnit, prev);\r\n\t\tend = getUnitStart(minUnit, next);\r\n\t\tif (end < next) end = addUnit(minUnit)(end, 1);\r\n\t}\r\n\r\n\tif (precise) {\r\n\t\tlet filled = diff[minUnit](end, start);\r\n\t\tconst all = smallerCount[unit][1];\r\n\t\treturn filled / (typeof all === \"number\" ? all : all(prev));\r\n\t} else {\r\n\t\treturn diff[minUnit](end, start);\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a function for calculating the difference between two dates in units\r\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\r\n * @returns {function} - details below\r\n */\r\nfunction getDiff(unit) {\r\n\t/**\r\n\t * the returned function calculates the difference between two dates based on passed parameters\r\n\t * @param {Date} next - first date\r\n\t * @param {Date} prev - second date\r\n\t * @param {boolean} precise false by default, true when used to count x-position\r\n\t * and width of tasks with 'step-1' precision\r\n\t * @param {boolean} wt - marker that diff is used to count width of a task;\r\n\t * if diff returns 0, you have to add 1; otherwise tasks that are within 1 unit will have 0 width\r\n\t * and will be displayed incorrectly\r\n\t * @returns {number} - the difference between two dates in 'units'; if 'precise' is true, the number is float, otherwise int\r\n\t */\r\n\treturn (next, prev, precise, wt) => {\r\n\t\tif (unit === \"month\" && precise) {\r\n\t\t\treturn getMonthDayDiff(next, prev, wt);\r\n\t\t} else {\r\n\t\t\treturn innerDiff(unit, next, prev, precise, wt);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Calculates the difference in months between two days for a scale with precision setting\r\n * This is a specific case of diff counting, because a month can have 28-31 days\r\n * @param {Date} end - a later date\r\n * @param {Date} start - an earlier date\r\n * @param {Boolean} wt - shows that diff will be counted for the width of a task\r\n * @returns {number} - a float number\r\n */\r\nfunction getMonthDayDiff(end, start, wt) {\r\n\tif (sameMonth(start, end)) {\r\n\t\treturn innerDiff(\"month\", end, start, true, wt);\r\n\t}\r\n\r\n\t// if starts not on 1st day\r\n\tlet daysOfFirstMonth = 0;\r\n\tif (start.getDate() > 1) {\r\n\t\tconst me = new Date(start.getFullYear(), start.getMonth() + 1, 1);\r\n\t\tdaysOfFirstMonth = innerDiff(\"month\", me, start, true);\r\n\t\tstart = me;\r\n\t}\r\n\r\n\t// if lasts 1+ whole months\r\n\tlet months = 0;\r\n\tif (!sameMonth(start, end)) {\r\n\t\tmonths = innerDiff(\"month\", webix.Date.monthStart(end), start); // int part\r\n\t\tstart = webix.Date.add(start, months, \"month\", true);\r\n\t}\r\n\r\n\t// all above plus days of last month if any\r\n\treturn daysOfFirstMonth + months + innerDiff(\"month\", end, start, true);\r\n}\r\n\r\nfunction sameMonth(a, b) {\r\n\treturn webix.Date.equal(webix.Date.monthStart(a), webix.Date.monthStart(b));\r\n}\r\n\r\nfunction addUnit(unit) {\r\n\treturn add[unit];\r\n}\r\n\r\nfunction getUnitStart(unit, start) {\r\n\tlet t;\r\n\tswitch (unit) {\r\n\t\tcase \"year\":\r\n\t\t\treturn new Date(start.getFullYear(), 0, 1);\r\n\t\tcase \"quarter\":\r\n\t\t\treturn new Date(\r\n\t\t\t\tstart.getFullYear(),\r\n\t\t\t\tMath.floor(start.getMonth() / 3) * 3,\r\n\t\t\t\t1\r\n\t\t\t);\r\n\t\tcase \"month\":\r\n\t\t\treturn new Date(start.getFullYear(), start.getMonth(), 1);\r\n\t\tcase \"week\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setDate(start.getDate() - getDay(start));\r\n\t\t\treturn t;\r\n\t\tcase \"day\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setHours(0, 0, 0, 0);\r\n\t\t\treturn t;\r\n\t\tcase \"hour\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setHours(start.getHours(), 0, 0, 0);\r\n\t\t\treturn t;\r\n\t\tdefault:\r\n\t\t\treturn new Date(start);\r\n\t}\r\n}\n\nfunction getMinUnit(scales) {\r\n\tconst start = new Date();\r\n\treturn scales\r\n\t\t.map(item => ({ item, len: addUnit(item.unit)(start, 1) }))\r\n\t\t.sort((a, b) => (a.len < b.len ? -1 : 1))[0].item.unit;\r\n}\r\n\r\n/**\r\n * Resets scales to new parameters and returns the object that stores related constants and functions\r\n * @param {Date} start - start date\r\n * @param {Date} end - end date\r\n * @param {boolean} precise - flag that defines whether to round task position and width to a smaller unit\r\n * @param {number} width - width of smallest cell unit\r\n * @param {number} height - height of scale cell\r\n * @param {Array} scales - a set of scales (objects)\r\n * @param {function} isHoliday - the function that checks if a day is a holiday\r\n * @returns {Object} scales\r\n */\r\nfunction resetScales(\r\n\tstart,\r\n\tend,\r\n\tprecise,\r\n\twidth,\r\n\theight,\r\n\tscales,\r\n\tisHoliday\r\n) {\r\n\t// console.log(\"[x] reset scales\");\r\n\r\n\tconst minUnit = getMinUnit(scales);\r\n\tconst diff = getDiff(minUnit);\r\n\r\n\tconst tempEnd = getUnitStart(minUnit, end);\r\n\tstart = getUnitStart(minUnit, start);\r\n\tend = tempEnd < end ? addUnit(minUnit)(tempEnd, 1) : tempEnd;\r\n\r\n\tconst fullWidth = diff(end, start) * width;\r\n\tconst fullHeight = height * scales.length;\r\n\r\n\tconst rows = scales.map(line => {\r\n\t\tconst cells = [];\r\n\t\tconst add = addUnit(line.unit);\r\n\t\tconst step = line.step || 1;\r\n\t\tconst countInWeeks = minUnit === \"week\" && line.unit !== \"week\";\r\n\r\n\t\tlet date = getUnitStart(line.unit, start);\r\n\t\twhile (date < end) {\r\n\t\t\tlet next = add(date, step);\r\n\r\n\t\t\tif (date < start) date = start;\r\n\t\t\tif (next > end) next = end;\r\n\r\n\t\t\t/**\r\n\t\t\t * Special handling for counting width of greater units in weeks\r\n\t\t\t * this code decides whether a week belongs to the current greater unit based on weekdays of this unit boundaries\r\n\t\t\t * if start day is Thursday+, then this greater unit should not count this week as its own\r\n\t\t\t * if end day is Thursday+, then this greater unit should count this week as its own\r\n\t\t\t */\r\n\t\t\tlet cdate = date;\r\n\t\t\tlet cnext = next;\r\n\t\t\tif (countInWeeks) {\r\n\t\t\t\tif (getDay(date) > 3) {\r\n\t\t\t\t\tcdate = webix.Date.add(date, 1, \"week\", true);\r\n\t\t\t\t}\r\n\t\t\t\tif (getDay(next) > 3) {\r\n\t\t\t\t\tcnext = webix.Date.add(next, 1, \"week\", true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst cellWidth = (diff(cnext, cdate) || 1) * width;\r\n\r\n\t\t\t/*[ToDo] suggestion\r\n\t\t\t value must not be formatted within engine as it depends on app locale\r\n\t\t\t use scales.format function to format dates in UI\r\n\t\t\t*/\r\n\r\n\t\t\tconst value =\r\n\t\t\t\ttypeof line.format === \"function\"\r\n\t\t\t\t\t? line.format(date, next)\r\n\t\t\t\t\t: format(date, line.format);\r\n\r\n\t\t\tlet css = \"\";\r\n\t\t\tif (line.css)\r\n\t\t\t\tcss += typeof line.css === \"function\" ? line.css(date) : line.css;\r\n\r\n\t\t\tcells.push({\r\n\t\t\t\twidth: cellWidth,\r\n\t\t\t\tvalue,\r\n\t\t\t\tcss,\r\n\t\t\t\tdate,\r\n\t\t\t\tformat: formatFunction(line.format),\r\n\t\t\t});\r\n\r\n\t\t\tdate = next;\r\n\t\t}\r\n\r\n\t\treturn { cells, add, height, type: line.unit, step: line.step || 1 };\r\n\t});\r\n\r\n\tprecise = !!(minUnit === \"day\" ? precise : precise != false);\r\n\r\n\treturn {\r\n\t\trows,\r\n\t\twidth: fullWidth,\r\n\t\theight: fullHeight,\r\n\t\tcellWidth: width,\r\n\t\tcellHeight: height,\r\n\t\tdiff,\r\n\t\tstart,\r\n\t\tend,\r\n\t\tminUnit,\r\n\t\tprecise,\r\n\t\tisHoliday,\r\n\t};\r\n}\r\n\r\nfunction grid(width, height, color) {\r\n\tconst canvas = document.createElement(\"canvas\");\r\n\tcanvas.setAttribute(\"width\", width);\r\n\tcanvas.setAttribute(\"height\", height);\r\n\r\n\tconst ctx = canvas.getContext(\"2d\");\r\n\tctx.strokeStyle = color;\r\n\tctx.moveTo(0, height);\r\n\tctx.lineTo(width, height);\r\n\tctx.lineTo(width, 0);\r\n\tctx.stroke();\r\n\r\n\treturn canvas.toDataURL();\r\n}\n\n/**\r\n * Prepares dimensional coordinates for a task\r\n * @param {Object} task - task data object\r\n * @param {number} i - the index of the task\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {number} taskHeight - the height of a task bar\r\n * @param {number} y - the top position of a task after which the current task will be placed (timeline mode)\r\n * @returns {Object} task data object\r\n */\r\nfunction updateTask(task, i, scales, taskHeight, y) {\r\n\tif (task.type === \"split\" && task.$data && task.$data.length) {\r\n\t\ttask.$data.forEach(k => getSizes(k, i, scales, taskHeight));\r\n\t} else {\r\n\t\tgetSizes(task, i, scales, taskHeight, y);\r\n\t}\r\n\treturn task;\r\n}\r\n\r\nfunction getSizes(task, i, scales, taskHeight, y) {\r\n\tconst { start, end, cellWidth, cellHeight, diff, minUnit, precise } = scales;\r\n\tconst startDate = task.start_date < start ? start : task.start_date;\r\n\tconst endDate = task.end_date > end ? end : task.end_date;\r\n\tconst astart = getUnitStart(minUnit, start);\r\n\r\n\tconst ms = task.type == \"milestone\";\r\n\ttask.$h = taskHeight;\r\n\ttask.$x =\r\n\t\tMath.round(diff(startDate, astart, precise) * cellWidth) -\r\n\t\t(ms ? task.$h / 2 : 0);\r\n\ttask.$w = ms\r\n\t\t? task.$h\r\n\t\t: Math.round(diff(endDate, startDate, precise, true) * cellWidth);\r\n\ttask.$y = webix.isUndefined(y)\r\n\t\t? cellHeight * i + (cellHeight - taskHeight) / 2\r\n\t\t: y;\r\n}\r\n\r\n/**\r\n * Updates start, end and duration fields of tasks during initial loading and updating\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - (optional) the data for current scales; the return value of resetScales()\r\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\r\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\r\n */\r\nfunction updateTaskDuration(task, scales, mode, dir) {\r\n\tif (\r\n\t\ttask.start_date &&\r\n\t\ttask.end_date &&\r\n\t\ttask.start_date.valueOf() >= task.end_date.valueOf()\r\n\t) {\r\n\t\ttask.end_date = null;\r\n\t\ttask.duration = 1;\r\n\r\n\t\tif (mode) mode = \"move\";\r\n\t}\r\n\r\n\tif (scales) {\r\n\t\texcludeHolidays(task, scales, mode, dir);\r\n\t} else {\r\n\t\tif (task.type == \"milestone\") {\r\n\t\t\tgetMilestone(task);\r\n\t\t} else {\r\n\t\t\tif (!task.duration) {\r\n\t\t\t\ttask.duration = getDuration(task);\r\n\t\t\t}\r\n\t\t\tif (!task.end_date) {\r\n\t\t\t\ttask.end_date = getEnd(task);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Excludes holidays from start, end and duration of tasks (can't start or end on a holiday)\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\r\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\r\n */\r\nfunction excludeHolidays(task, scales, mode, dir) {\r\n\tif (task.type == \"milestone\") {\r\n\t\ttask.start_date = mode\r\n\t\t\t? toWorkday(task.start_date, false, scales, dir)\r\n\t\t\t: toClosestWorkday(task.start_date, scales); //on load\r\n\t\treturn getMilestone(task);\r\n\t}\r\n\r\n\tif (!mode) {\r\n\t\t//on load\r\n\t\ttask.start_date = toClosestWorkday(task.start_date, scales);\r\n\t\ttask.end_date = getEndWorkday(task, scales);\r\n\t\ttask.duration = getDuration(task, scales);\r\n\t} else {\r\n\t\tif (mode == \"start\" || mode == \"move\") {\r\n\t\t\ttask.start_date = toWorkday(task.start_date, false, scales, dir);\r\n\t\t\tif (!task.duration) task.duration = getDuration(task, scales);\r\n\t\t\tif (!task.end_date) task.end_date = getEndWorkday(task, scales);\r\n\t\t} else {\r\n\t\t\t//end, duration\r\n\t\t\tif (!task.end_date) task.end_date = getEndWorkday(task, scales);\r\n\t\t\tif (!task.duration) {\r\n\t\t\t\ttask.end_date = toWorkday(task.end_date, true, scales, dir);\r\n\t\t\t\ttask.duration = getDuration(task, scales);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getMilestone(task) {\r\n\ttask.duration = 0;\r\n\ttask.end_date = task.start_date;\r\n}\r\n\r\n/**\r\n * Returns the end date of a task\r\n * @param {Object} task - task data object\r\n */\r\nfunction getEnd(task) {\r\n\tif (task.duration < 1)\r\n\t\treturn addUnit(\"hour\")(task.start_date, Math.floor(24 * task.duration));\r\n\telse return addUnit(\"day\")(task.start_date, task.duration);\r\n}\r\n\r\n/**\r\n * Returns end date excluding holidays from duration\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {Date} end date\r\n */\r\nfunction getEndWorkday(task, scales) {\r\n\tif (task.duration < 1) return getEnd(task);\r\n\r\n\tlet date = getDatePart(task.start_date);\r\n\tfor (let w = 0, d = 0; w < task.duration; ) {\r\n\t\tif (!scales.isHoliday(date)) {\r\n\t\t\t++w;\r\n\t\t\td = 0;\r\n\t\t} else {\r\n\t\t\tif (++d === 30) holidayGuard();\r\n\t\t}\r\n\r\n\t\tdate = addDays(date, 1);\r\n\t}\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * Calculates the duration of a task\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {number} task duration\r\n */\r\nfunction getDuration(task, scales) {\r\n\tconst d = getDiff(\"day\")(task.end_date, task.start_date, true);\r\n\t// allow float duration for tasks smaller than day\r\n\tif (d < 1) return parseFloat(d.toFixed(2));\r\n\r\n\tif (!scales) return Math.floor(d);\r\n\r\n\tlet date = task.start_date;\r\n\tlet duration = 0;\r\n\twhile (date < task.end_date) {\r\n\t\tif (!scales.isHoliday(date)) ++duration;\r\n\t\tdate = addDays(date, 1);\r\n\t}\r\n\treturn duration;\r\n}\r\n\r\n/**\r\n * Moves a date from a holiday to the closest working day (priority to the future)\r\n * @param {Date} date - original date\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {Date} the date of a closest work day\r\n */\r\nfunction toClosestWorkday(date, scales) {\r\n\tlet left = date;\r\n\tlet right = date;\r\n\tlet notRight;\r\n\tlet d = 0;\r\n\r\n\twhile (\r\n\t\td < 30 &&\r\n\t\t(notRight = scales.isHoliday(right)) &&\r\n\t\tscales.isHoliday(left)\r\n\t) {\r\n\t\tleft = addDays(left, -1);\r\n\t\tright = addDays(right, 1);\r\n\t\td++;\r\n\t}\r\n\tif (d === 30) holidayGuard();\r\n\r\n\treturn !notRight ? right : left;\r\n}\r\n\r\nfunction holidayGuard() {\r\n\talert(\r\n\t\t\"No work days found within 30 days, check your isHoliday function!\",\r\n\t\t\"error\"\r\n\t);\r\n\tthrow \"Wrong isHoliday function\";\r\n}\r\n\r\n/**\r\n * Moves a date from a holiday to a working day in the given direction\r\n * @param {Date} date - the current date\r\n * @param {Boolean} end - indicates if this is the end of a task\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {number} dir - the direction in which nearest workday will be located; -1 is the past, 1 is the future\r\n * @returns {Date} the date of a working day\r\n */\r\nfunction toWorkday(date, end, scales, dir) {\r\n\tlet d = 0;\r\n\r\n\twhile (d < 30 && scales.isHoliday(getCheckDate(date, end))) {\r\n\t\tdate = addDays(date, dir);\r\n\t\td++;\r\n\t}\r\n\r\n\tif (d === 30) holidayGuard();\r\n\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * Returns the date for a holiday check\r\n * @param {Date} date - the date\r\n * @param {Boolean} end - if true, means it's the end date (end dates are exclusive)\r\n * @returns {Date} the date that will be used for a check\r\n */\r\nfunction getCheckDate(date, end) {\r\n\treturn end && !getTimePart(date) ? addDays(date, -1) : date;\r\n}\n\nconst delta = 20;\r\n\r\nconst updateLink = function(link, startTask, endTask, height) {\r\n\tconst dy = Math.round(height / 2);\r\n\tif (!startTask || !endTask) {\r\n\t\tlink.$p = \"\";\r\n\t\treturn link;\r\n\t}\r\n\r\n\tlet sx, sy, ex, ey;\r\n\tlet s_start = false;\r\n\tlet e_start = false;\r\n\r\n\tswitch (link.type) {\r\n\t\tcase 0:\r\n\t\t\te_start = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 1:\r\n\t\t\ts_start = true;\r\n\t\t\te_start = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 3:\r\n\t\t\ts_start = true;\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tsx = s_start ? startTask.$x : startTask.$x + startTask.$w;\r\n\tsy = startTask.$y;\r\n\tex = e_start ? endTask.$x : endTask.$x + endTask.$w;\r\n\tey = endTask.$y;\r\n\r\n\tif (differentX(startTask, endTask, sx, ex, height) || sy !== ey) {\r\n\t\tconst lineCoords = getLineCoords(\r\n\t\t\tsx,\r\n\t\t\tsy + dy,\r\n\t\t\tex,\r\n\t\t\tey + dy,\r\n\t\t\ts_start,\r\n\t\t\te_start,\r\n\t\t\t38 / 2\r\n\t\t);\r\n\r\n\t\tconst arrowCoords = getArrowCoords(ex, ey + dy, e_start);\r\n\t\tlink.$p = `${lineCoords},${arrowCoords}`;\r\n\t} else {\r\n\t\tlink.$p = \"\";\r\n\t}\r\n\r\n\treturn link;\r\n};\r\n\r\nfunction differentX(startTask, endTask, sx, ex, height) {\r\n\treturn startTask.type === \"milestone\" || endTask.type === \"milestone\"\r\n\t\t? Math.abs(sx - ex) > height / 2\r\n\t\t: sx !== ex;\r\n}\r\n\r\nfunction getLineCoords(sx, sy, ex, ey, s_start, e_start, gapp) {\r\n\tconst shift = delta * (s_start ? -1 : 1);\r\n\tconst backshift = delta * (e_start ? -1 : 1);\r\n\r\n\tconst sx1 = sx + shift;\r\n\tconst ex1 = ex + backshift;\r\n\tconst line = [sx, sy, sx1, sy, 0, 0, 0, 0, ex1, ey, ex, ey];\r\n\r\n\tconst dx = ex1 - sx1;\r\n\tlet dy = ey - sy;\r\n\r\n\tconst same = e_start === s_start;\r\n\tif (!same && ((ex1 <= sx && e_start) || (ex1 > sx && !e_start))) {\r\n\t\tdy -= gapp;\r\n\t}\r\n\r\n\tif ((same && e_start && sx1 > ex1) || (same && !e_start && sx1 < ex1)) {\r\n\t\tline[4] = line[2] + dx;\r\n\t\tline[5] = line[3];\r\n\t\tline[6] = line[4];\r\n\t\tline[7] = line[5] + dy;\r\n\t} else {\r\n\t\tline[4] = line[2];\r\n\t\tline[5] = line[3] + dy;\r\n\t\tline[6] = line[4] + dx;\r\n\t\tline[7] = line[5];\r\n\t}\r\n\r\n\treturn line.join(\",\");\r\n}\r\n\r\nfunction getArrowCoords(x, y, start) {\r\n\tif (start) {\r\n\t\treturn `${x - 5},${y - 3},${x - 5},${y + 3},${x},${y}`;\r\n\t} else {\r\n\t\treturn `${x + 5},${y + 3},${x + 5},${y - 3},${x},${y}`;\r\n\t}\r\n}\r\n\r\nfunction newLink(box, start, end) {\r\n\tif (start && end) {\r\n\t\tconst width = end.x - start.x;\r\n\t\tconst height = end.y - start.y;\r\n\t\tconst left = (width > 0 ? start.x : end.x) - box.left;\r\n\t\tconst top = (height > 0 ? start.y : end.y) - box.top;\r\n\t\tconst p = `${width > 0 ? 0 : -width},${height > 0 ? 0 : -height},${\r\n\t\t\twidth > 0 ? width : 0\r\n\t\t},${height > 0 ? height : 0}`;\r\n\t\treturn { width: Math.abs(width), height: Math.abs(height), left, top, p };\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\n\nexports.addUnit = addUnit;\nexports.getDiff = getDiff;\nexports.getUnitStart = getUnitStart;\nexports.grid = grid;\nexports.newLink = newLink;\nexports.resetScales = resetScales;\nexports.smallerCount = smallerCount;\nexports.updateLink = updateLink;\nexports.updateTask = updateTask;\nexports.updateTaskDuration = updateTaskDuration;\n//# sourceMappingURL=wgantt.js.map\n","function updateDragPos(e, pos) {\n\tif (webix.DragControl.active) {\n\t\tconst node = webix.DragControl.getNode();\n\n\t\tpos = webix.copy(pos);\n\t\twebix.DragControl.$dragPos(pos, e);\n\n\t\tnode.style.top = pos.y + webix.DragControl.top + \"px\";\n\t\tnode.style.left = pos.x + webix.DragControl.left + \"px\";\n\t}\n}\n\nconst DragScroll = {\n\tstart(ctx, e) {\n\t\tctx._auto_scroll_delay = webix.delay(\n\t\t\tDragScroll.autoScroll,\n\t\t\tctx,\n\t\t\t[e, webix.html.pos(e)],\n\t\t\t250\n\t\t);\n\t},\n\n\treset(ctx) {\n\t\tif (ctx._auto_scroll_delay)\n\t\t\tctx._auto_scroll_delay = window.clearTimeout(ctx._auto_scroll_delay);\n\t},\n\n\tautoScroll(e, pos) {\n\t\tconst yScroll = this.direction.indexOf(\"y\") !== -1;\n\t\tconst xScroll = this.direction.indexOf(\"x\") !== -1;\n\t\tconst box = webix.html.offset(this.from.view.$view);\n\n\t\tlet reset = false;\n\t\tif (yScroll && DragScroll.autoYScroll.call(this, pos, box, this.senseY))\n\t\t\treset = true;\n\t\tif (xScroll && DragScroll.autoXScroll.call(this, pos, box, this.senseX))\n\t\t\treset = true;\n\n\t\tif (reset) {\n\t\t\tupdateDragPos(e, pos);\n\t\t\tthis._auto_scroll_delay = webix.delay(\n\t\t\t\tDragScroll.autoScroll,\n\t\t\t\tthis,\n\t\t\t\t[e, pos],\n\t\t\t\t100\n\t\t\t);\n\t\t}\n\t},\n\n\tautoYScroll(pos, box, sense) {\n\t\tconst scroll = this.from.view.getScrollState();\n\n\t\tif (pos.y < box.y + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y - sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t} else if (pos.y > box.y + box.height - sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y + sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoXScroll(pos, box, sense) {\n\t\tconst scroll = this.from.view.getScrollState();\n\n\t\tif (pos.x < box.x + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x - sense,\n\t\t\t\tscroll.y,\n\t\t\t\t\"x\"\n\t\t\t);\n\t\t} else if (pos.x > box.x + box.width - sense) {\n\t\t\tconst x = this.snode\n\t\t\t\t? Math.min(scroll.x + sense, this.snode.scrollWidth - box.width)\n\t\t\t\t: scroll.x + sense;\n\t\t\treturn x == scroll.x\n\t\t\t\t? false\n\t\t\t\t: DragScroll.autoScrollTo.call(this, x, scroll.y, \"x\");\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoScrollTo(x, y, mode) {\n\t\tthis.from.view.scrollTo(x, y);\n\t\tthis.from.view.callEvent(\"onAfterAutoScroll\", []);\n\n\t\tconst scroll = this.from.view.getScrollState();\n\t\treturn Math.abs((mode === \"x\" ? x : y) - scroll[mode]) < 1;\n\t},\n};\n\nexport default DragScroll;\n","import { Resizer } from \"./resizer\";\nimport {\n\tgetParams,\n\tcutOccurrence,\n\tclipSequence,\n\tmovePattern,\n} from \"./recurring\";\nimport { isSameDate } from \"./dates\";\nimport { serialize } from \"./ical\";\nimport { smallerCount, getUnitStart, addUnit } from \"@xbs/webix-gantt-lib\";\nimport DragScroll from \"./dragscroll\";\n\nexport function initDnD(view, mode, dragOnly) {\n\tconst ctrl = webix.copy(modes[mode]);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\tctrl.State = this.app.getState();\n\tctrl.Local = this.app.getService(\"local\").events(true);\n\tctrl.Ops = this.app.getService(\"operations\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\tif (!dragOnly) webix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function locateEvent(e, view) {\n\tlet target = e.target;\n\tlet id, node;\n\n\tdo {\n\t\tid = target.getAttribute ? target.getAttribute(\"webix_e_id\") : null;\n\t\tnode = id ? target : null;\n\t\ttarget = target.parentNode;\n\t} while (!id && target && target !== view);\n\n\treturn { id, node };\n}\n\nfunction updateSelection(prev, date) {\n\tif (this.State.selected) {\n\t\tconst selection = getParams(prev);\n\t\tif (prev.$recurring)\n\t\t\tselection.date = date.start_date.valueOf() + \"_\" + prev.$id;\n\n\t\tthis.State.selected = selection;\n\t}\n}\n\n/**\n * Updates dates/time of a recurring event\n * @param {string} mode - the mode for editing (\"all\", \"next\", \"this\", \"\")\n * @param {Object} obj - the event data object\n * @param {Object} change - the new dates\n * @returns {Promise}\n */\nfunction editRecurring(mode, obj, change) {\n\tlet id = obj.$id || obj.id;\n\n\t/* special cases */\n\t// if 'this' edited as 'this'\n\tif (mode === \"this\" && this.master.HasOneOccurrence(obj)) {\n\t\treturn this.Ops.updateEvent(id, change, undefined, undefined, true);\n\t}\n\t// if 1st occurrence in whole sequence or in 'next'\n\tmode = this.master.ChangeMode(\n\t\tmode,\n\t\tobj,\n\t\tthis.Local.getItem(obj.recurring ? id : obj.origin_id).start_date,\n\t\tobj.recurring ? obj.id : obj.start_date\n\t);\n\tif (!mode) {\n\t\t// if date was changed\n\t\tobj.$recurring = movePattern(obj.$recurring, change, obj);\n\t\tchange.recurring = serialize(obj.$recurring);\n\t\treturn this.Ops.updateEvent(id, change, undefined, undefined, true);\n\t}\n\n\tif (mode === \"this\" || mode === \"next\") {\n\t\t// cut out occurrence or split event sequence and save as separate events\n\t\tlet recurring = \"\";\n\t\tlet parent;\n\t\tif (mode === \"this\") {\n\t\t\trecurring = cutOccurrence(obj.id, obj);\n\t\t} else {\n\t\t\tif (obj.recurring) {\n\t\t\t\trecurring = clipSequence(obj.id, webix.copy(obj));\n\t\t\t} else {\n\t\t\t\t// if 'this' edited as 'next'\n\t\t\t\tid = obj.origin_id;\n\t\t\t\tparent = webix.copy(this.Local.getItem(id));\n\t\t\t\trecurring = clipSequence(change.start_date, webix.copy(parent), true);\n\t\t\t}\n\t\t}\n\n\t\tconst newEvent = newSubEvent.call(this, id, mode, obj, change, parent);\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tid,\n\t\t\t{ recurring },\n\t\t\tmode,\n\t\t\twebix.Date.dayStart(newEvent.start_date),\n\t\t\ttrue\n\t\t).then(() => {\n\t\t\treturn this.Ops.addEvent(newEvent, true);\n\t\t});\n\t}\n\n\tif (mode === \"all\") {\n\t\tconst oid = obj.origin_id || obj.$id;\n\t\tconst all = webix.copy(this.Local.getItem(oid));\n\t\tlet rec = all.$recurring;\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\tall,\n\t\t\t\tmode,\n\t\t\t\tchange.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\n\t\tif (!change.start_date || isSameDate(obj.start_date, change.start_date)) {\n\t\t\tif (change.start_date) {\n\t\t\t\tchange.start_date = joinDateTime(all.start_date, change.start_date);\n\t\t\t}\n\n\t\t\tif (change.end_date) {\n\t\t\t\tif (isSameDate(obj.end_date, change.end_date)) {\n\t\t\t\t\tchange.end_date = joinDateTime(all.end_date, change.end_date);\n\t\t\t\t} else {\n\t\t\t\t\tchange.end_date = shiftDate(\n\t\t\t\t\t\tall.end_date,\n\t\t\t\t\t\tobj.end_date,\n\t\t\t\t\t\tchange.end_date\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// in timeline mode, the user can change start date without end date (resize start)\n\t\t\tif (!change.end_date) {\n\t\t\t\tchange.start_date = shiftDate(\n\t\t\t\t\tall.start_date,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tchange.start_date\n\t\t\t\t);\n\t\t\t}\n\t\t\trec = movePattern(rec, change, all);\n\t\t}\n\n\t\tif (change.start_date) {\n\t\t\tif (rec.EXDATE) delete rec.EXDATE;\n\t\t\tchange.recurring = serialize(rec);\n\t\t}\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tobj.origin_id || id,\n\t\t\tchange,\n\t\t\tmode,\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\t}\n}\n\nfunction shiftDate(mainDate, occDate, changeDate) {\n\treturn new Date(mainDate * 1 + (changeDate - occDate));\n}\n\n/**\n * Adds the time of the second date to the date part of the first date and returns the resulting date\n * @param {Date} ddate\n * @param {Date} dtime\n * @returns {Date}\n */\nfunction joinDateTime(ddate, dtime) {\n\tconst time = webix.Date.timePart(dtime) * 1000;\n\treturn new Date(webix.Date.dayStart(ddate) * 1 + time);\n}\n\nfunction newSubEvent(id, mode, obj, change, parent) {\n\tconst newEvent = { ...obj, ...change, recurring: \"\" };\n\tif (!newEvent.origin_id) newEvent.origin_id = id;\n\n\tif (mode === \"next\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tlet rec = webix.copy(obj.recurring ? obj.$recurring : parent.$recurring);\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\t{ ...this.Local.getItem(id), $recurring: rec },\n\t\t\t\tmode,\n\t\t\t\tnewEvent.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, newEvent, obj); // if date was changed\n\t\trec.EXDATE = [];\n\n\t\tnewEvent.recurring = serialize(rec);\n\t}\n\n\t// reserved key of recurring inner logic, must not stay in new data\n\tdelete newEvent.$id;\n\n\treturn newEvent;\n}\n\nconst common = {\n\tmode: \"common\",\n\t$dragDestroy: function(target, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (!ctx.$waitUpdate) ctx.node.style.visibility = \"visible\";\n\t\tif (ctx.$resize) webix.html.removeCss(document.body, \"webix_active_resize\");\n\n\t\twebix.html.remove(node);\n\n\t\tif (ctx.moveMode === \"move\") DragScroll.reset(ctx);\n\n\t\treturn false;\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n\tupdateEvent: function(event, data, ctx) {\n\t\tif (ctx.event.$id || ctx.event.origin_id) {\n\t\t\tthis.master._waitPopup = webix.promise.defer();\n\t\t\tthis.master._waitPopup\n\t\t\t\t.then(o => {\n\t\t\t\t\tconst res = editRecurring.call(this, o, ctx.event, data);\n\n\t\t\t\t\tres.then(() => updateSelection.call(this, event, data));\n\t\t\t\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\t\t\t})\n\t\t\t\t.finally(() => (this.master._waitPopup = null));\n\t\t\tthis.master.app._dndActionPopup.Show(this.master._waitPopup);\n\t\t} else {\n\t\t\tconst res = this.Ops.updateEvent(\n\t\t\t\tevent.$id || event.id,\n\t\t\t\tdata,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\ttrue\n\t\t\t);\n\t\t\tthis.finishOperation(res, event, data, ctx);\n\t\t}\n\t},\n\taddEvent: function(event, data, ctx) {\n\t\tconst newEvent = {\n\t\t\ttext: event.text,\n\t\t\tstart_date: data.start_date,\n\t\t\tend_date: data.end_date,\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.master.app.config.calendars) {\n\t\t\tnewEvent.calendar = event.calendar;\n\t\t}\n\t\tif (this.master.app.config.timeline) {\n\t\t\tnewEvent.section = data.section || event.section;\n\t\t}\n\n\t\tif (this.master.app.config.units && event.units) {\n\t\t\tnewEvent.units = data.units || event.units;\n\t\t}\n\n\t\tconst res = this.Ops.addEvent(newEvent, true);\n\t\tthis.finishOperation(res, newEvent, data, ctx);\n\t},\n\n\tfinishOperation(res, event, data, ctx) {\n\t\tres.then(id =>\n\t\t\tupdateSelection.call(this, id ? { ...event, id } : event, data)\n\t\t);\n\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\tctx[\"$waitUpdate\"] = true;\n\t},\n};\n\nconst day = webix.extend(\n\t{\n\t\tmode: \"day\",\n\t\t$dragIn: function(source, target) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragIn.apply(this, arguments);\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tif (ctx.target != target) {\n\t\t\t\tconst node = webix.DragControl.getNode();\n\n\t\t\t\ttarget.firstChild.appendChild(node);\n\t\t\t\tctx.target = target;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!this.master.app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst date = this.getActualDate(this.master);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragPos.apply(this, arguments);\n\n\t\t\tconst box = webix.html.offset(ctx.target);\n\t\t\tconst max = box.height - ctx.height;\n\n\t\t\tpos.x = ctx.x_diff;\n\t\t\tpos.y += ctx.y_offset - box.y;\n\n\t\t\tif (pos.y < 0) pos.y = 0;\n\t\t\telse if (pos.y > max) pos.y = max;\n\n\t\t\twebix.extend(ctx, pos, true);\n\n\t\t\tif (ctx.$last_y !== pos.y) {\n\t\t\t\tthis.updateText(ctx);\n\t\t\t\tctx.$last_y = pos.y;\n\t\t\t}\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tctx.event = this.master.GetEvent(event.id);\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tif (e.target.getAttribute(\"webix_resizer\")) {\n\t\t\t\t\tctx[\"$resize\"] = true;\n\t\t\t\t}\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (ctx.$resize) {\n\t\t\t\t\twebix.html.addCss(document.body, \"webix_active_resize\", true);\n\t\t\t\t}\n\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.className += ` webix_drag_zone webix_${\n\t\t\t\t\tctx.$resize ? \"resize\" : \"drag\"\n\t\t\t\t}_event`;\n\t\t\t\ttarget.firstChild.appendChild(html);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\t\t\t\treturn html;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(master, any) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.getActualDate.apply(this, arguments);\n\n\t\t\tconst date = webix.Date.copy(master.Day);\n\t\t\t//scale start correction\n\t\t\tconst delta = master.List.getFirstId() * master.List.type.height;\n\t\t\tconst minutes =\n\t\t\t\tMath.round(((ctx.y + delta) * 60) / master.List.type.height / 5) * 5;\n\n\t\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\t\tif (!any && webix.Date.equal(date, ctx.event.start_date)) return null;\n\n\t\t\tconst duration = ctx.event.end_date - ctx.event.start_date;\n\t\t\treturn {\n\t\t\t\tstart_date: date,\n\t\t\t\tend_date: new Date(date.valueOf() + duration),\n\t\t\t};\n\t\t},\n\t\tupdateText: function(ctx) {\n\t\t\tconst node = webix.DragControl.getNode();\n\t\t\tconst ctrl = webix.DragControl.getMaster(ctx.target);\n\n\t\t\tconst event = this.getActualDate(ctrl.master, true);\n\t\t\tevent.text = ctx.event.text;\n\n\t\t\tnode.innerHTML = \"\";\n\t\t\tnode.innerHTML = ctrl.master.EventTemplate(event);\n\t\t},\n\t\tsetDragOffset: function(node, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\t\t\tconst noff = webix.html.offset(node);\n\n\t\t\tctx.height = noff.height;\n\t\t\tctx.x_offset = noff.x - pos.x;\n\t\t\tctx.y_offset = noff.y - pos.y;\n\n\t\t\tconst toff = webix.html.offset(target);\n\t\t\tctx.x_diff = noff.x - toff.x - 1; // 1px border\n\t\t\tctx.y_diff = noff.y - toff.y;\n\t\t},\n\t},\n\tcommon\n);\n\nconst month = webix.extend(\n\t{\n\t\tmode: \"month\",\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tconst index = this.locate(e);\n\t\t\tconst id = this.view.getIdByIndex(index);\n\t\t\tconst node = this.view.getItemNode(id);\n\n\t\t\tif (ctx.$marked !== id) this.markDropArea(id);\n\n\t\t\treturn node;\n\t\t},\n\t\t$dragOut: function(source, target, drop) {\n\t\t\tif (target !== drop) this.markDropArea();\n\t\t\treturn null;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!this.master.app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.markDropArea();\n\n\t\t\tconst date = this.getActualDate(e);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tpos.x += ctx.x_offset;\n\t\t\tpos.y += ctx.y_offset;\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{ from: this, offset: webix.html.offset(target) },\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst diff = this.locate(e) - this.view.getIndexById(ctx.start);\n\n\t\t\tif (!diff) return null;\n\n\t\t\treturn {\n\t\t\t\tstart_date: webix.Date.add(ctx.event.start_date, diff, \"day\", true),\n\t\t\t\tend_date: webix.Date.add(ctx.event.end_date, diff, \"day\", true),\n\t\t\t};\n\t\t},\n\t\tmarkDropArea: function(id) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$marked && ctx.$marked != id) {\n\t\t\t\tthis.view.removeCss(ctx.$marked, \"webix_drag_over\");\n\t\t\t\tctx.$marked = null;\n\n\t\t\t\tif (ctx.$extra) {\n\t\t\t\t\twebix.html.removeCss(this.view.$view, ctx.$extra);\n\t\t\t\t\tctx.$extra = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!ctx.$marked && id) {\n\t\t\t\tthis.view.addCss(id, \"webix_drag_over\");\n\t\t\t\tctx.$marked = id;\n\n\t\t\t\tlet extra;\n\t\t\t\tif (this.view.getFirstId() == id) extra = \"webix_scheduler_dnd_1\";\n\t\t\t\telse if (this.view.getLastId() == id) extra = \"webix_scheduler_dnd_n\";\n\n\t\t\t\tif (extra) {\n\t\t\t\t\twebix.html.addCss(this.view.$view, extra, true);\n\t\t\t\t\tctx.$extra = extra;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\n\t\t\tpos.x -= ctx.offset.x;\n\t\t\tpos.y -= ctx.offset.y;\n\n\t\t\treturn (\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.y / this.view.type.height),\n\t\t\t\t\tthis.view.config.yCount - 1\n\t\t\t\t) *\n\t\t\t\t\tthis.view.config.xCount +\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.x / this.view.type.width),\n\t\t\t\t\tthis.view.config.xCount - 1\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t},\n\tcommon\n);\n\nconst multiday = webix.extend(\n\t{\n\t\tmode: \"multiday\",\n\t},\n\tmonth\n);\n\nconst more = webix.extend(\n\t{\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\t\t\t\twebix.extend(ctx, { from: this, id }, true);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\tmonth\n);\n\nconst units = webix.extend(\n\t{\n\t\tmode: \"units\",\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!this.master.app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst date = this.getActualDate(this.master);\n\t\t\tconst units = this.getEventUnits(ctx.event, ctx.from);\n\n\t\t\tif (date || units) {\n\t\t\t\tconst update = webix.extend(date || {}, units || {});\n\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, update, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, update, ctx);\n\t\t\t}\n\t\t},\n\t\tgetEventUnits: function(event, source) {\n\t\t\tconst currentUnits = event.units.split(\",\");\n\t\t\tconst targetUnit = this.master.Unit.id + \"\";\n\t\t\tconst sourceUnit = source.master.Unit.id + \"\";\n\n\t\t\tif (targetUnit == sourceUnit) return;\n\n\t\t\tconst newUnits = currentUnits.filter(unit => unit != sourceUnit);\n\t\t\tif (currentUnits.indexOf(targetUnit) === -1) {\n\t\t\t\tnewUnits.push(targetUnit);\n\t\t\t}\n\n\t\t\treturn { units: newUnits.join(\",\") };\n\t\t},\n\t},\n\tday\n);\n\nconst timeline = webix.extend(\n\t{\n\t\tmode: \"timeline\",\n\t\tdragScroll: {\n\t\t\tdirection: \"xy\",\n\t\t},\n\t\t// here we locate the section, not the day\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst nscroll = this.view.getScrollState();\n\t\t\tconst y = webix.html.pos(e).y - ctx.offset.y + nscroll.y;\n\t\t\tconst height = this.view.$scope.Sections.count();\n\t\t\tconst res = Math.min(Math.floor(y / this.view.type.height), height - 1);\n\t\t\treturn res;\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tif (\n\t\t\t\tthis.State.readonly ||\n\t\t\t\t!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])\n\t\t\t)\n\t\t\t\treturn false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst node = event.node;\n\t\t\t\tconst evContext = this.getEventContext(e);\n\t\t\t\tconst moveMode = getMoveMode(node, evContext.x);\n\t\t\t\tconst scroll = this.view.getScrollState();\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{\n\t\t\t\t\t\t...event,\n\t\t\t\t\t\tfrom: this,\n\t\t\t\t\t\toffset: webix.html.offset(target),\n\t\t\t\t\t\tmoveMode,\n\t\t\t\t\t\tstep: this.getStep(),\n\t\t\t\t\t\tdx: 0,\n\t\t\t\t\t\tscroll,\n\t\t\t\t\t\tx: evContext.x,\n\t\t\t\t\t\tt: parseInt(node.style.top),\n\t\t\t\t\t\tl: parseInt(node.style.left),\n\t\t\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tif (ctx.moveMode === \"move\")\n\t\t\t\t\twebix.extend(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tupdateDragScrollConfig.call(\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\tthis.dragScroll,\n\t\t\t\t\t\t\tthis.view.$scope.Scales\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tnode.parentNode.appendChild(drag_container);\n\n\t\t\t\tnode.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetEventContext: function(e) {\n\t\t\tif (webix.env.touch) {\n\t\t\t\tif (e.changedTouches && !(e.touches && e.touches[0])) {\n\t\t\t\t\tconst t = e.changedTouches[0];\n\t\t\t\t\treturn { x: t.pageX, y: t.pageY };\n\t\t\t\t}\n\t\t\t\treturn e.time ? e : webix.env.mouse.context(e);\n\t\t\t}\n\t\t\treturn { x: e.clientX, y: e.clientY };\n\t\t},\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tconst id = this.view.getIdByIndex(this.locate(e));\n\t\t\tconst node = this.view.getItemNode(id);\n\n\t\t\tif (\n\t\t\t\tctx.moveMode === \"move\" &&\n\t\t\t\twebix.$$(ctx.from.view.config.id).isVisible()\n\t\t\t) {\n\t\t\t\tDragScroll.reset(ctx);\n\t\t\t\tDragScroll.start(ctx, e);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst { x, t, l, w, offset, scroll, step, moveMode } = ctx;\n\t\t\tconst nscroll = this.view.getScrollState();\n\t\t\tctx.dx = pos.x - x - (scroll ? scroll.x : 0) + nscroll.x;\n\t\t\tconst node = webix.DragControl.getNode();\n\n\t\t\tif (moveMode === \"move\") {\n\t\t\t\tpos.x += ctx.x_offset - offset.x + nscroll.x;\n\t\t\t\tpos.y += ctx.y_offset - offset.y + nscroll.y;\n\t\t\t} else if (moveMode === \"start\") {\n\t\t\t\tpos.x = Math.min(l + ctx.dx, l + w - step);\n\t\t\t\tpos.y = t;\n\t\t\t\tnode.childNodes[0].style.width = node.style.width = `${Math.max(\n\t\t\t\t\tstep,\n\t\t\t\t\tw - ctx.dx\n\t\t\t\t)}px`;\n\t\t\t} else if (moveMode === \"end\") {\n\t\t\t\tpos.x = l;\n\t\t\t\tpos.y = t;\n\t\t\t\tnode.childNodes[0].style.width = node.style.width = `${Math.max(\n\t\t\t\t\tw + ctx.dx,\n\t\t\t\t\tstep\n\t\t\t\t)}px`;\n\t\t\t}\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!this.master.app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst data = this.getData(e);\n\t\t\tif (data) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, data, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, data, ctx);\n\t\t\t}\n\t\t},\n\t\tgetData: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst res = {};\n\t\t\tconst section = this.view.getIdByIndex(this.locate(e));\n\t\t\tconst { moveMode, dx, step } = ctx;\n\n\t\t\tconst time = Math.round(dx / (step || this.getStep()));\n\n\t\t\tif (section != ctx.start || time) {\n\t\t\t\tif (moveMode === \"move\") res.section = section;\n\t\t\t\tconst scales = this.view.$scope.Scales;\n\t\t\t\twebix.extend(res, updateEventDates(ctx.event, scales, moveMode, time));\n\t\t\t\treturn res;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tgetStep() {\n\t\t\tconst scales = this.view.$scope.Scales;\n\t\t\tlet step = scales.cellWidth;\n\t\t\tif (scales.precise) {\n\t\t\t\tconst nsc = smallerCount[scales.minUnit][1];\n\t\t\t\tstep = Math.round(step / (typeof nsc === \"number\" ? nsc : nsc()));\n\t\t\t}\n\t\t\treturn step;\n\t\t},\n\t},\n\tmonth\n);\n\nconst timelineMore = webix.extend(\n\t{\n\t\tmode: \"timeline\",\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst ctx = this.getContext();\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\n\t\t\t\twebix.extend(ctx, { from: this, id, moveMode: \"move\" }, true);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.x = ctx.event.$x + parseInt(target.offsetParent.style.left);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\ttimeline\n);\n\nfunction updateEventDates(event, scales, mode, time) {\n\tconst obj = {};\n\n\tconst unit = scales.precise\n\t\t? smallerCount[scales.minUnit][0]\n\t\t: scales.minUnit;\n\tif (mode === \"start\" || mode === \"move\") {\n\t\tconst offsetDate = scales.precise\n\t\t\t? event.start_date\n\t\t\t: getUnitStart(unit, event.start_date);\n\t\tobj.start_date = addUnit(unit)(offsetDate, time);\n\t\tif (\n\t\t\tmode === \"start\" &&\n\t\t\twrongDates(obj.start_date, event.end_date, obj.all_day)\n\t\t)\n\t\t\tobj.start_date = addUnit(unit)(event.end_date, -1);\n\n\t\tif (webix.Date.equal(obj.start_date, event.start_date)) {\n\t\t\tdelete obj.start_date;\n\t\t}\n\t}\n\tif (mode === \"end\" || mode === \"move\") {\n\t\tconst us = getUnitStart(unit, event.end_date);\n\t\tconst offsetDate =\n\t\t\tscales.precise || webix.Date.equal(us, event.end_date)\n\t\t\t\t? event.end_date\n\t\t\t\t: addUnit(unit)(us, 1);\n\t\tobj.end_date = addUnit(unit)(offsetDate, time);\n\n\t\tif (\n\t\t\twrongDates(obj.start_date || event.start_date, obj.end_date, obj.all_day)\n\t\t)\n\t\t\tobj.end_date = addUnit(unit)(event.start_date, 1);\n\n\t\tif (webix.Date.equal(obj.end_date, event.end_date)) {\n\t\t\tdelete obj.end_date;\n\t\t}\n\t}\n\n\treturn obj;\n}\n\nfunction wrongDates(start, end, allDay) {\n\treturn allDay ? end < start : end <= start;\n}\n\nfunction getMoveMode(node, x) {\n\tconst rect = node.getBoundingClientRect();\n\tconst p = (x - rect.left) / rect.width;\n\tconst minWidth = webix.env.touch ? 400 : 200;\n\tconst delta = 0.2 / (rect.width > minWidth ? rect.width / minWidth : 1);\n\n\tif (\n\t\tp < delta &&\n\t\tnode.className.indexOf(\"webix_scheduler_event_break_left\") == -1\n\t)\n\t\treturn \"start\";\n\tif (\n\t\tp > 1 - delta &&\n\t\tnode.className.indexOf(\"webix_scheduler_event_break_right\") == -1\n\t)\n\t\treturn \"end\";\n\n\treturn \"move\";\n}\n\nfunction updateDragScrollConfig(ds, scales) {\n\tds.senseX = Math.round(scales.cellWidth * (webix.env.touch ? 1 : 0.5));\n\tds.senseY = Math.round(scales.cellHeight * (webix.env.touch ? 3 : 1));\n\treturn ds;\n}\n\nexport function switchCursor(e, view) {\n\tif (webix.DragControl.active) return;\n\tconst { id, node } = locateEvent(e, view);\n\tif (id) {\n\t\tconst mode = getMoveMode(node, e.clientX);\n\t\tnode.style.cursor = mode == \"move\" ? \"pointer\" : \"ew-resize\";\n\t}\n}\n\nconst modes = {\n\tday,\n\tmonth,\n\tmore,\n\tmultiday,\n\tunits,\n\ttimeline,\n\ttimelineMore,\n};\n","import HourscaleView from \"../common/hourscale\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class DayEventsView extends HourscaleView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\t// when dayevents is a part of week\n\t\tif (config) {\n\t\t\tthis.WeekDayNum = config.day;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"dayList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"dayList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"day\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.Day = webix.Date.datePart(this.State.date, true);\n\n\t\t\tif (this.WeekDayNum > -1) {\n\t\t\t\tconst weekStart = this.data.start;\n\t\t\t\tthis.Day = webix.Date.add(weekStart, this.WeekDayNum, \"day\", true);\n\t\t\t}\n\n\t\t\tconst to = webix.Date.add(this.Day, 1, \"day\", true);\n\t\t\tthis.Events = this.FilterToday(this.Day, to);\n\n\t\t\tif (this._marker_update_interval)\n\t\t\t\tthis._marker_update_interval = clearInterval(\n\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t);\n\n\t\t\tif (isToday(this.Day))\n\t\t\t\tthis._marker_update_interval = setInterval(() => {\n\t\t\t\t\tif (isToday(this.Day)) this.UpdateMarkerPosition();\n\t\t\t\t\telse {\n\t\t\t\t\t\twebix.html.remove(this._Marker);\n\t\t\t\t\t\tthis._Marker = this._marker_update_interval = clearInterval(\n\t\t\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}, 5 * 60 * 1000); // 5 minutes\n\n\t\t\tthis.List.render();\n\t\t}\n\t}\n\n\tGetEvent(id) {\n\t\tfor (let i = 0; i < this.Events.length; i++)\n\t\t\tif (this.Events[i].id == id) return this.Events[i];\n\t\treturn null;\n\t}\n\n\tFilterToday(value, to) {\n\t\tif (this.WeekDayNum > -1) {\n\t\t\treturn this.data.single.filter(ev => {\n\t\t\t\tif (ev.start_date < to && ev.end_date > value) return true;\n\t\t\t});\n\t\t}\n\t\treturn this.data.single;\n\t}\n\n\tMarkToday() {\n\t\tif (this.Day && isToday(this.Day)) {\n\t\t\tconst marker = webix.html.create(\"div\", {\n\t\t\t\tclass: \"webix_scheduler_today_marker\",\n\t\t\t});\n\t\t\tthis._Marker = this.List.$view.firstChild.appendChild(marker);\n\t\t\tthis.UpdateMarkerPosition();\n\t\t} else {\n\t\t\tthis._Marker = null;\n\t\t}\n\t}\n\n\tUpdateMarkerPosition() {\n\t\tif (this._Marker) {\n\t\t\tconst current = new Date();\n\t\t\tconst time = current.getHours() * 60 + current.getMinutes();\n\t\t\tthis._Marker.style.top =\n\t\t\t\tMath.round((time * this.List.type.height) / 60) + \"px\";\n\t\t}\n\t}\n\n\tRenderEvents() {\n\t\tconst evs = this.Events;\n\t\tif (evs && evs.length) {\n\t\t\tthis.PrepareEvents();\n\t\t\tconst container = webix.html.create(\"div\", {\n\t\t\t\trole: \"presentation\",\n\t\t\t});\n\t\t\tcontainer.innerHTML = evs.map(i => this.ToHTML(i)).join(\"\");\n\t\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t\t}\n\t\tthis.MarkToday();\n\t}\n\n\tPrepareEvents() {\n\t\tconst evs = this.Events;\n\t\tlet stack = [];\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\t\t\tev.$inner = false;\n\n\t\t\tlet orderSet = this.PruneStack(ev, stack);\n\n\t\t\tif (stack.length) {\n\t\t\t\tstack[stack.length - 1].$inner = true;\n\t\t\t}\n\n\t\t\tif (!orderSet) {\n\t\t\t\tif (stack.length) {\n\t\t\t\t\tev.$sorder = stack[stack.length - 1].$sorder + 1;\n\t\t\t\t\tev.$inner = false;\n\t\t\t\t} else {\n\t\t\t\t\tev.$sorder = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// insert new event into stack\n\t\t\tstack.splice(ev.$sorder, 0, ev);\n\t\t\tif (stack.length > (stack.max_count || 0)) {\n\t\t\t\tstack.max_count = stack.length;\n\t\t\t}\n\t\t}\n\n\t\tthis.SetPosition(stack, evs);\n\t}\n\n\t// returns true if new event was marked for inserting;\n\t// false if stack is empty or there is no suitable place for new event inside\n\tPruneStack(newEvent, stack) {\n\t\t// clean events from top of stack if new event starts after they end\n\t\twhile (\n\t\t\tstack.length &&\n\t\t\tthis.GetEventEndDate(stack[stack.length - 1]) <= newEvent.start_date\n\t\t) {\n\t\t\tstack.splice(stack.length - 1, 1);\n\t\t}\n\n\t\t// clean 1 event from within remaining stack if this event ends before new event starts\n\t\tfor (let j = 0; j < stack.length; j++) {\n\t\t\tif (this.GetEventEndDate(stack[j]) <= newEvent.start_date) {\n\t\t\t\tnewEvent.$sorder = stack[j].$sorder; // mark new event for this place in stack\n\t\t\t\tstack.splice(j, 1);\n\t\t\t\tnewEvent.$inner = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tSetPosition(stack, evs) {\n\t\t//scale start correction\n\t\tconst delta = this.List.getFirstId() * this.List.type.height;\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\n\t\t\tev.$count = stack.max_count;\n\t\t\tlet temp_width = Math.floor(this.List.$width / ev.$count);\n\t\t\tev.$left = ev.$sorder * temp_width;\n\t\t\tif (!ev.$inner) temp_width = temp_width * (ev.$count - ev.$sorder);\n\t\t\tev.$width = temp_width - 8;\n\n\t\t\tconst evCorrectedCopy = shrinkTo(\n\t\t\t\tthis.Day,\n\t\t\t\twebix.Date.add(this.Day, 1, \"day\", true)\n\t\t\t)(ev);\n\t\t\tconst sm =\n\t\t\t\tevCorrectedCopy.start_date.getHours() * 60 +\n\t\t\t\tevCorrectedCopy.start_date.getMinutes();\n\t\t\tconst em =\n\t\t\t\tevCorrectedCopy.end_date.getHours() * 60 +\n\t\t\t\t\tevCorrectedCopy.end_date.getMinutes() || 24 * 60;\n\n\t\t\tev.$top = Math.round((sm * this.List.type.height) / 60) - delta;\n\t\t\tev.$height = Math.max(\n\t\t\t\tthis.minEventHeight,\n\t\t\t\t((em - sm) * this.List.type.height) / 60\n\t\t\t);\n\t\t}\n\t}\n\n\tToHTML(obj) {\n\t\tconst content = this.EventTemplate(obj);\n\t\treturn this.EventTemplateStart(obj) + content + \"</div>\";\n\t}\n\n\tGetEventEndDate(ev) {\n\t\tlet end_date = ev.end_date;\n\t\tconst duration =\n\t\t\t(((ev.end_date - ev.start_date) / 60000) * this.List.type.height) / 60;\n\n\t\tif (duration < this.minEventHeight) {\n\t\t\tend_date = webix.Date.add(\n\t\t\t\tev.start_date,\n\t\t\t\tMath.ceil((this.minEventHeight / this.List.type.height) * 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn end_date;\n\t}\n\n\tEventTemplateStart(obj) {\n\t\tconst css = `class=\"webix_scheduler_day_event ${\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \"webix_scheduler_event_selected\"\n\t\t\t\t: \"\"\n\t\t}\"`;\n\n\t\treturn `<div webix_e_id='${obj.id}' ${css} style='left:${\n\t\t\tobj.$left\n\t\t}px; top:${obj.$top}px; width:${obj.$width}px; height:${\n\t\t\tobj.$height\n\t\t}px; ${dayEventColor(obj)}'>`;\n\t}\n\n\tEventTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst resizer = this.State.readonly\n\t\t\t? \"\"\n\t\t\t: \"<div class='webix_icon webix_scheduler_resizer' webix_resizer='true'></div>\";\n\n\t\treturn `<div class=\"webix_scheduler_inner_day\"><span class=\"webix_scheduler_event_name\">${obj.text ||\n\t\t\t_(\n\t\t\t\t\"(No title)\"\n\t\t\t)}</span><div class=\"webix_scheduler_event_time\">${webix.i18n.timeFormatStr(\n\t\t\tobj.start_date\n\t\t)} - ${webix.i18n.timeFormatStr(obj.end_date)}</div></div>${resizer}`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.GetEvent(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(h) {\n\t\tif (!this.State.readonly) {\n\t\t\tconst date = webix.Date.copy(this.Day || this.State.date);\n\t\t\tdate.setHours(h);\n\t\t\tthis.State.selected = { id: \"0\", date };\n\t\t}\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultidayEventList extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 32,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis.MoreIcon = this.$$(\"more\");\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tthis.LimitData(data.multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(data.multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 4;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tif (obj.id == \"$wsh_multi_more\") return css;\n\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis.SetMoreIcon(this._expandState);\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\t\t} else {\n\t\t\tthis.SetMoreIcon();\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t});\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"up\";\n\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\tthis.List.parse(this._reserve);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tthis._expandState = mode;\n\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.ExpandData();\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MultidayEventList from \"./multiday\";\nimport DayEventsView from \"./events\";\nimport HourscaleView from \"../common/hourscale\";\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class DayView extends JetView {\n\tconfig() {\n\t\tconst header = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"header\",\n\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\theight: 32,\n\t\t\ttemplate: obj => {\n\t\t\t\treturn obj.date ? webix.Date.dateToStr(\"%l\")(obj.date) : \"\";\n\t\t\t},\n\t\t};\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler_day\",\n\t\t\trows: [\n\t\t\t\theader,\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"multi\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcols: [MultidayEventList],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"scroll\",\n\t\t\t\t\tview: \"scrollview\",\n\t\t\t\t\tcss: \"webix_scheduler_day_scroll\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tcols: [HourscaleView, DayEventsView],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t}\n\n\tRefreshData(value) {\n\t\tthis.$$(\"header\").setValues({ date: value });\n\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class CalendarView extends JetView {\n\tconfig() {\n\t\tthis.Events = {};\n\n\t\treturn {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\tevents: (day, isOutside) => this.MarkEvent(day, isOutside),\n\t\t\ticons: false,\n\t\t\tnavigation: false,\n\t\t\tmonthHeader: false,\n\t\t\tskipEmptyWeeks: true,\n\t\t\twidth: 0,\n\t\t\theight: 410,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Calendar = this.getRoot();\n\t\tthis.Calendar.attachEvent(\"onAfterDateSelect\", date => {\n\t\t\tthis.app.getState().date = webix.Date.dayStart(date);\n\t\t});\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tlet { start, weeks, data } = this.data;\n\t\tconst end = webix.Date.add(start, weeks, \"week\", true);\n\n\t\tthis.Events = {};\n\n\t\twhile (start < end) {\n\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\tif (\n\t\t\t\t\t(data[i].all_day\n\t\t\t\t\t\t? data[i].end_date >= start\n\t\t\t\t\t\t: data[i].end_date > start) &&\n\t\t\t\t\tdata[i].start_date < next\n\t\t\t\t)\n\t\t\t\t\tthis.Events[start.valueOf()] = true;\n\t\t\tstart = next;\n\t\t}\n\n\t\tthis.Calendar.setValue(this.app.getState().date);\n\t}\n\n\t// adds dots to days with events\n\tMarkEvent(day, isOutside) {\n\t\tlet css = \"\";\n\n\t\tif (!isOutside) css += webix.Date.isHoliday(day) || \"\";\n\t\tif (this.Events[day.valueOf()]) css += \" webix_cal_day_with_event\";\n\n\t\treturn css;\n\t}\n}\n","/* eslint-disable indent */\n\nimport { JetView } from \"webix-jet\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { marker, dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreWindowView extends JetView {\n\tconstructor(app, c) {\n\t\tsuper(app);\n\t\tthis.Events = c.events;\n\t}\n\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\twidth: 266,\n\t\t\tpadding: 8,\n\t\t\tminHeight: 70,\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\tview: \"list\",\n\t\t\t\tcss: \"webix_scheduler_more_list\",\n\t\t\t\tborderless: true,\n\t\t\t\tautoheight: true,\n\t\t\t\tyCount: 3,\n\t\t\t\ttooltip: {\n\t\t\t\t\ttemplate: \"\",\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_scheduler_month_event: (e, id) => this.ShowEvent(id),\n\t\t\t\t\twebix_scheduler_month_event_single: (e, id) => this.ShowEvent(id),\n\t\t\t\t},\n\t\t\t\ttype: {\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: (o, c) => this.MoreTemplate(o, c, _),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\tinitDnD.call(this, view.getBody(), \"more\", true);\n\t}\n\n\tMoreTemplate(obj, _c, _) {\n\t\tconst i18n = webix.i18n;\n\t\tconst single = !daysBetweenInclusive(obj.start_date, obj.end_date);\n\t\tconst style = single ? \"\" : dayEventColor(obj);\n\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"webix_scheduler_month_event${single ? \"_single\" : \"\"}\"\n\t\t\t\tstyle=\"${style}\"\n\t\t\t>\n\t\t\t\t${single ? marker(obj) : \"\"}\n\t\t\t\t<div webix_tooltip=\"${obj.text}\" class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>\n\t\t\t\t<div class=\"webix_event_time\">\n\t\t\t\t\t${this.DayFormatStr(obj.start_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.start_date)} -\n\t\t\t\t\t${single ? \"\" : \" \" + this.DayFormatStr(obj.end_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.end_date)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tDayFormatStr(date) {\n\t\treturn webix.Date.dateToStr(\"%F %j\")(date);\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.Events.getItem(id);\n\t\tthis.app.getState().selected = getParams(obj);\n\t\tthis.HideWindow();\n\t}\n\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node);\n\t}\n\n\tHideWindow() {\n\t\tthis.Win.hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MoreWindowView from \"./more\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { marker, dayEventColor, templateStart } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive, isToday } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthEventsView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar\",\n\t\t\tprerender: true,\n\t\t\txCount: 7,\n\t\t\tyCount: 5,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tscroll: false,\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_cal_date: (_ev, id) => this.ShowDay(id),\n\t\t\t\twebix_scheduler_month_event: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_month_event_single: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_more: (_ev, id) => this.ShowMore(id),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_cal_day: (_e, id) => this.ShowNew(id),\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplate: (o, c) => this.CalendarTemplate(o, c),\n\t\t\t\ttemplateStart,\n\t\t\t\theaderHeight: 32,\n\t\t\t\teventHeight: 28,\n\t\t\t\tpadding: 8,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.State = this.app.getState();\n\t\tthis.Calendar = view;\n\t\tview.type.master = this.Calendar;\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tview.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.Calendar, \"month\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\", true); // IE hack\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tCalendarTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet html = `<span class=\"webix_cal_date\">${obj.date.getDate()}</span>`;\n\t\tif (obj.$more && obj.$more.length) {\n\t\t\thtml += `<div class=\"webix_scheduler_more\">${obj.$more.length} ${_(\n\t\t\t\t\"more\"\n\t\t\t)}</div>`;\n\t\t}\n\t\treturn html;\n\t}\n\n\tGetDayCss(day, month) {\n\t\tlet css = \"webix_cal_day\";\n\t\tif (isToday(day)) css += \" webix_cal_today\";\n\t\tif (day.getMonth() != month) css += \" webix_cal_outside\";\n\t\telse css += \" \" + (webix.Date.isHoliday(day) || \"\");\n\t\treturn css;\n\t}\n\n\tGetMonthData() {\n\t\tconst data = [];\n\t\tconst { start, weeks } = this.data;\n\t\tconst month = webix.Date.add(start, 1, \"week\", true).getMonth();\n\n\t\tlet day = webix.Date.copy(start);\n\t\tfor (let i = 0; i < weeks * 7; i++) {\n\t\t\tconst obj = {\n\t\t\t\tdate: webix.Date.copy(day),\n\t\t\t\t$css: this.GetDayCss(day, month),\n\t\t\t};\n\n\t\t\tif ((i + 1) % 7 === 0) obj.right = true;\n\t\t\tif (i >= (weeks - 1) * 7) obj.bottom = true;\n\n\t\t\tdata.push(obj);\n\t\t\twebix.Date.add(day, 1, \"day\");\n\t\t}\n\t\treturn data;\n\t}\n\n\tRenderEvents() {\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Calendar.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t\tclass: \"webix_scheduler_month_events\",\n\t\t});\n\n\t\tconst { start } = this.data;\n\t\tconst type = this.Calendar.type;\n\t\tconst maxLines = Math.floor(\n\t\t\t(type.height - type.headerHeight + type.padding - 2) /\n\t\t\t\t(type.eventHeight + type.padding)\n\t\t);\n\n\t\tlet wStart = webix.Date.copy(start);\n\t\tlet wEnd = webix.Date.add(wStart, 1, \"week\", true);\n\n\t\tlet html = \"\";\n\t\tlet cache = {};\n\t\tconst me = this.Calendar.getItem(this.Calendar.getLastId()).date;\n\t\tconst ms = this.Calendar.getItem(this.Calendar.getFirstId()).date;\n\t\tthis.Calendar.data.each(function(day, dayIndex) {\n\t\t\t// next week\n\t\t\tif (day.date >= wEnd) {\n\t\t\t\tcache = {};\n\t\t\t\twStart = wEnd;\n\t\t\t\twEnd = webix.Date.add(wStart, 1, \"week\", true);\n\t\t\t}\n\n\t\t\tconst more = [];\n\t\t\tconst dayHTML = [];\n\t\t\tthis.Events.data.each(function(ev) {\n\t\t\t\tconst id = ev.id;\n\n\t\t\t\t// will not be this week\n\t\t\t\tif (\n\t\t\t\t\tev.start_date >= wEnd ||\n\t\t\t\t\tev.end_date < wStart ||\n\t\t\t\t\t(!ev.all_day && webix.Date.equal(ev.end_date, wStart))\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\t// if already processed - check and skip\n\t\t\t\tif (!webix.isUndefined(cache[id])) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(day.date <= ev.end_date && ev.all_day) ||\n\t\t\t\t\t\tday.date < ev.end_date\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (cache[id] >= maxLines) {\n\t\t\t\t\t\t\tmore.push(id);\n\t\t\t\t\t\t} else dayHTML[cache[id]] = \"\";\n\t\t\t\t\t} else delete cache[id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// today\n\t\t\t\tif (\n\t\t\t\t\tev.start_date < webix.Date.add(day.date, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= day.date\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(dayHTML[index])) index++;\n\n\t\t\t\t\tcache[id] = index;\n\t\t\t\t\tif (index >= maxLines) return more.push(id);\n\n\t\t\t\t\tconst config = { ms, me };\n\t\t\t\t\tconfig.single = !daysBetweenInclusive(\n\t\t\t\t\t\tev.start_date,\n\t\t\t\t\t\tev.all_day\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, 1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date\n\t\t\t\t\t);\n\n\t\t\t\t\tconfig.length = 1;\n\t\t\t\t\tif (!config.single) {\n\t\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\t\tconfig.length += daysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(wStart, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(wEnd - 1, config.ee)))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.index = dayIndex;\n\t\t\t\t\tdayHTML[index] = this.ToHTML(ev, index, config);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tconst prevLength = day.$more && day.$more.length;\n\t\t\tday.$more = more;\n\t\t\tif (prevLength != more.length) this.Calendar.render(day.id, day, \"paint\");\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t}, this);\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Calendar.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, index, c) {\n\t\tconst type = this.Calendar.type;\n\t\tconst style = c.single ? \"\" : dayEventColor(obj);\n\t\tconst width = c.length * type.width - type.padding;\n\t\tconst height = type.eventHeight;\n\t\tconst pos = this.GetPosition(type, index, c.index);\n\n\t\tlet extra = \"\";\n\t\tif (c.single) {\n\t\t\textra =\n\t\t\t\tmarker(obj) +\n\t\t\t\t`<span class=\"webix_event_time\">${webix.i18n.timeFormatStr(\n\t\t\t\t\tobj.start_date\n\t\t\t\t)}</span>`;\n\t\t}\n\t\tconst css = this.GetStyle(obj, c);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"height:${height}px;line-height:${height}px; width:${width}px; ${pos +\n\t\t\tstyle}\">\n\t\t\t\t\t${extra + (obj.text || _(\"(No title)\"))}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tlet css = `webix_scheduler_month_event${c.single ? \"_single\" : \"\"}`;\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (!c.single) {\n\t\t\tif (c.es < c.ms && webix.Date.equal(c.ms, webix.Date.dayStart(c.ls)))\n\t\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\t\telse if (\n\t\t\t\tc.ee >= webix.Date.add(c.me, 1, \"day\", true) &&\n\t\t\t\twebix.Date.equal(c.me, webix.Date.dayStart(c.le))\n\t\t\t)\n\t\t\t\tcss += \" webix_scheduler_event_break_right\";\n\t\t}\n\t\treturn css;\n\t}\n\n\tGetPosition(type, index, dayIndex) {\n\t\tconst row = Math.floor(dayIndex / this.Calendar.config.xCount);\n\t\tconst col = dayIndex % this.Calendar.config.xCount;\n\n\t\treturn `\n\t\t\ttop:${row * type.height +\n\t\t\t\ttype.headerHeight +\n\t\t\t\tindex * (type.eventHeight + type.padding)}px;\n\t\t\tleft:${col * type.width}px;\n\t\t`;\n\t}\n\n\tRefreshData() {\n\t\tconst { data, weeks } = this.data;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(data);\n\t\tthis.Events.sort(function(a, b) {\n\t\t\tconst start_a = webix.Date.dayStart(a.start_date);\n\t\t\tconst start_b = webix.Date.dayStart(b.start_date);\n\n\t\t\tif (webix.Date.equal(start_a, start_b)) {\n\t\t\t\tconst days_a = daysBetweenInclusive(a.start_date, a.end_date);\n\t\t\t\tconst days_b = daysBetweenInclusive(b.start_date, b.end_date);\n\t\t\t\treturn days_b - days_a || a.start_date - b.start_date;\n\t\t\t}\n\t\t\treturn start_a - start_b;\n\t\t});\n\n\t\tconst monthData = this.GetMonthData();\n\n\t\tthis.Calendar.clearAll();\n\t\tif (this.Calendar.config.yCount != weeks) {\n\t\t\tthis.Calendar.define(\"yCount\", weeks);\n\t\t\tthis.Calendar.resize();\n\t\t}\n\t\tthis.Calendar.parse(monthData);\n\t}\n\n\tShowMore(id) {\n\t\tthis.MoreWindow.ShowWindow(\n\t\t\tid,\n\t\t\tthis.Calendar.getItemNode(id),\n\t\t\tthis.Calendar.getItem(id).$more || []\n\t\t);\n\t\treturn false;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Calendar.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(id) {\n\t\tif (!this.State.readonly) {\n\t\t\tconst date = this.Calendar.getItem(id).date;\n\t\t\tthis.State.selected = { id: \"0\", date };\n\t\t}\n\t}\n\n\tShowDay(id) {\n\t\tconst state = this.app.getState();\n\n\t\tstate.$batch({\n\t\t\tdate: this.Calendar.getItem(id).date,\n\t\t\tmode: \"day\",\n\t\t});\n\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { templateStart } from \"helpers/templates\";\n\nexport default class MonthHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar_header\",\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\theight: 32,\n\t\t\tscroll: false,\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplateStart,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tview.type.master = view;\n\t\tview.parse(this.GetHeaderData());\n\t}\n\n\tGetHeaderData() {\n\t\tconst data = [];\n\t\tconst k = webix.Date.startOnMonday ? 1 : 0;\n\n\t\tfor (let i = 0; i < 7; i++)\n\t\t\tdata.push({ value: webix.i18n.calendar.dayShort[(k + i) % 7] });\n\n\t\tdata[data.length - 1][\"right\"] = true;\n\t\treturn data;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { shrinkTo, isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst config = {\n\t\t\tview: \"list\",\n\t\t\ttype: {\n\t\t\t\theight: 50,\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttimeStart: ev => this.TimeStart(ev),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.ShowEvent(id),\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\tinit() {\n\t\tthis.List = this.getRoot();\n\t\tthis.State = this.app.getState();\n\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tconst start = webix.Date.datePart(this.State.date, true);\n\t\tconst end = webix.Date.add(start, 1, \"day\", true);\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(evs.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t});\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.List.getItem(id);\n\t\tthis.State.selected = getParams(obj);\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MonthListView from \"./list\";\nimport CalendarView from \"./compact\";\nimport MonthEventsView from \"./events\";\nimport MonthHeaderView from \"./header\";\n\nexport default class MonthView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst views = compact\n\t\t\t? [CalendarView, MonthListView]\n\t\t\t: [MonthHeaderView, MonthEventsView];\n\n\t\treturn {\n\t\t\trows: views,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\tRefreshData(value) {\n\t\tlet start = webix.Date.monthStart(value);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tstart = webix.Date.weekStart(\n\t\t\tnew Date(start.getFullYear(), start.getMonth(), 1)\n\t\t);\n\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\tend = webix.Date.add(end, weeks, \"week\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tif (this.app) this.setParam(\"data\", { start, weeks, data }, true);\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class BarView extends JetView {\n\tconfig() {\n\t\tconst active = webix.skin.$active;\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\", true);\n\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\theight: active.barHeight,\n\t\t\telements: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tlabel: _(\"Timeline scale\"),\n\t\t\t\t\tlabelWidth: 120,\n\t\t\t\t\twidth: 260,\n\t\t\t\t\tvalue: state.timelineMode,\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => {\n\t\t\t\t\t\t\tstate.timelineMode = v;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import MoreWindowView from \"../month/more\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreView extends MoreWindowView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.width = 360;\n\t\tui.relative = \"bottom\";\n\n\t\treturn ui;\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\t// set dnd mode to timeline to allow dnd between more popup and timeline chart\n\t\tinitDnD.call(this, view.getBody(), \"timelineMore\", true);\n\t}\n\n\t/**\n\t * Show the popup with extra events\n\t * @param {(string|number)} id - the ID of a section\n\t * @param {HTMLElement} node - the HTML element of the section from left part of the timeline chart\n\t * @param {Array<Object>} data - an array of events\n\t * @returns\n\t */\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node, { x: node.clientWidth }); // here we position the popup to the left of the node as well as bottom\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport {\n\tsmallerCount,\n\tgetUnitStart,\n\tgrid,\n\tupdateTask,\n\taddUnit,\n} from \"@xbs/webix-gantt-lib\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, switchCursor, locateEvent } from \"helpers/dnd\";\nimport { getParams } from \"helpers/recurring\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport MoreWindowView from \"./more\";\n\nexport default class ChartView extends JetView {\n\tconfig() {\n\t\tconst active = webix.skin.$active;\n\t\tthis._sectionSize = 5;\n\t\tconst height =\n\t\t\t(active.barHeight - active.borderWidth * 2) * this._sectionSize;\n\n\t\treturn {\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"treetable\",\n\t\t\t\t\tlocalId: \"sections\",\n\t\t\t\t\tcss: \"webix_scheduler_timeline_sections\",\n\t\t\t\t\twidth: 200,\n\t\t\t\t\theader: false,\n\t\t\t\t\tscroll: \"y\",\n\t\t\t\t\trowHeight: height,\n\t\t\t\t\tscrollAlignY: false,\n\t\t\t\t\tcolumns: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"text\",\n\t\t\t\t\t\t\theader: \"\",\n\t\t\t\t\t\t\tfillspace: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"list\",\n\t\t\t\t\tlocalId: \"list\",\n\t\t\t\t\ttype: { height, template: \"\" },\n\t\t\t\t\tcss: `webix_scheduler_timeline${\n\t\t\t\t\t\twebix.env.touch ? \"_touch\" : \"\"\n\t\t\t\t\t}_bars`,\n\t\t\t\t\tonClick: {\n\t\t\t\t\t\twebix_scheduler_timeline_event: e => this.ShowEvent(e),\n\t\t\t\t\t},\n\t\t\t\t\tonDblClick: {\n\t\t\t\t\t\twebix_list_item: (e, id) => this.ShowNew(e, id),\n\t\t\t\t\t},\n\t\t\t\t\ttooltip: {\n\t\t\t\t\t\ttemplate: \"\",\n\t\t\t\t\t},\n\t\t\t\t\tscroll: \"xy\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Tree = this.$$(\"sections\");\n\t\tthis.Bars = this.$$(\"list\");\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.InnerState = this.getParam(\"innerState\", true);\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Events = new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: obj => this.RefreshTask(obj.id),\n\t\t\t},\n\t\t});\n\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis._sectionsReady = this.Data.sections().then(data => {\n\t\t\tthis.Sections = data;\n\t\t\tthis.Tree.parse(data);\n\t\t\tthis.Bars.parse(data);\n\t\t});\n\n\t\tthis.HandleScroll();\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t\t// calendars\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", (_v, o) => o && this.RefreshData());\n\n\t\tinitDnD.call(this, this.Bars, \"timeline\");\n\t\tif (!webix.env.touch)\n\t\t\tthis._mousemove_handler = webix.event(this.Bars.$view, \"mousemove\", e =>\n\t\t\t\tswitchCursor(e, this.Bars.$view)\n\t\t\t);\n\t}\n\n\turlChange() {\n\t\tconst scales = (this.Scales = this.getParam(\"scales\", true));\n\t\tthis.DrawGrid(scales);\n\t\tthis.RefreshData(scales);\n\t}\n\n\t/**\n\t * Reloads data into timeline\n\t * @param {Object} scales - current chart scales\n\t */\n\tRefreshData(scales) {\n\t\tif (!scales) scales = this.Scales;\n\t\twebix.promise\n\t\t\t.all([this._sectionsReady, this.Data.getEvents(scales.start, scales.end)])\n\t\t\t.then(res => {\n\t\t\t\tthis.Events.clearAll();\n\n\t\t\t\tthis._processed = [];\n\t\t\t\tthis._lastRow = {};\n\t\t\t\tthis._section = null;\n\t\t\t\tthis._moreEvents = {};\n\n\t\t\t\tthis.Events.parse(res[1]);\n\t\t\t\tthis.RenderEvents();\n\t\t\t});\n\t}\n\n\t/**\n\t * Updates task object with new coordinates and allocates it to the correct position inside a section\n\t * @param {(string|number)} updID - the ID of an event\n\t */\n\tRefreshTask(updID) {\n\t\tconst t = this.Events.getItem(updID);\n\n\t\tconst sectionIndex = indexOf(this.Sections.data.order, t.section);\n\t\tif (sectionIndex == -1) {\n\t\t\tt.$hide = true;\n\t\t\treturn;\n\t\t}\n\n\t\tconst type = this.State.timelineMode;\n\t\tconst unit = smallerCount[type][0];\n\n\t\tconst prev = this._processed.find(obj => {\n\t\t\tif (obj.section == t.section) {\n\t\t\t\tif (type === \"day\")\n\t\t\t\t\treturn this.CheckDates(obj.end_date, t.start_date, obj.all_day);\n\n\t\t\t\tconst prev = webix.Date.timePart(obj.end_date)\n\t\t\t\t\t? getUnitStart(unit, webix.Date.add(obj.end_date, 1, unit, true))\n\t\t\t\t\t: obj.end_date;\n\t\t\t\tconst next = getUnitStart(unit, t.start_date);\n\t\t\t\treturn this.CheckDates(prev, next, obj.all_day);\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tlet y;\n\t\tif (prev) {\n\t\t\ty = prev.$y;\n\t\t\tthis._processed.splice(\n\t\t\t\tthis._processed.findIndex(p => prev.id == p.id),\n\t\t\t\t1\n\t\t\t);\n\t\t} else {\n\t\t\tif (webix.isUndefined(this._lastRow[t.section]))\n\t\t\t\tthis._lastRow[t.section] = 0;\n\t\t\telse this._lastRow[t.section]++;\n\n\t\t\tif (this._lastRow[t.section] >= this._sectionSize - 1) t.$more = true;\n\t\t\telse t.$more = false;\n\t\t}\n\n\t\tupdateTask(\n\t\t\tt,\n\t\t\tthis._lastRow[t.section] + sectionIndex * this._sectionSize,\n\t\t\tthis.Scales,\n\t\t\tthis.Scales.cellHeight - 12,\n\t\t\ty\n\t\t);\n\n\t\tthis._processed.push(t);\n\t\tthis._processed.sort((a, b) => a.$y - b.$y);\n\t\tthis._section = t.section;\n\t}\n\n\t/**\n\t * Checks if the start of one event follows the end of the previous one\n\t * @param {Date} prev - the end date of the previous event\n\t * @param {Date} next - the start date of the next event\n\t * @param {Boolean} all_day - the flag that indicates that the previous event is all-day (which means that the end date is really 1 day later)\n\t * @returns {Boolean} true if the start follows the end, false otherwise\n\t */\n\tCheckDates(prev, next, all_day) {\n\t\treturn (all_day ? webix.Date.add(prev, 1, \"day\", true) : prev) <= next;\n\t}\n\n\t/**\n\t * Creates a layer with events\n\t */\n\tRenderEvents() {\n\t\tif (this._DataObj) {\n\t\t\tthis.Bars.$view.firstChild.removeChild(this._DataObj);\n\t\t\tdelete this._DataObj;\n\t\t}\n\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Bars.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\t\tlet html = \"\";\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Events.data.each(obj => {\n\t\t\tif (!obj.$hide) {\n\t\t\t\tif (!obj.$more || this._lastRow[obj.section] == 4) {\n\t\t\t\t\thtml += this.BarsTemplate(obj, _);\n\t\t\t\t} else {\n\t\t\t\t\tif (!this._moreEvents[obj.section]) {\n\t\t\t\t\t\tthis._moreEvents[obj.section] = [];\n\n\t\t\t\t\t\thtml += this.MoreBarTemplate(obj, _);\n\t\t\t\t\t}\n\t\t\t\t\tthis._moreEvents[obj.section].push(obj.id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Bars.$view.firstChild.appendChild(container);\n\t}\n\n\t/**\n\t * Paints a grid\n\t * @param {scales} Object - scales object as returned by this.Local.getScales()\n\t */\n\tDrawGrid(scales) {\n\t\tconst view = this.Bars;\n\n\t\tview.$view.style.backgroundImage = `url(${grid(\n\t\t\tscales.cellWidth,\n\t\t\tscales.cellHeight,\n\t\t\twebix.skin.$name == \"contrast\" ? \"#808080\" : \"#ddd\"\n\t\t)})`;\n\t\tview.$view.style.marginTop = \"0px\";\n\n\t\t// sync grid to scroll position\n\t\tview.$view.style.backgroundPosition = `-${this.InnerState.left}px -${this.InnerState.top}px`;\n\n\t\tthis.Resize(scales.width);\n\t}\n\n\t/**\n\t * Changes the width of the root component (list with bars)\n\t * @param {number} width\n\t */\n\tResize(width) {\n\t\tconst area = this.Bars.$view.querySelector(\".webix_scroll_cont\");\n\t\tarea.style.width = width + \"px\";\n\t\tarea.style.minHeight = \"1px\";\n\t}\n\n\t/**\n\t * Handles scrolling\n\t */\n\tHandleScroll() {\n\t\tthis.InnerState = this.getParam(\"innerState\", true);\n\n\t\tthis._scroll_handler = webix.event(this.Bars.$view, \"scroll\", ev => {\n\t\t\tconst bars = ev.target;\n\t\t\tconst top = Math.round(bars.scrollTop);\n\t\t\tconst left = Math.round(bars.scrollLeft);\n\t\t\tthis.Bars.$view.style.backgroundPosition = `-${left}px -${top}px`;\n\t\t\tthis.InnerState.$batch({ top, left });\n\t\t\tthis.Tree.scrollTo(0, top);\n\n\t\t\tthis.MoreWindow.HideWindow();\n\t\t});\n\n\t\tthis.on(this.Tree, \"onScrollY\", function() {\n\t\t\tconst y = this.getScrollState().y;\n\t\t\tthis.$scope.Bars.scrollTo(this.$scope.InnerState.left, y);\n\t\t});\n\t}\n\n\t/**\n\t * Returns a string with HTML of a task node content\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string} a string with HTML of an event bar\n\t */\n\tBarsTemplate(obj, _) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst scales = this.Scales;\n\n\t\tlet w = obj.$w - 2;\n\t\t// all day events last 1 day longer than their end_date\n\t\tif (obj.all_day && obj.end_date < scales.end) {\n\t\t\tw +=\n\t\t\t\tscales.precise && scales.minUnit === \"week\"\n\t\t\t\t\t? Math.floor(scales.cellWidth / smallerCount[scales.minUnit][1])\n\t\t\t\t\t: scales.cellWidth;\n\t\t}\n\n\t\tconst content = `<div class=\"webix_scheduler_timeline_content\">${obj.text ||\n\t\t\t_(\"(no title)\")}</div>`;\n\n\t\tlet css = \"webix_scheduler_timeline_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < this.Scales.start)\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\telse if (obj.end_date > this.Scales.end)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn `<div webix_e_id=\"${obj.id}\" \n\t\t\twebix_tooltip=\"${obj.text}\" class=\"${css}\" \n\t\t\tstyle=\"left:${obj.$x}px;top:${obj.$y}px;width:${w}px;height:${obj.$h}px;${style}\">\n\t\t\t${content}\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Defines the looks and contents of the bar that allows to see events that did not fit into a 5-line section\n\t * @param {Object} obj - the event data\n\t * @param {function} _ - the translator function of the Locale plugin\n\t * @returns {string} with the HTML of the bar\n\t */\n\tMoreBarTemplate(obj, _) {\n\t\tconst text = _(\"Show more\");\n\t\tconst content = `<div class=\"webix_scheduler_timeline_content\" webix_tooltip=\"${text}\">${text}</div>`;\n\t\tconst css = \"webix_scheduler_timeline_event webix_scheduler_multi_more\";\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" webix_r_id=\"${obj.section}\" class=\"${css}\" style=\"left:0px;top:${obj.$y}px;width:100%;height:${obj.$h}px;\">\n\t\t\t${content}\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Either shows the selected event in Info or opens the list of extra events in a popup\n\t * @param {MouseEvent} e - a native browser event\n\t * @returns {Boolean} always false to prevent bubbling\n\t */\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Bars.$view);\n\t\tif (event.id === \"$wsh_multi_more\") {\n\t\t\tconst id = event.node.getAttribute(\"webix_r_id\");\n\t\t\tthis.MoreWindow.ShowWindow(\n\t\t\t\tid,\n\t\t\t\tthis.Tree.getItemNode(id),\n\t\t\t\tthis._moreEvents[id] || []\n\t\t\t);\n\t\t} else if (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Initiates creating a new event\n\t * @param {MouseEvent} e - a native browser event\n\t * @param {(string|number)} id - the ID of a section\n\t */\n\tShowNew(e, id) {\n\t\tif (!this.State.readonly) {\n\t\t\tconst scales = this.Scales;\n\t\t\tconst n = Math.floor(\n\t\t\t\te.offsetX /\n\t\t\t\t\t(scales.precise && scales.minUnit == \"week\"\n\t\t\t\t\t\t? Math.floor(scales.cellWidth / smallerCount[scales.minUnit][1])\n\t\t\t\t\t\t: scales.cellWidth)\n\t\t\t);\n\t\t\tconst start = scales.start;\n\t\t\tconst unit = scales.precise\n\t\t\t\t? smallerCount[scales.minUnit][0]\n\t\t\t\t: scales.minUnit;\n\t\t\tconst date = addUnit(unit)(start, n);\n\t\t\tthis.State.selected = { id: \"0\", date, section: id };\n\t\t}\n\t}\n}\n\n/**\n * Case-insensitive indexOf\n * @param {Array<any>} arr - the array to be checked\n * @param {any} el - something that you need to find in the array\n * @returns {number} the index of the first found element or -1\n */\nfunction indexOf(arr, el) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == el) return i;\n\t}\n\treturn -1;\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ScalesView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\twidth: 200,\n\t\t\t\t\tcss: \"webix_scheduler_timeline_space\",\n\t\t\t\t\tborderless: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tlocalId: \"scale\",\n\t\t\t\t\theight: 20,\n\t\t\t\t\tcss: \"webix_scheduler_timeline_scale\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst scale = this.$$(\"scale\");\n\t\tconst innerState = (this.InnerState = this.getParam(\"innerState\", true));\n\t\tthis.on(innerState.$changes, \"left\", x => scale.scrollTo(x, null));\n\t}\n\n\turlChange() {\n\t\tthis.RenderScales();\n\t}\n\n\t/**\n\t * Renders gantt scales\n\t */\n\tRenderScales() {\n\t\tconst scales = this.getParam(\"scales\", true);\n\t\tconst view = this.$$(\"scale\");\n\t\tconst html = scales.rows\n\t\t\t.map(line => {\n\t\t\t\treturn (\n\t\t\t\t\t`<div class=\"webix_scheduler_timeline_scale_row\" style='height:${line.height}px;width:${scales.width}px'>` +\n\t\t\t\t\tline.cells.map(cell => this.CellTemplate(cell)).join(\"\") +\n\t\t\t\t\t\"</div>\"\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tview.config.height = scales.height;\n\t\tview.setHTML(html);\n\t\tview.resize();\n\t}\n\n\t/**\n\t * Returns the template string for a scale unit\n\t * @param {Object} cell - a scale unit\n\t * @returns {string} - the template string of the scale cell\n\t */\n\tCellTemplate(cell) {\n\t\treturn `<div class=\"webix_scheduler_timeline_scale_cell ${\n\t\t\tcell.css\n\t\t}\" style=\"width:${cell.width}px;\">${cell.format(cell.date)}</div>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport BarView from \"./bar\";\nimport ScaleView from \"./scale\";\nimport ChartView from \"./chart\";\n\nimport { addUnit, resetScales, getUnitStart } from \"@xbs/webix-gantt-lib\";\n\nimport { createState } from \"jet-restate\";\n\nexport default class TimelineView extends JetView {\n\tconfig() {\n\t\tconst ui = {\n\t\t\trows: [BarView, ScaleView, ChartView],\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\n\t\tconst innerState = (this.InnerState = createState({\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t}));\n\t\tthis.setParam(\"innerState\", innerState, true);\n\n\t\tthis.on(state.$changes, \"date\", v => this.SetScales(v, state.timelineMode));\n\n\t\tthis.on(state.$changes, \"timelineMode\", (t, o) => {\n\t\t\tif (o) this.SetScales(state.date, t);\n\t\t});\n\t}\n\n\tSetScales(date, type) {\n\t\tconst start = getUnitStart(type, date);\n\t\tconst end = addUnit(type)(start, 1);\n\t\tconst active = webix.skin.$active;\n\n\t\tconst scales = resetScales(\n\t\t\tstart,\n\t\t\tend,\n\t\t\ttype === \"month\",\n\t\t\tthis.GetScalesCellWidth(type),\n\t\t\tactive.barHeight - active.borderWidth * 2,\n\t\t\tthis.GetScalesArray(type)\n\t\t);\n\t\tthis.setParam(\"scales\", scales, true);\n\t}\n\n\tGetScalesArray(type) {\n\t\tswitch (type) {\n\t\t\tcase \"day\":\n\t\t\t\treturn [{ unit: \"hour\", format: \"%H:00\" }];\n\t\t\tcase \"week\":\n\t\t\t\treturn [{ unit: \"day\", step: 1, format: \"%d\" }];\n\t\t\tcase \"month\":\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tunit: \"week\",\n\t\t\t\t\t\tformat: function(start) {\n\t\t\t\t\t\t\tconst parser = webix.Date.dateToStr(\"%d %M\");\n\t\t\t\t\t\t\tconst wstart = webix.Date.weekStart(start);\n\t\t\t\t\t\t\tconst wend = webix.Date.add(\n\t\t\t\t\t\t\t\twebix.Date.add(wstart, 1, \"week\", true),\n\t\t\t\t\t\t\t\t-1,\n\t\t\t\t\t\t\t\t\"day\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn parser(wstart) + \" - \" + parser(wend);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t}\n\t}\n\n\tGetScalesCellWidth(type) {\n\t\tswitch (type) {\n\t\t\tcase \"day\":\n\t\t\t\treturn 80;\n\t\t\tcase \"week\":\n\t\t\t\treturn 300;\n\t\t\tcase \"month\":\n\t\t\t\treturn 400;\n\t\t}\n\t}\n}\n","import DayEventsView from \"../day/events\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class UnitEventsView extends DayEventsView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\tif (config) {\n\t\t\tthis.Unit = config.unit;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"unitList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"unitList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"units\");\n\t}\n\n\tFilterToday(value, to) {\n\t\tconst dayEvents = super.FilterToday(value, to);\n\n\t\treturn dayEvents.filter(obj => {\n\t\t\tif (obj.units) {\n\t\t\t\tconst units = obj.units.split(\",\");\n\t\t\t\tconst unitID = this.Unit.id + \"\";\n\t\t\t\treturn units.indexOf(unitID) !== -1;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tShowNew(h) {\n\t\tif (!this.State.readonly) {\n\t\t\tconst date = webix.Date.copy(this.Day || this.State.date);\n\t\t\tconst unit = this.Unit.id;\n\t\t\tdate.setHours(h);\n\t\t\tthis.State.selected = { id: \"0\", date, unit };\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class UnitsHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 1,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => obj.value,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Header = this.$$(\"header\");\n\n\t\tthis.Units = this.app.getService(\"local\").units();\n\n\t\tthis.Units.then(unitsCache => {\n\t\t\tthis.Header.sync(unitsCache, () => {\n\t\t\t\tthis.Header.define({ xCount: unitsCache.count() });\n\t\t\t\tthis.Header.resize();\n\t\t\t});\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class UnitMultidayList extends JetView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\tif (config) {\n\t\t\tthis.Unit = config.unit;\n\t\t}\n\t}\n\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 32,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"multiDayList\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\n\t\tthis.on(this.app, \"units:multi:state\", state => {\n\t\t\tif (state !== this._expandState) {\n\t\t\t\tstate === \"down\" ? this.WrapData() : this.ExpandData();\n\t\t\t}\n\t\t});\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tconst copy = webix.copy(data.multi);\n\t\t\tconst multi = this.FilterByUnits(copy);\n\t\t\tthis.LimitData(multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 4;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tif (obj.id == \"$wsh_multi_more\") return css;\n\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tdelete this._reserve;\n\t\tdelete this._reserveIds;\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\n\t\t\tthis.app.callEvent(\"units:multi:state\", [this._expandState, false]);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tif (this._reserveIds) {\n\t\t\t\tthis._inAnimation = true;\n\t\t\t\tconst height =\n\t\t\t\t\tthis.List.$height -\n\t\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tconst expandable = this.List.exists(\"$wsh_multi_more\");\n\t\tif (!this._inAnimation) {\n\t\t\tthis._expandState = \"up\";\n\t\t\tif (expandable) {\n\t\t\t\tthis._inAnimation = true;\n\t\t\t\tthis.Animate(\"up\");\n\n\t\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\t\tthis.List.parse(this._reserve);\n\t\t\t}\n\t\t}\n\t}\n\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t}, 150);\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.app.callEvent(\"units:multi:state\", [\"up\", true]);\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tFilterByUnits(multiEvents) {\n\t\treturn multiEvents.filter(obj => {\n\t\t\tif (obj.units) {\n\t\t\t\tconst units = obj.units.split(\",\");\n\t\t\t\tconst unitID = this.Unit.id + \"\";\n\t\t\t\treturn units.indexOf(unitID) !== -1;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport UnitMultidayList from \"./multidaylist\";\nexport default class UnitMultidayView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tconst units = this.app.getService(\"local\").units();\n\n\t\tconst more = ui.cols[0];\n\t\tmore.onClick = {\n\t\t\t\"wxi-angle-down\": () =>\n\t\t\t\tthis.app.callEvent(\"units:multi:state\", [\"up\", true]),\n\t\t\t\"wxi-angle-up\": () =>\n\t\t\t\tthis.app.callEvent(\"units:multi:state\", [\"down\", true]),\n\t\t};\n\n\t\tui.cols[1] = { cols: [] };\n\n\t\treturn units.then(unitsCache => {\n\t\t\tconst data = unitsCache.serialize();\n\t\t\tfor (let i = 0; i < data.length; ++i) {\n\t\t\t\tui.cols[1].cols.push(\n\t\t\t\t\tnew (this.app.dynamic(UnitMultidayList))(this.app, {\n\t\t\t\t\t\tunit: data[i],\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ui;\n\t\t});\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis.on(this.State.$changes, \"date\", () => {\n\t\t\tthis.SetMoreIcon();\n\t\t});\n\n\t\tthis.on(this.app, \"units:multi:state\", (state, animate) => {\n\t\t\tconst delay = animate ? 150 : 1;\n\t\t\tthis.Animate(state, delay);\n\t\t});\n\t}\n\n\t// delay for animation of inner views (collapse/expand)\n\tAnimate(mode, delay) {\n\t\tsetTimeout(() => {\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, delay);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport HourscaleView from \"../common/hourscale\";\nimport UnitEventsView from \"./events\";\nimport UnitsHeaderView from \"./header\";\nimport UnitMultidayView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class UnitsView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst units = this.app.getService(\"local\").units();\n\n\t\tconst multi = {\n\t\t\tlocalId: \"multi\",\n\t\t\thidden: true,\n\t\t\tcols: [UnitMultidayView],\n\t\t};\n\n\t\tconst days = {\n\t\t\tlocalId: \"scroll\",\n\t\t\tview: \"scrollview\",\n\t\t\tscroll: \"y\",\n\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\tbody: {\n\t\t\t\tcols: [HourscaleView],\n\t\t\t},\n\t\t};\n\n\t\treturn units.then(unitsCache => {\n\t\t\tconst data = unitsCache.serialize();\n\t\t\tfor (let i = 0; i < data.length; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(UnitEventsView))(this.app, {\n\t\t\t\t\t\tunit: data[i],\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [UnitsHeaderView, multi, days],\n\t\t\t};\n\t\t});\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\n\tRefreshData(value) {\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekEventsView extends UnitListView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_week\";\n\t\tui.type.headerHeight = 28;\n\n\t\treturn ui;\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(this.data.all);\n\t\t\tthis.ToggleOverlay();\n\t\t}\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%l, %F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span>`;\n\n\t\treturn `<span class=\"webix_unit_header_inner\">${webix.Date.dateToStr(\n\t\t\tfstring\n\t\t)(date)}</span>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 7,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn `<span class=\"webix_scheduler_weekday\">${obj.day}</span> <span class=\"webix_scheduler_monthday\">${obj.date}</span>`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.RefreshData();\n\t\t}\n\t}\n\n\tRefreshData() {\n\t\tlet start = this.data.start;\n\t\tconst data = [];\n\t\twhile (start < this.data.end) {\n\t\t\tconst obj = {\n\t\t\t\tday: webix.i18n.calendar.dayShort[start.getDay()],\n\t\t\t\tdate: start.getDate(),\n\t\t\t};\n\t\t\tif (isToday(start)) {\n\t\t\t\tobj.$css = \"webix_scheduler_list_today\";\n\t\t\t}\n\t\t\tdata.push(obj);\n\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t}\n\n\t\tconst header = this.$$(\"header\");\n\t\theader.clearAll();\n\t\theader.parse(data);\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultiDayEventsView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"dataview\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tcss: \"webix_scheduler_multidays\",\n\t\t\tscroll: false,\n\t\t\theight: 32,\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\ttype: {\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\titemHeight: 32,\n\t\t\t},\n\t\t\ttemplate: \"\",\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tSelectionMixin(this, \"multi\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"multiday\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.ParseDays(this.data.multi);\n\t\t}\n\t}\n\n\tParseDays(events) {\n\t\tif (!events.length) return;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(events);\n\n\t\tconst days = [];\n\t\tfor (let d = 0; d < 7; d++) {\n\t\t\tdays.push({\n\t\t\t\tid: d + 1,\n\t\t\t\tdate: webix.Date.add(this.data.start, d, \"day\", true),\n\t\t\t});\n\t\t}\n\t\tthis.BreakEventsByDay(days);\n\n\t\tthis.SetMoreIcon(\n\t\t\tthis._maxEvents > this.maxVisibleLines ? this._expandState : null\n\t\t);\n\n\t\tthis.List.blockEvent();\n\t\tthis.List.parse(days);\n\t\tthis.ResetListHeight();\n\t\tthis.List.unblockEvent();\n\n\t\tthis.RenderEvents();\n\t}\n\n\tBreakEventsByDay(data) {\n\t\tthis.Days = [];\n\t\tconst processed = {};\n\t\tthis._maxEvents = 0;\n\n\t\tdata.forEach((day, dayIndex) => {\n\t\t\tconst today = day.date;\n\t\t\tthis.Days.push([]);\n\n\t\t\tthis.Events.data.each(ev => {\n\t\t\t\tif (!webix.isUndefined(processed[ev.id])) {\n\t\t\t\t\tif ((today <= ev.end_date && ev.all_day) || today < ev.end_date) {\n\t\t\t\t\t\tthis.Days[dayIndex][processed[ev.id]] = \"\";\n\t\t\t\t\t} else delete processed[ev.id];\n\t\t\t\t} else if (\n\t\t\t\t\tev.start_date < webix.Date.add(today, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= today\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(this.Days[dayIndex][index])) index++;\n\n\t\t\t\t\tprocessed[ev.id] = index;\n\n\t\t\t\t\tconst config = {};\n\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\tconfig.length =\n\t\t\t\t\t\t1 +\n\t\t\t\t\t\tdaysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(this.data.start, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(this.data.end - 1, config.ee)))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tev.$config = config;\n\t\t\t\t\tthis.Days[dayIndex][index] = ev;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.Days[dayIndex].length > this._maxEvents)\n\t\t\t\tthis._maxEvents = this.Days[dayIndex].length;\n\t\t});\n\t}\n\n\tRenderEvents() {\n\t\tconst allEvents = this.Events.count();\n\n\t\tif (!allEvents) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\n\t\tlet html = \"\";\n\t\tlet renderedEvents = 0;\n\t\tconst toHide =\n\t\t\tthis._expandState === \"down\" && this._maxEvents > this.maxVisibleLines;\n\n\t\tthis.List.data.each((_day, dayIndex) => {\n\t\t\tconst dayHTML = [];\n\t\t\tconst visible = toHide\n\t\t\t\t? this.maxVisibleLines - 1\n\t\t\t\t: this.Days[dayIndex].length;\n\n\t\t\tfor (let i = 0; i < visible; ++i) {\n\t\t\t\tdayHTML[i] = this.Days[dayIndex][i];\n\n\t\t\t\tif (dayHTML[i]) {\n\t\t\t\t\tdayHTML[i] = this.ToHTML(dayHTML[i], dayIndex, i);\n\t\t\t\t\trenderedEvents++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t});\n\n\t\tif (toHide) {\n\t\t\thtml += this.MoreOption(allEvents - renderedEvents);\n\t\t}\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, cIndex, rIndex) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst size = this.GetSizePosition(obj.$config.length, cIndex, rIndex);\n\t\tconst css = this.GetStyle(obj, obj.$config);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text || _(\"(No title)\")}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${style}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tconst { start, end } = this.data;\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (c.es < start && webix.Date.equal(start, webix.Date.dayStart(c.ls)))\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\tif (\n\t\t\tc.ee >= end &&\n\t\t\twebix.Date.equal(\n\t\t\t\twebix.Date.add(end, -1, \"day\", true),\n\t\t\t\twebix.Date.dayStart(c.le)\n\t\t\t)\n\t\t)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tMoreOption(excess) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst size = this.GetSizePosition(\n\t\t\tthis.List.config.xCount,\n\t\t\t0,\n\t\t\tthis.maxVisibleLines - 1\n\t\t);\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" class=\"webix_scheduler_multiday_event webix_scheduler_multi_more\" style=\"${size}\">${excess} ${_(\n\t\t\t\"more\"\n\t\t)}</div>`;\n\t}\n\n\tGetSizePosition(length, cIndex, rIndex) {\n\t\t// numbers are for space between events and borders of component\n\t\tconst width = length * this.List.type.width - 4;\n\t\tconst height = this.List.type.itemHeight - 4;\n\t\tconst left = this.List.type.width * cIndex + 1;\n\t\tconst top = rIndex * this.List.type.itemHeight + 1;\n\n\t\treturn `width:${width}px; height:${height}px; line-height:${height}px; left:${left}px; top:${top}px;`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id) {\n\t\t\tif (event.id === \"$wsh_multi_more\") return this.ExpandData();\n\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\n\t\t\tthis._expandState = \"up\";\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.ResetListHeight(this._maxEvents);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._maxEvents - this.maxVisibleLines) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.ResetListHeight(this.maxVisibleLines);\n\t\t\t});\n\t\t}\n\t}\n\n\tResetListHeight(count) {\n\t\tif (!count)\n\t\t\tcount =\n\t\t\t\tthis._expandState === \"down\"\n\t\t\t\t\t? Math.min(this._maxEvents, this.maxVisibleLines)\n\t\t\t\t\t: this._maxEvents;\n\n\t\tconst height = count * this.List.type.itemHeight;\n\t\tif (this.List.type.height !== height) {\n\t\t\tthis.List.type.height = height;\n\t\t\tthis.List.define(\"height\", height);\n\t\t\tthis.List.resize();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport DayEventsView from \"../day/events\";\nimport WeekHeaderView from \"./header\";\nimport WeekEventsView from \"./compact\";\nimport HourscaleView from \"../common/hourscale\";\nimport MultiDayEventsView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class WeekView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tif (this.Compact) {\n\t\t\treturn {\n\t\t\t\trows: [WeekEventsView],\n\t\t\t};\n\t\t} else {\n\t\t\tconst days = {\n\t\t\t\tlocalId: \"scroll\",\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tscroll: \"y\",\n\t\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\t\tbody: {\n\t\t\t\t\tcols: [HourscaleView],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst weekLength = 7;\n\t\t\tfor (let i = 0; i < weekLength; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(DayEventsView))(this.app, {\n\t\t\t\t\t\tday: i,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [\n\t\t\t\t\tWeekHeaderView,\n\t\t\t\t\t{ localId: \"multi\", hidden: true, cols: [MultiDayEventsView] },\n\t\t\t\t\tdays,\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t\t}\n\t}\n\n\tRefreshData(date) {\n\t\tconst start = webix.Date.weekStart(date);\n\t\tconst end = webix.Date.add(start, 1, \"week\", true);\n\t\tthis.GetWeek(start, end).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetWeek(start, end) {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tif (this.Compact) {\n\t\t\t\t\treturn { start, end, all: evs };\n\t\t\t\t}\n\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { start, end, multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import m0 from \"./views/bars/add\";\nimport m1 from \"./views/bars/date\";\nimport m2 from \"./views/bars/index.js\";\nimport m3 from \"./views/bars/nav\";\nimport m4 from \"./views/bars/navpopup\";\nimport m5 from \"./views/event/actionmenu\";\nimport m6 from \"./views/event/form\";\nimport m7 from \"./views/event/formpopup\";\nimport m8 from \"./views/event/info\";\nimport m9 from \"./views/event/recurringform\";\nimport m10 from \"./views/main\";\nimport m11 from \"./views/modes/agenda/index.js\";\nimport m12 from \"./views/modes/common/actionpopup\";\nimport m13 from \"./views/modes/common/hourscale\";\nimport m14 from \"./views/modes/common/multimore\";\nimport m15 from \"./views/modes/common/unitlist\";\nimport m16 from \"./views/modes/day/events\";\nimport m17 from \"./views/modes/day/index.js\";\nimport m18 from \"./views/modes/day/multiday\";\nimport m19 from \"./views/modes/month/compact\";\nimport m20 from \"./views/modes/month/events\";\nimport m21 from \"./views/modes/month/header\";\nimport m22 from \"./views/modes/month/index.js\";\nimport m23 from \"./views/modes/month/list\";\nimport m24 from \"./views/modes/month/more\";\nimport m25 from \"./views/modes/timeline/bar\";\nimport m26 from \"./views/modes/timeline/chart\";\nimport m27 from \"./views/modes/timeline/index.js\";\nimport m28 from \"./views/modes/timeline/more\";\nimport m29 from \"./views/modes/timeline/scale\";\nimport m30 from \"./views/modes/units/events\";\nimport m31 from \"./views/modes/units/header\";\nimport m32 from \"./views/modes/units/index.js\";\nimport m33 from \"./views/modes/units/multiday\";\nimport m34 from \"./views/modes/units/multidaylist\";\nimport m35 from \"./views/modes/week/compact\";\nimport m36 from \"./views/modes/week/header\";\nimport m37 from \"./views/modes/week/index.js\";\nimport m38 from \"./views/modes/week/multiday\";\nimport m39 from \"./views/side/editor\";\nimport m40 from \"./views/side/index.js\";\nimport m41 from \"./views/side/popup\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"bars/add\"] = m0;\nviews[\"bars/date\"] = m1;\nviews[\"bars\"] = m2;\nviews[\"bars/nav\"] = m3;\nviews[\"bars/navpopup\"] = m4;\nviews[\"event/actionmenu\"] = m5;\nviews[\"event/form\"] = m6;\nviews[\"event/formpopup\"] = m7;\nviews[\"event/info\"] = m8;\nviews[\"event/recurringform\"] = m9;\nviews[\"main\"] = m10;\nviews[\"modes/agenda\"] = m11;\nviews[\"modes/common/actionpopup\"] = m12;\nviews[\"modes/common/hourscale\"] = m13;\nviews[\"modes/common/multimore\"] = m14;\nviews[\"modes/common/unitlist\"] = m15;\nviews[\"modes/day/events\"] = m16;\nviews[\"modes/day\"] = m17;\nviews[\"modes/day/multiday\"] = m18;\nviews[\"modes/month/compact\"] = m19;\nviews[\"modes/month/events\"] = m20;\nviews[\"modes/month/header\"] = m21;\nviews[\"modes/month\"] = m22;\nviews[\"modes/month/list\"] = m23;\nviews[\"modes/month/more\"] = m24;\nviews[\"modes/timeline/bar\"] = m25;\nviews[\"modes/timeline/chart\"] = m26;\nviews[\"modes/timeline\"] = m27;\nviews[\"modes/timeline/more\"] = m28;\nviews[\"modes/timeline/scale\"] = m29;\nviews[\"modes/units/events\"] = m30;\nviews[\"modes/units/header\"] = m31;\nviews[\"modes/units\"] = m32;\nviews[\"modes/units/multiday\"] = m33;\nviews[\"modes/units/multidaylist\"] = m34;\nviews[\"modes/week/compact\"] = m35;\nviews[\"modes/week/header\"] = m36;\nviews[\"modes/week\"] = m37;\nviews[\"modes/week/multiday\"] = m38;\nviews[\"side/editor\"] = m39;\nviews[\"side\"] = m40;\nviews[\"side/popup\"] = m41;\n\nexport default views;\n","import { parse } from \"helpers/ical\";\nimport { explodeEvent, checkPattern } from \"helpers/recurring\";\n\nexport default class LocalData {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.store = this.createEvents();\n\t\tthis.events_ready = null;\n\n\t\tif (app.config.calendars !== false) {\n\t\t\tthis.cals = this.createCalendars();\n\t\t\tthis.cals_ready = null;\n\t\t}\n\n\t\tif (app.config.units !== false) {\n\t\t\tthis.unitsCache = this.createUnits();\n\t\t\tthis.units_ready = null;\n\t\t}\n\n\t\tif (app.config.timeline !== false) {\n\t\t\tthis._sections = this.createSections();\n\t\t\tthis._sections_ready = null;\n\t\t}\n\n\t\tconst utc = app.config.serverUTC; //load and save dates as UTC\n\t\tthis.strToDate = webix.Date.strToDate(webix.i18n.parseFormat, utc);\n\t\tthis.dateToStr = webix.Date.dateToStr(webix.i18n.parseFormat, utc);\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\n\t\tthis.loaded_ranges = {}; //cached date bounds in dyn. mode\n\t}\n\t/**\n\t * Creates events collection\n\t * @returns {Object} events Data Collection\n\t */\n\tcreateEvents() {\n\t\tconst c = new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: data => {\n\t\t\t\t\tif (typeof data.start_date === \"string\")\n\t\t\t\t\t\tdata.start_date = this.strToDate(data.start_date);\n\t\t\t\t\tif (typeof data.end_date === \"string\")\n\t\t\t\t\t\tdata.end_date = this.strToDate(data.end_date);\n\n\t\t\t\t\tif (this.app.config.recurring) {\n\t\t\t\t\t\tdata.$recurring = data.recurring ? parse(data.recurring) : null;\n\n\t\t\t\t\t\tif (data.$recurring) checkPattern(data);\n\n\t\t\t\t\t\tif (typeof data.origin_id === \"string\" && !isNaN(data.origin_id)) {\n\t\t\t\t\t\t\tdata.origin_id *= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof data.all_day === \"string\") data.all_day *= 1;\n\n\t\t\t\t\tthis.getColor(data, this.cals && this.cals.getItem(data.calendar));\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.eventOut(data),\n\t\t\t\t$export: data => this.eventOut(data),\n\t\t\t},\n\t\t});\n\n\t\treturn c;\n\t}\n\n\t/**\n\t * Loads events and populates events Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, events will be reloaded\n\t * @returns {Promise} promise that resolves with events collection\n\t */\n\tevents(sync, force) {\n\t\tconst store = this.store;\n\t\tif (sync) return store;\n\n\t\treturn this.calendars().then(() => {\n\t\t\t//data will be filled by getEvents\n\t\t\tif (this.app.config.dynamic) {\n\t\t\t\tif (!this.events_ready)\n\t\t\t\t\tthis.events_ready = webix.promise.resolve(this.store);\n\t\t\t} else if (!this.events_ready || force) {\n\t\t\t\tthis.events_ready = this.app\n\t\t\t\t\t.getService(\"backend\")\n\t\t\t\t\t.events()\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tstore.clearAll();\n\t\t\t\t\t\tstore.parse(data);\n\n\t\t\t\t\t\treturn store;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.events_ready;\n\t\t});\n\t}\n\t/**\n\t * Gets or loads events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetEvents(start, end) {\n\t\tconst mode = this.app.config.dynamic;\n\t\tlet evs;\n\n\t\tif (mode) {\n\t\t\tconst params = this.getParams(mode);\n\n\t\t\tif (params.then) {\n\t\t\t\t// loading now\n\t\t\t\tevs = params.then(() => {\n\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t});\n\t\t\t} else if (params === true) {\n\t\t\t\t//already loaded\n\t\t\t\tevs = this.getLocal(start, end);\n\t\t\t} else {\n\t\t\t\tevs = this.loaded_ranges[params.from] = this.getDynamic(params).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tevs = this.getLocal(start, end);\n\t\t}\n\t\treturn evs;\n\t}\n\t/**\n\t * Finds already loaded events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetLocal(start, end) {\n\t\treturn this.events().then(store => {\n\t\t\tconst config = this.app.config;\n\t\t\tconst active = this.app.getState().active;\n\t\t\tlet evs = [];\n\n\t\t\tstore.data.each(ev => {\n\t\t\t\tif (\n\t\t\t\t\t(!config.calendars || findCalendar(active, ev.calendar)) &&\n\t\t\t\t\tev.start_date < end &&\n\t\t\t\t\t(ev.end_date > start ||\n\t\t\t\t\t\t(ev.end_date >= start && ev.all_day) ||\n\t\t\t\t\t\t(ev.$recurring &&\n\t\t\t\t\t\t\t(!ev.$recurring.UNTIL || ev.$recurring.UNTIL > start)))\n\t\t\t\t) {\n\t\t\t\t\tif (this.app.config.recurring && ev.recurring) {\n\t\t\t\t\t\tevs = evs.concat(explodeEvent(start, end, ev));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete ev.recurring;\n\t\t\t\t\t\tevs.push(ev);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tev.start_date = this.roundTime(ev.start_date);\n\t\t\t\tev.end_date = this.roundTime(ev.end_date);\n\t\t\t});\n\n\t\t\tevs.sort(function(a, b) {\n\t\t\t\treturn a.start_date - b.start_date || a.end_date - b.end_date;\n\t\t\t});\n\n\t\t\treturn evs;\n\t\t});\n\t}\n\t/**\n\t * Loads events portion\n\t * @param {Object} params - dynamic loading settings\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetDynamic(params) {\n\t\treturn this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.events(params)\n\t\t\t.then(data => {\n\t\t\t\tthis.store.parse(data);\n\t\t\t\tthis.loaded_ranges[params.from] = true;\n\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t/**\n\t * Gets dynamic loading parameters\n\t * @param {string} mode - dynamic loading mode, \"day\", \"week\", \"month\" or \"year\"\n\t * @returns {Object} object with parameters\n\t */\n\tgetParams(mode) {\n\t\tconst state = this.app.getState();\n\t\tconst format = webix.i18n.parseFormatStr;\n\n\t\tlet from = webix.Date[mode + \"Start\"](state.date);\n\t\tlet to = webix.Date.add(from, 1, mode, true);\n\n\t\tif (\n\t\t\t(mode === \"month\" || mode === \"year\") &&\n\t\t\t(state.mode === \"week\" || state.mode === \"month\")\n\t\t) {\n\t\t\tfrom = webix.Date.weekStart(from);\n\t\t\tto = webix.Date.weekStart(webix.Date.add(from, 1, state.mode, true));\n\t\t}\n\n\t\tconst fromStr = format(from);\n\n\t\tlet res;\n\n\t\tif (!this.loaded_ranges[fromStr]) {\n\t\t\tres = {\n\t\t\t\tfrom: fromStr,\n\t\t\t\tto: format(to),\n\t\t\t};\n\t\t} else res = this.loaded_ranges[fromStr];\n\n\t\treturn res;\n\t}\n\t/**\n\t * Creates calendars collection\n\t * @returns {Object} calendars Data Collection\n\t */\n\tcreateCalendars() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\tby: \"active\",\n\t\t\t\t\tas: sortCalendars,\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonAfterDelete: () => this.setActive(),\n\t\t\t\tonAfterAdd: () => this.setActive(),\n\t\t\t\t\"data->onDataUpdate\": (id, data, old) => {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\tif (data.color !== old.color) {\n\t\t\t\t\t\t\tthis.store.data.each(obj => {\n\t\t\t\t\t\t\t\tif (obj.calendar == id) this.getColor(obj, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.app.callEvent(\"events:refresh\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.active !== old.active) {\n\t\t\t\t\t\t\tthis.setActive();\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.cals.sort(\"#active#\", \"desc\", sortCalendars);\n\t\t\t\t\t\t\t}, 400);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads calendars and populates calendars Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, calendars will be reloaded\n\t * @returns {Promise} promise that resolves with calendars collection\n\t */\n\tcalendars(sync, force) {\n\t\tif (this.app.config.calendars == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst cals = this.cals;\n\t\tif (sync) return cals;\n\t\tif (this.cals_ready && !force) return this.cals_ready;\n\n\t\tthis.cals_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.calendars()\n\t\t\t.then(data => {\n\t\t\t\tcals.clearAll();\n\t\t\t\tcals.parse(data);\n\n\t\t\t\tthis.setActive();\n\n\t\t\t\treturn cals;\n\t\t\t});\n\n\t\treturn this.cals_ready;\n\t}\n\t/**\n\t * Processes event item before saving, serializing or exporting it\n\t * @param {Object} data - event item\n\t * @param {Boolean} save - true, if called for saving operation\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @returns {Object} events object\n\t */\n\teventOut(data, save, inner) {\n\t\tdata = webix.copy(data);\n\n\t\tif (!inner && data.recurring) checkPattern(data);\n\n\t\t// export and serialize: there's no need to convert date to UTC\n\t\tconst format = save ? this.dateToStr : this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\tif (!save) {\n\t\t\tdelete data.$recurring;\n\t\t\tdelete data.$textColor;\n\t\t\tdelete data.$color;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/** Sets an array of active calendars IDs to app state */\n\tsetActive() {\n\t\tlet active = [];\n\t\tthis.cals.data.each(d => {\n\t\t\tif (d.active * 1) active.push(d.id);\n\t\t});\n\t\tthis.app.getState().active = active;\n\t}\n\t/**\n\t * Assigns colors to event item\n\t * @param {Object} data - event object\n\t * @param {Object} force - calendar object\n\t */\n\tgetColor(data, calendar) {\n\t\tdata.$color = calendar ? calendar.color : data.color || \"#01C2A5\"; //same for new event in form\n\t\tdata.$textColor = getContrastingColor(data.color || data.$color);\n\t}\n\t/**\n\t * Rounds time for start and end dates of event item to 5 minutes to match Webix Timepicker\n\t * @param {Date} date - Date object\n\t * @returns {Date} Date object with rounded minutes\n\t */\n\troundTime(date) {\n\t\tconst res = webix.Date.copy(date);\n\t\tres.setMinutes(Math.round(res.getMinutes() / 5) * 5);\n\t\treturn res;\n\t}\n\t/**\n\t * Checks if there are sub-events after the start date of the stated occurrence of a recurring event\n\t * @param {Object} event - event object\n\t * @returns {boolean} result of the check\n\t */\n\tisLastPart(event) {\n\t\tconst hasParts = this.store.find(\n\t\t\te =>\n\t\t\t\tevent.origin_id == e.origin_id &&\n\t\t\t\t(event.$id || event.id) != e.id && // in dnd events have $id, in info they do not\n\t\t\t\tevent.start_date < e.start_date,\n\t\t\ttrue\n\t\t);\n\t\treturn !hasParts;\n\t}\n\n\tcreateUnits() {\n\t\treturn new webix.DataCollection({\n\t\t\tdata: [],\n\t\t});\n\t}\n\n\tunits(sync, force) {\n\t\tif (this.app.config.units == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst unitsCache = this.unitsCache;\n\t\tif (sync) return unitsCache;\n\t\tif (this.units_ready && !force) return this.units_ready;\n\n\t\tthis.units_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.units()\n\t\t\t.then(data => {\n\t\t\t\tunitsCache.clearAll();\n\t\t\t\tunitsCache.parse(data);\n\n\t\t\t\treturn unitsCache;\n\t\t\t});\n\n\t\treturn this.units_ready;\n\t}\n\n\tcreateSections() {\n\t\treturn new webix.DataCollection({});\n\t}\n\tsections(sync, force) {\n\t\tconst sections = this._sections;\n\t\tif (sync) return sections;\n\t\tif (this.sections_ready && !force) return this.sections_ready;\n\n\t\tthis.sections_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.sections()\n\t\t\t.then(data => {\n\t\t\t\tsections.clearAll();\n\t\t\t\tsections.parse(data);\n\t\t\t\treturn sections;\n\t\t\t});\n\n\t\treturn this.sections_ready;\n\t}\n}\n\n/**\n * Gets contrasting text color for the event background color\n * @param {string} color - background color\n * @returns {string} text color\n */\nfunction getContrastingColor(color) {\n\tconst rgb = webix.color.toRgb(color);\n\tconst brightness = Math.round(\n\t\t(rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n\t);\n\treturn brightness > 180 ? \"#475466\" : \"#ffffff\";\n}\n/**\n * Checks whether the stated calendar is active\n * @param {Array} arr - array of IDs of active calendars\n * @param {string|number} arr - ID of the searched calendar\n * @returns {boolean} result of the check\n */\nfunction findCalendar(arr, c) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == c) return true;\n\t}\n\treturn false;\n}\n/**\n * Compares active state of calendars\n * @param {string} a - value of the 'active' field\n * @param {string} b - value of the 'active' field\n * @returns {boolean} result of the comparison\n */\nfunction sortCalendars(a, b) {\n\treturn a * 1 > b * 1 ? 1 : -1;\n}\n","import {\n\tisFirstOccurrence,\n\tcutOccurrence,\n\tclipSequence,\n\tcorrectMode,\n} from \"../helpers/recurring\";\n\nexport default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.Back = app.getService(\"backend\");\n\n\t\tconst local = (this.Local = app.getService(\"local\"));\n\t\tthis.Events = local.events(true);\n\t\tthis.Cals = local.calendars(true);\n\t\tthis.State = app.getState();\n\t}\n\t/**\n\t * Adds event\n\t * @param {Object} obj - object with event fields\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @param {string} temp - ID of the temporary task\n\t * @returns {promise} promise that resolves with event id\n\t */\n\taddEvent(obj, inner, temp) {\n\t\tconst tosave = this.Local.eventOut(obj, true, inner);\n\t\treturn this.Back.addEvent(tosave).then(res => {\n\t\t\tif (temp) this.Events.remove(temp);\n\t\t\tobj.id = res.id;\n\t\t\treturn this.Events.add(obj);\n\t\t});\n\t}\n\t/**\n\t * Updates event\n\t * @param {(string|number)} id - event ID\n\t * @param {Object} obj - object with event fields\n\t * @param {string} mode - update mode: \"unite\" or \"next\"\n\t * @param {Date} date - the start date of the new event subseries\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @returns {promise} promise\n\t */\n\tupdateEvent(id, obj, mode, date, inner) {\n\t\tconst tosave = this.Local.eventOut(obj, true, inner);\n\t\treturn this.Back.updateEvent(id, tosave, mode, date).then(() => {\n\t\t\tthis.Events.updateItem(id, obj);\n\n\t\t\tif (mode === \"all\") {\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t} else if (mode === \"next\" && date) {\n\t\t\t\t// in case update came for a sub-event, find master\n\t\t\t\tconst cev = this.Events.getItem(id);\n\t\t\t\tif (cev.origin_id) id = cev.origin_id;\n\n\t\t\t\tconst parts = this.Events.find(\n\t\t\t\t\te => e.origin_id == id && e.start_date >= date\n\t\t\t\t).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Removes event\n\t * @param {string} mode - edit mode: \"this\", \"next\" or \"all\"\n\t * @param {Object} obj - object with event fields\n\t * @param {number} date_id - ID of event occurrence, for custom calls\n\t * @returns {promise} promise\n\t */\n\tremoveEvent(mode, obj, date_id) {\n\t\tlet id = this.State.selected ? this.State.selected.id : obj.$id || obj.id;\n\n\t\t// non-recurring and special cases of recurring\n\t\tconst isFirst = mode ? isFirstOccurrence(date_id, obj.start_date) : false;\n\t\tif (mode === \"next\" && isFirst) {\n\t\t\tmode = correctMode.call(this, obj, mode);\n\t\t}\n\n\t\tif (\n\t\t\t!mode ||\n\t\t\tmode === \"all\" ||\n\t\t\t(mode === \"this\" && !date_id) ||\n\t\t\t(mode === \"next\" && obj.origin_id && isFirst)\n\t\t) {\n\t\t\tif (mode === \"all\" && obj.origin_id) id = obj.origin_id;\n\n\t\t\tthis.Back.removeEvent(id).then(() => {\n\t\t\t\tthis.Events.remove(id);\n\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t});\n\t\t} else {\n\t\t\t// recurring events...\n\t\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t\tif (!date_id) {\n\t\t\t\t\tid = obj.origin_id;\n\t\t\t\t\tobj = this.Events.getItem(id);\n\t\t\t\t}\n\n\t\t\t\tconst date = webix.Date.dayStart(\n\t\t\t\t\tdate_id ? new Date(date_id.split(\"_\")[0] * 1) : obj.start_date\n\t\t\t\t);\n\t\t\t\tconst recurring =\n\t\t\t\t\tmode === \"this\" ? cutOccurrence(date, obj) : clipSequence(date, obj);\n\n\t\t\t\t// [fixme] if all occ-s were removed, remove the whole event instead of update\n\t\t\t\t// or do this in PUT on backend - otherwise an 'empty' 'all' event will hang in db, unavailable for calendar\n\n\t\t\t\tthis.updateEvent(id, { recurring }, mode, date, true);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Adds calendar\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise that resolves with calendar id\n\t */\n\taddCalendar(obj) {\n\t\tif (!obj) obj = { text: \"\", color: \"#997CEB\", active: 1 };\n\n\t\treturn this.Back.addCalendar(obj).then(res => {\n\t\t\tobj.id = res.id;\n\t\t\tthis.Cals.add(obj, 0);\n\t\t\treturn obj.id;\n\t\t});\n\t}\n\t/**\n\t * Updates calendar\n\t * @param {string|number} id - calendar ID\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise\n\t */\n\tupdateCalendar(id, obj) {\n\t\tif (!this.app.getState().readonly)\n\t\t\treturn this.Back.updateCalendar(id, obj).then(() => {\n\t\t\t\treturn this.Cals.updateItem(id, obj);\n\t\t\t});\n\t\telse return webix.promise.resolve(this.Cals.updateItem(id, obj));\n\t}\n\n\tremoveCalendar(id) {\n\t\tthis.Back.removeCalendar(id).then(() => {\n\t\t\tthis.Cals.remove(id);\n\t\t});\n\t}\n}\n","export default class Backend {\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\n\tevents(params) {\n\t\treturn webix.ajax(this.url(\"events\"), params).then(res => res.json());\n\t}\n\n\taddEvent(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"events\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst params = obj;\n\t\tif (mode) params.recurring_update_mode = mode;\n\t\tif (date) params.recurring_update_date = date;\n\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"events/\" + id), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveEvent(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"events/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tcalendars() {\n\t\treturn webix.ajax(this.url(\"calendars\")).then(res => res.json());\n\t}\n\n\taddCalendar(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"calendars\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateCalendar(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"calendars/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveCalendar(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"calendars/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tunits(params) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.get(this.url(\"units\"), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tsections() {\n\t\treturn webix.ajax(this.url(\"sections\")).then(res => res.json());\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link, ignoreInitial } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\nimport LocalData from \"models/LocalData\";\nimport Operations from \"./models/Operations\";\nimport Backend from \"./models/Backend\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tmode: config.mode || \"month\",\n\t\t\tdate: webix.Date.datePart(config.date || new Date()),\n\t\t\treadonly: config.readonly || false,\n\t\t\tactive: [],\n\t\t\tselected: null,\n\t\t\ttimeline: webix.isUndefined(config.timeline) ? false : config.timeline,\n\t\t\ttimelineMode: config.timelineMode || \"week\",\n\t\t});\n\n\t\tconfig = config || {};\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/main\",\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\tcompactWidth: 780,\n\t\t\trecurring: true,\n\t\t\tcalendars: true,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// order matters!\n\t\tthis.setService(\n\t\t\t\"backend\",\n\t\t\tnew (this.dynamic(Backend))(this, this.config.url)\n\t\t);\n\t\tthis.setService(\"local\", new (this.dynamic(LocalData))(this, config));\n\t\tthis.setService(\"operations\", new (this.dynamic(Operations))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tdynamic(obj) {\n\t\treturn this.config.override ? this.config.override.get(obj) || obj : obj;\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"scheduler\",\n\t\tapp: App,\n\t\tdefaults: {\n\t\t\tborderless: true,\n\t\t},\n\t\t$init: function() {\n\t\t\tthis.name = \"scheduler\";\n\n\t\t\tconst state = this.$app.getState();\n\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tstate.$changes.attachEvent(\"date\", () => {\n\t\t\t\tignoreInitial((v, o) => this.callEvent(\"onChange\", v, o));\n\t\t\t});\n\n\t\t\tthis.$app.attachEvent(\"app:beforedrag\", (ctx, e) =>\n\t\t\t\tthis.callEvent(\"onBeforeEventDrag\", [ctx, e])\n\t\t\t);\n\t\t\tthis.$app.attachEvent(\"app:beforedrop\", (ctx, e) =>\n\t\t\t\tthis.callEvent(\"onBeforeEventDrop\", [ctx, e])\n\t\t\t);\n\t\t},\n\t\t$exportView: function(options) {\n\t\t\tif (\n\t\t\t\toptions.export_mode === \"png\" ||\n\t\t\t\t(options.export_mode === \"pdf\" && options.display === \"image\")\n\t\t\t)\n\t\t\t\treturn this.$app.getRoot();\n\t\t\treturn this.$app.getService(\"local\").events(true);\n\t\t},\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, LocalData, Operations };\nconst locales = { en };\nexport { views, services, locales };\n","export default {\n\t//navigation\n\tWeek: \"Week\",\n\tDay: \"Day\",\n\tMonth: \"Month\",\n\tAgenda: \"Agenda\",\n\tUnits: \"Units\",\n\tTimeline: \"Timeline\",\n\tToday: \"Today\",\n\tCreate: \"Create\",\n\tNext: \"Next\",\n\tPrevious: \"Previous\",\n\t\"Next day\": \"Next day\",\n\t\"Previous day\": \"Previous day\",\n\t\"Next week\": \"Next week\",\n\t\"Previous week\": \"Previous week\",\n\t\"Next month\": \"Next month\",\n\t\"Previous month\": \"Previous month\",\n\n\t// managing calendars\n\t\"Add calendar\": \"Add calendar\",\n\t\"Do you really want to remove this calendar?\":\n\t\t\"Do you really want to remove this calendar?\",\n\t\"Edit calendar\": \"Edit calendar\",\n\tDelete: \"Delete\",\n\tSave: \"Save\",\n\tTitle: \"Title\",\n\tColor: \"Color\",\n\tActive: \"Active\",\n\tSettings: \"Settings\",\n\t\"(no title)\": \"(no title)\",\n\t\"Inactive calendar\": \"Inactive calendar\",\n\n\t// modes\n\t\"No Events\": \"No Events\",\n\t\"All Day\": \"All Day\",\n\tmore: \"more\",\n\t\"Expand all-day events\": \"Expand all-day events\",\n\t\"Collapse all-day events\": \"Collapse all-day events\",\n\n\t// info and form\n\t\"The event will be deleted permanently, are you sure?\":\n\t\t\"The event will be deleted permanently, are you sure?\",\n\tDone: \"Done\",\n\t\"Delete event\": \"Delete event\",\n\tClose: \"Close\",\n\tEdit: \"Edit\",\n\t\"(No title)\": \"(No title)\",\n\tEvent: \"Event\",\n\tStart: \"Start\",\n\tEnd: \"End\",\n\tCalendar: \"Calendar\",\n\tNotes: \"Notes\",\n\tfrom: \"from\",\n\tto: \"to\",\n\t\"Edit event\": \"Edit event\",\n\t\"Assigned to units\": \"Assigned to units\",\n\t\"No units\": \"No units\",\n\t\"Unknown unit\": \"Unknown unit\",\n\n\t//recurring\n\tnever: \"never\",\n\tnone: \"none\",\n\tdaily: \"daily\",\n\tday: \"day\",\n\tdays: \"days\",\n\tevery: \"Every\",\n\tweekly: \"weekly\",\n\tweek: \"week\",\n\tweeks: \"weeks\",\n\teach: \"Every\",\n\tmonthly: \"monthly\",\n\tmonth: \"month\",\n\tmonths: \"months\",\n\tyearly: \"yearly\",\n\tyear: \"year\",\n\tyears: \"years\",\n\tRepeat: \"Repeat\",\n\t\"End repeat\": \"End repeat\",\n\t\"Repeats each\": \"Repeats each\",\n\ttill: \"till\",\n\ttimes: \"times\",\n\t\"weekly, every\": \"weekly, every\",\n\t\"monthly, every\": \"monthly, every\",\n\t\"yearly, every\": \"yearly, every\",\n\t\"every working day\": \"every working day\",\n\tcustom: \"custom\",\n\tEvery: \"Every\",\n\ton: \"on\",\n\tof: \"of\",\n\t\"after several occurrences\": \"after several occurrences\",\n\tdate: \"date\",\n\t\"week on\": \"week on\",\n\t\"Change recurring pattern\": \"Change recurring pattern\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t// menus for edit and delete\n\t\"All events\": \"All events\",\n\t\"This event\": \"This event\",\n\t\"This event and the following\": \"This event and the following\",\n\tCancel: \"Cancel\",\n\tApply: \"Apply\",\n\t\"Edit recurring event\": \"Edit recurring event\",\n\n\t\"Timeline scale\": \"Timeline scale\",\n\tSection: \"Section\",\n\t\"Show more\": \"Show more\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","AddView","getService","compact","cals","calendars","icon","css","label","width","height","skin","$active","inputHeight","on","onItemClick","AddEvent","align","getState","selected","DateView","cols","tooltip","NavLabel","ChangeDate","State","$changes","DateLabel","timeline","dir","state","step","GetStep","mode","add","date","diff","Math","abs","getMonth","setDate","$batch","timelineMode","longDateFormatStr","dateToStr","setHTML","NavBarView","units","toolbar","bottomOffset","borderless","optionWidth","onChange","SetMode","setValue","getPalette","aSkin","optionHeight","palette","SidePopupView","save","inputWidth","click","Save","compactBar","padding","left","layoutPadding","form","right","elements","hide","controls","Delete","modal","close","position","fullscreen","head","suggest","onHide","Form","splice","Cals","Ops","getItem","setValues","color","active","focus","getValues","updateCalendar","addCalendar","removeCalendar","relative","rows","UpdateColor","onClick","webix_template","ShowEditor","Editor","EditorView","node","Cid","Show","SideView","Compact","calendar","monthSelect","onAfterDateSelect","dayStart","ListType","autoheight","yCount","editable","editValue","editaction","editor","webix_scheduler_cal_edit","ShowPopup","webix_scheduler_cal_title","ToggleCalendar","webix_scheduler_active","onBeforeEditStop","v","SetTitle","side","maxHeight","readonly","AddCalendar","onAfterScroll","Popup","Hide","Data","PopupView","EditAbility","unselectAll","ToggleState","checkbox","common","edit","env","touch","getEditor","getInputNode","setAttribute","select","getItemNode","EditStopSilent","fail","blockEvent","editCancel","editStop","unblockEvent","NavPopupView","tHeight","tabbarHeight","TopBarView","todayIcon","batch","SetToday","todayBtn","responsive","paddingY","paddingX","visibleBatch","ShowNav","responsiveCell","NavPopup","ToggleAdd","EventActionMenu","onMenuItemClick","Result","Root","icalFormat","string","_a","name_1","UNTIL","strToDate","EXDATE","map","d","serialize","WEEKDAYS","FREQUENCE","DAILY","WEEKLY","MONTHLY","YEARLY","findDate","arr","equal","fillWdays","consts","BYDAY","wdays","line","sort","s","j","interval","INTERVAL","FREQ","getDate","getDay","setMonth","BYMONTHDAY","BYSETPOS","checkDay","sdate","days","oldDay","WeekdaysToDates","getParams","$id","$recurring","extractDate","clipSequence","ev","block","COUNT","filter","cutOccurrence","separateSequence","start_date","len","end_date","isFirstOccurrence","evStart","correctMode","origin_id","recurring","isLastPart","movePattern","rec","newEvent","oldEvent","nmd","nwn","getWeekNum","BYMONTH","nm","day","floor","checkPattern","RecurringFormView","elementsConfig","labelPosition","bottom","CreateIntervalControls","CreateCheckboxes","CreateSelect","CreateRadio","o","m","UpdateEvent","Events","CheckBoxContainer","Checkboxes","getChildViews","pop","PatternSelect","UntilDateContainer","UntilDateCalendar","untilDate","getPopup","getBody","UntilNumContainer","UntilNum","CustomRecControls","margin","labelWidth","min","ChangeControls","_freq","getList","dayShort","labelAlign","CheckboxGuard","gravity","isUndefined","GetBYDAY","values","check","find","getValue","byDay","dayFull","monthFull","calculated","month","weekNum","weekday","rec_pattern","vertical","ChangeSelectors","icons","_StartDate","until","untilCount","CountNum","define","minDate","SetUNTIL","SetBYDAY","SetPatternOptions","setDirty","GetUntil","GetRecPattern","change","GetValues","isDirty","changeMode","date_id","correctCountUntil","collection","oid","b","last","countToUntil","nexto","cutCount","hasOneOccurrence","lr","EditRecurringMixin","ChangeMode","CorrectCountUntil","HasOneOccurrence","EventFormView","hotkey","Close","Done","scroll","GetDateTime","labelRight","ToggleTimeControls","CreateCalendarColor","getDirtyValues","PrepareChange","Wait","CreateRepeat","CreateUnitSelector","CreateSectionSelector","Local","RecurringOptions","StartTime","EndTime","_v","local","Calendars","waitUnits","combo_1","Sections","sections","SubForm","ClearTempEvent","FillForm","labelTopHeight","ToggleSubform","ShowSubForm","unshift","format","Id","NewEvent","FillFormContinue","AdaptObjToMode","start_time","end_time","datePart","SetRecurring","today","GetFromStartDate","roptions","ResetRecurringOptions","SetValues","rec_option","toLowerCase","time","timePart","GetStartDate","details","section","getFirstId","first","$color","unit","minutes","ceil","getMinutes","setHours","getHours","sid","_inProgress","addEvent","PrepareOut","newEvent_1","updateEvent","recVals","UpdateSelected","finally","fvals","Join","prev","ProcessRecurringOption","ProcessRecurringPattern","ProcessDates","ApplyDatechangeToRecurring","ProcessText","_changedValues","series_end_date","GetRecurring","edate","datesToWeekdays","all_day","CorrectDateTime","ev_length","opposite","field","trim","oldStart","length_1","r","GetRecurringPreset","dirty","UpdateStateDate","GetClosestOccurrenceDate","temp","GetModeBounds","weekStart","weeks","exists","remove","Back","Subform","IsDirty","subform","HideSubPop","getTopParentView","exit","FormPopup","EventView","StartAction","$view","InfoTemplate","UnitsLocal","action","EventObj","Menu","_waitMenu","defer","DeleteEvent","EditEvent","title","removeEvent","oneday","allday","timeFormatStr","startDate","endDate","startTime","endTime","fromTo","GetRecurringText","unitIDs_1","isLast","unitObj","unitValue","GetSection","pattern","EventActionPopup","buttons","layoutMargin","Cancel","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","y","MainView","fCompact","topbar","cells","main","compactWidth","SetCompactMode","ProgressBar","showProgress","delay","hideProgress","ToggleEvent","ToggleSidePanel","_dndActionPopup","ShowEvent","HideEvent","sameEvent","_sidePanel","marker","timeStart","dayEventColor","$textColor","fill","size","master","templateStart","marks","classname","aria","shrinkTo","before","after","isToday","isMultiDay","daysBetweenInclusive","round","isSameDate","adate","bdate","UnitListView","uniteBy","templateHeader","TemplateHeader","TimeStart","onUnits","SetUnits","List","OverlayBox","sel","hideOverlay","showOverlay","start_1","this_1","AgendaView","headerHeight","TemplateCss","onItemRender","$unit","CurrentUnit","firstChild","SelectEvent","RefreshData","_o","monthStart","getEvents","clearAll","ToggleOverlay","_selected","datestring","fstring","ids","getUnitList","HourscaleView","heightSize","ind","getIndexById","HourScaleItem","ParseHours","h","MultiMoreView","wxi-angle-down","ExpandData","wxi-angle-up","WrapData","MoreIcon","_expandState","maxVisibleLines","style","transition","_inAnimation","SetMoreIcon","_select","functor","trgs","LocateSelected","Select","Unselect","HandleSelection","_SelectionMode","id_1","operation","SelectionMixin","inner","_DataObj","querySelectorAll","el","firstElementChild","locate","Resizer","$dragIn","getContext","from","$dragPos","ctx","box","offset","y_diff","updateNodeHeight","duration","updateText","x_diff","DragControl","getNode","max","minEventHeight","getActualDate","any","exports","addDays","inc","differenceInCalendarDays","getTime","differenceInHours","f_cache","formatFunction","startOnMonday","year","getFullYear","quarter","week","sign","hour","minute","smallerCount","innerDiff","precise","wt","minUnit","getUnitStart","addUnit","filled","getDiff","sameMonth","daysOfFirstMonth","me","months","getMonthDayDiff","getSizes","task","scales","taskHeight","cellWidth","cellHeight","astart","ms","$h","$x","$w","$y","getMilestone","getEnd","getEndWorkday","getDatePart","d_1","isHoliday","holidayGuard","getDuration","parseFloat","toFixed","toClosestWorkday","notRight","alert","toWorkday","getCheckDate","getTimePart","canvas","createElement","strokeStyle","moveTo","lineTo","stroke","toDataURL","top_1","p","item","getMinUnit","tempEnd","fullWidth","fullHeight","countInWeeks","cdate","cnext","startTask","endTask","sx","sy","ex","ey","dy","$p","s_start","e_start","differentX","lineCoords","gapp","sx1","ex1","dx","same","getLineCoords","arrowCoords","$data","k","excludeHolidays","DragScroll","_auto_scroll_delay","autoScroll","clearTimeout","yScroll","direction","xScroll","autoYScroll","senseY","autoXScroll","senseX","updateDragPos","sense","getScrollState","autoScrollTo","snode","scrollWidth","scrollTo","initDnD","dragOnly","ctrl","modes","addDrag","addDrop","locateEvent","updateSelection","selection","editRecurring","newSubEvent","joinDateTime","shiftDate","mainDate","occDate","changeDate","ddate","dtime","$dragDestroy","$waitUpdate","visibility","$resize","moveMode","setDragOffset","x_offset","y_offset","_waitPopup","finishOperation","appendChild","$drop","$last_y","$dragCreate","GetEvent","cloneNode","className","Day","delta","getMaster","EventTemplate","noff","toff","getIdByIndex","$marked","markDropArea","$dragOut","drop","drag_container","$extra","extra","getLastId","xCount","multiday","more","children","ID","HideWindow","getEventUnits","currentUnits","targetUnit","Unit","sourceUnit","newUnits","dragScroll","nscroll","evContext","getEventContext","getMoveMode","scroll_1","getStep","parseInt","l","updateDragScrollConfig","Scales","changedTouches","touches","pageX","pageY","mouse","clientX","clientY","childNodes","getData","offsetDate","wrongDates","us","updateEventDates","nsc","allDay","rect","getBoundingClientRect","minWidth","ds","timelineMore","offsetParent","WeekDayNum","DayEventsView","webix_scheduler_day_event","onDblClick","webix_scheduler_day_scale_item","_e","ShowNew","RenderEvents","to","FilterToday","_marker_update_interval","clearInterval","setInterval","UpdateMarkerPosition","_Marker","single","create","class","evs","PrepareEvents","role","ToHTML","MarkToday","$inner","orderSet","PruneStack","$sorder","max_count","SetPosition","GetEventEndDate","$count","temp_width","$width","$left","evCorrectedCopy","sm","em","$top","$height","content","EventTemplateStart","resizer","MultidayEventList","webix_scheduler_multiday_event","_moreBtn","$css","LimitData","multi","GetStyle","excess","_reserve","_reserveIds","Animate","DayView","ScrollScale","GetDay","CalendarView","isOutside","MarkEvent","navigation","monthHeader","skipEmptyWeeks","Calendar","c","MoreWindowView","minHeight","webix_scheduler_month_event","webix_scheduler_month_event_single","MoreTemplate","Win","_c","DayFormatStr","MonthEventsView","prerender","webix_cal_date","_ev","ShowDay","webix_scheduler_more","ShowMore","webix_cal_day","CalendarTemplate","eventHeight","MoreWindow","dynamic","$more","GetDayCss","maxLines","wStart","wEnd","cache","each","dayIndex","dayHTML","es","ee","ls","le","prevLength","GetPosition","row","col","start_a","start_b","days_a","monthData","GetMonthData","ShowWindow","MonthHeaderView","GetHeaderData","MonthListView","MonthView","BarView","barHeight","MoreView","clientWidth","ChartView","_sectionSize","borderWidth","header","rowHeight","scrollAlignY","columns","fillspace","webix_scheduler_timeline_event","webix_list_item","Tree","Bars","InnerState","scheme","$change","RefreshTask","_sectionsReady","HandleScroll","_mousemove_handler","cursor","switchCursor","DrawGrid","_processed","_lastRow","_section","_moreEvents","updID","sectionIndex","order","CheckDates","prev_1","findIndex","updateTask","$hide","removeChild","MoreBarTemplate","BarsTemplate","backgroundImage","grid","$name","marginTop","backgroundPosition","Resize","area","querySelector","_scroll_handler","bars","scrollTop","scrollLeft","offsetX","ScalesView","scale","innerState","RenderScales","cell","CellTemplate","TimelineView","ScaleView","SetScales","resetScales","GetScalesCellWidth","GetScalesArray","parser","wstart","wend","UnitEventsView","unitID","UnitsHeaderView","Header","Units","unitsCache","sync","UnitMultidayList","FilterByUnits","expandable","multiEvents","UnitMultidayView","animate","UnitsView","WeekEventsView","WeekHeaderView","MultiDayEventsView","itemHeight","ParseDays","BreakEventsByDay","_maxEvents","ResetListHeight","Days","processed","$config","allEvents","renderedEvents","toHide","_day","visible","MoreOption","cIndex","rIndex","GetSizePosition","WeekView","GetWeek","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","m22","m23","m24","m25","m26","m27","m28","m29","m30","m31","m32","m33","m34","m35","m36","m37","m38","m39","m40","m41","createEvents","events_ready","createCalendars","cals_ready","createUnits","units_ready","_sections","createSections","_sections_ready","utc","serverUTC","parseFormat","dateToLocalStr","loaded_ranges","LocalData","isNaN","getColor","$serialize","eventOut","$export","force","getLocal","getDynamic","findCalendar","xdate","explodeEvent","roundTime","parseFormatStr","fromStr","$sort","by","as","sortCalendars","onAfterDelete","setActive","onAfterAdd","data->onDataUpdate","rgb","toRgb","setMinutes","sections_ready","Operations","tosave","updateItem","cev","isFirst","_url","Backend","ajax","json","post","recurring_update_mode","recurring_update_date","del","defaults","forceCompact","use","App","locales","$exportView","export_mode","display","jetapp","services","Week","Month","Agenda","Timeline","Today","Create","Next","Previous","Next day","Previous day","Next week","Previous week","Next month","Previous month","Add calendar","Do you really want to remove this calendar?","Edit calendar","Title","Color","Active","Settings","(no title)","Inactive calendar","No Events","All Day","Expand all-day events","Collapse all-day events","The event will be deleted permanently, are you sure?","Delete event","Edit","(No title)","Event","Start","End","Notes","Edit event","Assigned to units","No units","Unknown unit","never","none","daily","every","weekly","monthly","yearly","years","Repeat","End repeat","Repeats each","till","times","weekly, every","monthly, every","yearly, every","every working day","custom","Every","of","after several occurrences","week on","Change recurring pattern","Save changes?","All events","This event","This event and the following","Apply","Edit recurring event","Timeline scale","Section","Show more"],"mappings":"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"}